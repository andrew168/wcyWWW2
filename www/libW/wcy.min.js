/*! bone 2015-03-26 */
function throb(a){$(a).animate({opacity:1},250,function(){$(this).animate({opacity:.5},2e3)})}function restoreTestSubjects(){$(".testSubject,.testSubject *").removeAttr("style")}function displayInfo2(a){$("#testLabelInfo").text(a)}function displayInfo3(a){TQ.MessageBubble.counter++,TQ.MessageBubble.addMessage(a),TQ.MessageBubble.counter>=2&&TQ.MessageBubble.close()}function displayJSON(a){var b=a,c=JSON.stringify(b);displayInfo2(c)}function isObject(a){return null==a?!1:"object"==typeof a&&a.constructor==Object}function isFunction(a){return null==a?!1:"function"==typeof a&&a.constructor==Function}function dumpObject(a){var b='<table border="1px"><tr><th>name</th><th>type</th><th>value</th><th>dump</th></tr>';for(var c in a){var d=a[c];isFunction(d)||(isObject(d)?dumpObject(d):(b+="<tr>",b+="<td>"+c+"</td>",b+="<td>"+typeof d+"</td>",b+="<td>"+(isFunction(d)||isObject(d)?"Error":d)+"</td>",b+="<td>"+(isObject(d)?dumpObject(d):"")+"</td>",b+="</tr>"))}b+="</table>",$("#infoRegion").html(b)}function initWorkingArea(){allowDroppable(),$("div#tab_right_panel img").draggable({helper:"clone"})}function allowDroppable(){var a={};a.drop=function(a,b){displayInfo2("x="+b.offset.left+"y= "+b.offset.top);var c=$(b.draggable),d=stage.getObjectsUnderPointer2(a),e=screenToRegionX(pivotToCenterX(b.offset.left)),f=screenToRegionY(pivotToCenterY(b.offset.top)),g=TQ.Utility.getMaxZ()+1;_addResToStage(c,d,e,f,g)},$("#workingarea").droppable(a)}function _addResToStage(a,b,c,d,e,f,g){if(null!=a){void 0==g&&(g=TQ.FrameCounter.t());var h=a.attr("src"),i=a.attr("type"),j=a.attr("eType"),k=a.attr("title");if(!h||!i||!j)return void assertTrue(TQ.Dictionary.INVALID_PARAMETER+"src, tyep or eType",h&&i&&j);var l="1",m="2",n="3",o="4",p="11",q="6";void 0!=j&&j==q&&(i=o);var r=null,s=null;if(h=h.replace("/.",""),void 0!=h&&null!=h){if(i==l)return openScene(TQ.Utility.getSceneByThumbnail(h));switch(i){case p:r="SOUND";var t=a.attr("soundsrc");s=TQ.Utility.getAudioByThumbnail(t),b?(TQ.SelectSet.getSelectedElement(),displayInfo2(b.toString())):displayInfo2("请把声音拖放到合适的物体上！");break;case n:r="GroupFile",c=0,d=TQ.Config.workingRegionHeight,s=TQ.Utility.getComponentByThumbnail(h);break;case o:r="BUTTON",s=TQ.Utility.getImageByThumbnail(h);break;case m:default:i!=m&&assertTrue(TQ.Dictionary.INVALID_PARAMETER,0),r="Bitmap",s=TQ.Utility.getImageByThumbnail(h)}var u={src:s,alias:k,type:r,eType:j,x:c,y:TQ.Utility.toWorldCoord(d),zIndex:e,t0:g};return void 0!=f&&(u.levelID=f),addImage(u)}}}function addResToStageCenter(a,b,c){var d=TQ.SelectSet.peek(),e=TQ.Config.workingRegionWidth/2,f=TQ.Config.workingRegionHeight/2,g=TQ.Utility.getMaxZ()+1;return _addResToStage(a,d,e,f,g,b,c)}function screenToRegionX(a){return a-TQ.Config.workingRegionX0}function screenToRegionY(a){return a-TQ.Config.workingRegionY0}function pivotToCenterX(a){return a+TQ.Config.THUMBNAIL_WIDTH/2}function pivotToCenterY(a){return a+TQ.Config.THUMBNAIL_HEIGHT/2}function zipBlob(a,b,c){zip.createWriter(new zip.BlobWriter("application/zip"),function(d){d.add(a,new zip.BlobReader(b),function(){d.close(c)})},onerror)}function netSave(a,b,c,d){var e=new FormData,f=!1;null==d||0==d.isTimeSaveWcy?($("#messagediv_content").html(TQ.Dictionary.IS_SAVING),easyDialog.open({container:"messagediv"}),f=!0):(b=JSON.parse(b),f=!1),e.append("filename",a),e.append("userID",localStorage.getItem("userID")),e.append("publish_v",$("#save-file #publish").val()),e.append("keywords",c),e.append("wdmFile",JSON.stringify(b)),$.ajax({url:"http://"+TQ.Config.DOMAIN_NAME+"/wcy/save",type:"post",contentType:!1,processData:!1,data:e}).done(function(a){a=JSON.parse(a),void 0!=a.name&&""!=a.name&&(TQ.Init.wcyTempName=a.name),f&&displayInfo3()}).done(function(){TQ.Init.saveServerWcyProcess=0})}function netOpen(a,b){var c="filename="+a;$.get("http://"+TQ.Config.DOMAIN_NAME+"/wcy/wdmOpen",c,b,NET_IO_DATA_TYPE)}function onDelete(a){displayInfo2(a),a.indexOf(TQ.Dictionary.FAILED)<0&&(localStorage.setItem("sceneName",""),$("#newScene").click())}function expectAsserts(a){jstestdriver.expectedAssertCount=a}function jstestdriver(){}function isBoolean_(a){"boolean"!=typeof a&&fail("Not a boolean: "+prettyPrintEntity_(a))}function formatElement_(a){var b;try{b=a.tagName.toLowerCase();for(var c,d="<"+b,e=a.attributes,f=0,g=e.length;g>f;f++)c=e.item(f),c.nodeValue&&(d+=" "+c.nodeName+'="'+c.nodeValue+'"');return d+">...</"+b+">"}catch(h){return"[Element]"+(b?" "+b:"")}}function prettyPrintEntity_(a){if(isElement_(a))return formatElement_(a);var b;if("function"==typeof a){try{b=a.toString().match(/(function [^\(]+\(\))/)[1]}catch(c){}return b||"[function]"}try{b=JSON.stringify(a)}catch(c){}return b||"["+typeof a+"]"}function argsWithOptionalMsg_(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);var e=b-1;return a.length<e?fail("expected at least "+e+" arguments, got "+a.length):a.length==b?c[0]+=" ":c.unshift(""),c}function assertTrue(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,isBoolean_(a[1]),1!=a[1]&&fail(a[0]+"expected true but was "+prettyPrintEntity_(a[1])),!0}function assertFalse(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,isBoolean_(a[1]),0!=a[1]&&fail(a[0]+"expected false but was "+prettyPrintEntity_(a[1])),!0}function assertEquals(a,b,c){var d=argsWithOptionalMsg_(arguments,3);return jstestdriver.assertCount++,a=d[0],b=d[1],c=d[2],compare_(b,c)||fail(a+"expected "+prettyPrintEntity_(b)+" but was "+prettyPrintEntity_(c)),!0}function compare_(a,b){if(a===b)return!0;if("object"!=typeof a||"object"!=typeof b||!a||!b)return a==b;if(isElement_(a)||isElement_(b))return!1;var c=null,d=0,e=0;try{if(jstestdriver.jQuery.isArray(b))d=b.length;else for(c in b)b.hasOwnProperty(c)&&++d;if(0==d&&"number"==typeof b.length){d=b.length;for(var f=0,g=d;g>f;f++)if(!(f in b)){d=0;break}}for(c in a)if(a.hasOwnProperty(c)){if(!compare_(a[c],b[c]))return!1;++e}return e!=d?!1:0==e?a.toString()==b.toString():!0}catch(h){return!1}}function assertNotEquals(){try{assertEquals.apply(this,arguments)}catch(a){if("AssertError"==a.name)return!0;throw a}var b=argsWithOptionalMsg_(arguments,3);fail(b[0]+"expected "+prettyPrintEntity_(b[1])+" not to be equal to "+prettyPrintEntity_(b[2]))}function assertSame(){var a=argsWithOptionalMsg_(arguments,3);return jstestdriver.assertCount++,isSame_(a[2],a[1])||fail(a[0]+"expected "+prettyPrintEntity_(a[1])+" but was "+prettyPrintEntity_(a[2])),!0}function assertNotSame(){var a=argsWithOptionalMsg_(arguments,3);return jstestdriver.assertCount++,isSame_(a[2],a[1])&&fail(a[0]+"expected not same as "+prettyPrintEntity_(a[1])+" but was "+prettyPrintEntity_(a[2])),!0}function isSame_(a,b){return b===a}function assertNull(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,null!==a[1]&&fail(a[0]+"expected null but was "+prettyPrintEntity_(a[1])),!0}function assertNotNull(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,null===a[1]&&fail(a[0]+"expected not null but was null"),!0}function assertUndefined(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,"undefined"!=typeof a[1]&&fail(a[2]+"expected undefined but was "+prettyPrintEntity_(a[1])),!0}function assertNotUndefined(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,"undefined"==typeof a[1]&&fail(a[0]+"expected not undefined but was undefined"),!0}function assertNaN(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,isNaN(a[1])||fail(a[0]+"expected to be NaN but was "+a[1]),!0}function assertNotNaN(){var a=argsWithOptionalMsg_(arguments,2);return jstestdriver.assertCount++,isNaN(a[1])&&fail(a[0]+"expected not to be NaN"),!0}function assertException(a,b,c){1==arguments.length?(b=a,a=""):2==arguments.length&&"function"!=typeof b?(c=b,b=a,a=""):a+=" ",jstestdriver.assertCount++;try{b()}catch(d){if("AssertError"==d.name)throw d;return c&&d.name!=c&&fail(a+"expected to throw "+c+" but threw "+d.name),!0}fail(a+"expected to throw exception")}function assertNoException(){var a=argsWithOptionalMsg_(arguments,2);jstestdriver.assertCount++;try{a[1]()}catch(b){fail(a[0]+"expected not to throw exception, but threw "+b.name+" ("+b.message+")")}}function assertArray(){var a=argsWithOptionalMsg_(arguments,2);jstestdriver.assertCount++,jstestdriver.jQuery.isArray(a[1])||fail(a[0]+"expected to be array, but was "+prettyPrintEntity_(a[1]))}function assertTypeOf(){var a=argsWithOptionalMsg_(arguments,3);jstestdriver.assertCount++;var b=typeof a[2];return b!=a[1]&&fail(a[0]+"expected to be "+a[1]+" but was "+b),!0}function assertBoolean(){var a=argsWithOptionalMsg_(arguments,2);return assertTypeOf(a[0],"boolean",a[1])}function assertFunction(){var a=argsWithOptionalMsg_(arguments,2);return assertTypeOf(a[0],"function",a[1])}function assertObject(){var a=argsWithOptionalMsg_(arguments,2);return assertTypeOf(a[0],"object",a[1])}function assertNumber(){var a=argsWithOptionalMsg_(arguments,2);return assertTypeOf(a[0],"number",a[1])}function assertString(){var a=argsWithOptionalMsg_(arguments,2);return assertTypeOf(a[0],"string",a[1])}function assertMatch(a,b,c){var d=argsWithOptionalMsg_(arguments,3),e="undefined"==typeof d[2];jstestdriver.assertCount++;var f;return(e||!d[1].test(d[2]))&&(c=e?f:prettyPrintEntity_(d[2]),fail(d[0]+"expected "+c+" to match "+d[1])),!0}function assertNoMatch(){var a=argsWithOptionalMsg_(arguments,3);return jstestdriver.assertCount++,a[1].test(a[2])&&fail(a[0]+"expected "+prettyPrintEntity_(a[2])+" not to match "+a[1]),!0}function assertTagName(){var a=argsWithOptionalMsg_(arguments,3),b=a[2]&&a[2].tagName;return String(b).toUpperCase()!=a[1].toUpperCase()&&fail(a[0]+"expected tagName to be "+a[1]+" but was "+b),!0}function assertClassName(){var a=argsWithOptionalMsg_(arguments,3),b=a[2]&&a[2].className,c=new RegExp("(^|\\s)"+a[1]+"(\\s|$)");try{assertMatch(a[0],c,b)}catch(d){b=prettyPrintEntity_(b),fail(a[0]+"expected class name to include "+prettyPrintEntity_(a[1])+" but was "+b)}return!0}function assertElementId(){var a=argsWithOptionalMsg_(arguments,3),b=a[2]&&a[2].id;return jstestdriver.assertCount++,b!==a[1]&&fail(a[0]+"expected id to be "+a[1]+" but was "+b),!0}function assertInstanceOf(){jstestdriver.assertCount++;var a=argsWithOptionalMsg_(arguments,3),b=prettyPrintEntity_(a[2]),c=a[1]&&a[1].name||a[1];return null==a[2]&&fail(a[0]+"expected "+b+" to be instance of "+c),Object(a[2])instanceof a[1]||fail(a[0]+"expected "+b+" to be instance of "+c),!0}function assertNotInstanceOf(){var a=argsWithOptionalMsg_(arguments,3);if(jstestdriver.assertCount++,Object(a[2])instanceof a[1]){var b=a[1]&&a[1].name||a[1],c=prettyPrintEntity_(a[2]);fail(a[0]+"expected "+c+" not to be instance of "+b)}return!0}function assertEqualsDelta(a,b,c,d){var e=this.argsWithOptionalMsg_(arguments,4);return jstestdriver.assertCount++,a=e[0],b=e[1],c=e[2],d=e[3],compareDelta_(b,c,d)||this.fail(a+"expected "+d+" within "+this.prettyPrintEntity_(b)+" but was "+this.prettyPrintEntity_(c)),!0}function compareDelta_(a,b,c){var d=function(a,b,c){return Math.abs(a-b)<=c};if(a===b)return!0;if("number"==typeof a||"number"==typeof b||!a||!b)return d(a,b,c);if(isElement_(a)||isElement_(b))return!1;var e=null,f=0,g=0;try{if(jstestdriver.jQuery.isArray(b))f=b.length;else for(e in b)b.hasOwnProperty(e)&&++f;if(0==f&&"number"==typeof b.length){f=b.length;for(var h=0,i=f;i>h;h++)if(!(h in b)){f=0;break}}for(e in a)if(a.hasOwnProperty(e)){if(!compareDelta_(a[e],b[e],c))return!1;++g}return g!=f?!1:0==g?a.toString()==b.toString():!0}catch(j){return!1}}function assertEqualsObject(a,b,c){var d=prettyPrintEntity_(b),e=prettyPrintEntity_(c);return assertEquals(a,d,e)}function assertNotEqualsObject(a,b,c){var d=prettyPrintEntity_(b),e=prettyPrintEntity_(c);return assertNotEquals(a,d,e)}function assertEqualsMatrix(a,b,c){var d=prettyPrintEntity_(b.multiply(100)),e=prettyPrintEntity_(c.multiply(100));return assertEquals(a,d,e)}function assertNotEqualsMatrix(a,b,c){var d=prettyPrintEntity_(b.multiply(100)),e=prettyPrintEntity_(c.multiply(100));return assertNotEquals(a,d,e)}function assertNotHere(a){return assertTrue(TQ.Dictionary.INVALID_LOGIC+", "+a,!1)}function assertValid(a,b){assertNotUndefined(TQ.Dictionary.FoundNull+": "+a,b),assertNotNull(a+"null",b)}function assertDepreciated(a){assertTrue(a,!1)}function init(a){"string"==typeof a&&(a={name:a,content:null}),canvas=document.getElementById("testCanvas"),addHammer(canvas),stage=new createjs.Stage(canvas),stage.enableMouseOver(),messageBoard=new TQ.MessageBox(canvas),TQ.SoundMgr.initialize(),TQ.RM.initialize(),TQ.SceneEditor.loadScene(a),initializeControllers(),createjs.Ticker.setFPS(20),createjs.Ticker.addListener(currScene,!1),createjs.Ticker.addListener(window)}function initializeControllers(){TQ.TaskMgr.initialize(),TQ.GarbageCollector.initialize(),TQ.CommandMgr.initialize(),TQ.InputCtrl.initialize(stage),TQ.MoveCtrl.initialize(stage),TQ.SkinningCtrl.initialize(stage,currScene),TQ.IKCtrl.initialize(stage,currScene),TQ.TrackRecorder.initialize(),TQ.ActionRecorder.initialize(),TQ.SelectSet.initialize(),TQ.TouchMgr.initialize()}function openScene(a){if("string"==typeof a&&(a={name:a,content:null}),!currScene||currScene.isSaved)messageBoard.hide(),currScene?currScene.close():(currScene=new TQ.Scene,TQ.WCY.currentScene=currScene),TQ.GarbageCollector.clear(),currScene.open(a),localStorage.setItem("sceneName",a.name),TQ.FrameCounter.reset(),TQ.CommandMgr.clear(),TQ.SkinningCtrl.end(),TQ.floatToolbar.show(!1),TQ.WCY.currentScene=currScene,TQ.displayUI.initialize&&TQ.displayUI.initialize();else{var b=localStorage.getItem("sceneName");TQ.SceneEditorUI.promptToSave(b)}return currScene}function getDefaultTitle(a){var b=currScene&&currScene.title?currScene.title:a;b||(b=TQ.Config.UNNAMED_SCENE);var c=b.lastIndexOf("\\");0>=c&&(c=b.lastIndexOf("/"));var d=c>0?b.substr(c+1):b;return TQ.Utility.forceExt(d)}function save(){return TQ.Utility.getUserID()<=0?void TQ.MessageBubble.show(TQ.Dictionary.LoginPlease):(TQ.InputMap.turnOff(),void TQ.FileDialog.getFilename(getDefaultTitle(null),_doSave))}function deleteScene(){var a=currScene.title;if(a.lastIndexOf(TQ.Config.DEMO_SCENE_NAME)<0&&a!=TQ.Config.UNNAMED_SCENE){var b=currScene.filename;TQ.TaskMgr.addTask(function(){netDelete(b)},null)}else displayInfo2("<"+a+">:"+TQ.Dictionary.CanntDelete)}function _doSave(a,b){TQ.TaskMgr.addTask(function(){currScene.save(a,b)},null),TQ.InputMap.turnOn(),localStorage.setItem("sceneName",a)}function addLevelTest(){var a=currScene.addLevel();currScene.gotoLevel(a)}function addImage(a){return a.version=TQ.Element.VER2,"SOUND"!=a.type&&"Bitmap"!=a.type&&"BUTTON"!=a.type||TQ.RM.hasElementDesc(a)?currScene.addItem(a):(TQ.RM.addElementDesc(a,function(){currScene.addItem(a)}),null)}function addAnimationTest(){currScene.addItem({src:TQ.Config.SCENES_CORE_PATH+"AnimationDesc.adm",type:"BitmapAnimation"})}function makeAnimationTest(){currScene.shooting()}function uploadImageWindow(){createWindow("Weidongman/src/upload_image.php",500,400)}function createWindow(a,b,c){var d=10;b+=d,c+=d,window.popup&&!window.popup.closed&&window.popup.resizeTo(b,c);var e="location=no, scrollbars=no, menubars=no, toolbars=no, resizable=yes, left=0, top=0, width="+b+", height="+c,f=window.open(a,"ImageWindow",e);f.focus()}function addTextTest(){TQ.TextEditor.addText(TQ.Dictionary.defaultText)}function backToPreviousLevel(){currScene.preLevel()}function advanceToNextLevel(){currScene.nextLevel()}function create3DElement(){if(TQ.SelectSet.groupIt()){var a=currScene.currentLevel.latestElement;if(null!=a&&null==a.viewCtrl){var b=new TQ.MultiView;TQ.CommandMgr.addCommand(new TQ.GenCommand(TQ.GenCommand.SET_3D_OBJ,b,a,a))}}clearSubjectModeAndMultiSelect()}function editActions(){var a=TQ.SelectSet.peek();null!=a&&TQ.Animation.unitTest(a)}function RotateCtrl(){}function ScaleCtrl(){RotateCtrl.call()}function update(){stage.update()}function addFPS(){}function update(){stage.update()}function addFPS(){}window.TQ=window.TQ||{},function(){function a(){}var b=a;b._LENGTH=20,b.buffer=[],b._on=!1,b.enabled=!1,b.start=function(a,c){return b.buffer.splice(0),b.buffer.push({x:a,y:c}),b._on=!0,b.buffer[0]},b.close=function(){b.buffer.splice(0),b._on=!1},b.smooth=function(a,c){if(b.enabled){if(!b._on)return assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),b.start(a,c);8==__user_level&&console.log(a+", "+c),b.buffer.length>=b._LENGTH&&b.buffer.shift(),b.buffer.push({x:a,y:c}),a=0,c=0;for(var d=b.buffer.length,e=0;d>e;e++)a+=b.buffer[e].x/d,c+=b.buffer[e].y/d}return{x:a,y:c}},b.isOn=function(){return b._on},TQ.DitherRemover=a}();var __enable_debug_trsa=!1,value=0,NET_IO_DATA_TYPE="text";window.TQ=window.TQ||{},TQ=TQ||{},TQ.namespace=function(a){var b,c=a.split("."),d=TQ;for("TQ"===c[0]&&(c=c.slice(1)),b=0;b<c.length;b++)"undefined"==typeof d[c[b]]&&(d[c[b]]={}),d=d[c[b]];return d};var inherit=function(){var a=function(){};return function(b,c){a.prototype=c.prototype,b.prototype=new a,b.uber=c.prototype,b.prototype.constructor=b}}();Math.truncate6=function(a){return Math.floor(1e6*a)/1e6},TQ.ERROR=-1,window.TQ=window.TQ||{},function(){function a(){}a.LoginPlease="请先登录！",a.fontFace="隶书",a.defaultText="用克隆键C批量添加文字更快捷",a.OK="确定",a.Return="返回",a.Cancel="取消",a.CommaCh="，",a.Save="保存",a.Component="元件",a.MiniAnime="微动漫",a.PleaseSelectText="应该先选中字符串",a.PleaseSelectHost="请先选择主物体",a.PleaseSelectOne="必须有一个选中点",a.CanntReentry="不能重复进入",a.TextEditor="文字编辑",a.SelectColor="选择字体颜色",a.Selected="选中",a.isDepreciated="是否已经废弃?, 只是和保钓兼容???",a.ParentMatrixFromLastIteration="父矩阵是上一个迭代计算的",a.MustBeBatchMode="必须是BatchMode",a.CurrentState="当前状态:",a.CounterValidation="计数器合法值 > 0",a.FoundNull="发现Null,或者未定义的对象",a.Load="调入",a.Frame="帧",a.ShareTitle="让生活享受动漫！---- 图强微创意引擎支持",a.ShareSummary="我的创意，送给你！",a.CanntDelete="系统保留文件,不能删除！",a.INVALID_FILENAME="非法的文件名",a.INVALID_LOGIC="非法逻辑",a.INVALID_PARAMETER="非法参数值，数值出界或为空",a.SAME_TYPE_SKIN="只有相同类别的元素能够换皮肤",a.Locked="物体已经锁定,如需操作,请先解锁",a.MenuNewScene="创建新的微创意",a.MenuSave="保存微创意, 保存元件",a.MenuUndo="撤销(Ctrl + Z)",a.MenuRedo="重做(Ctrl + Y)",a.MenuDelete="删除当前微创意",a.MenuDeleteElements="删除选中的元素",a.MenuNewLevel="插入新场景",a.MenuInsertText="插入文本",a.MenuSkinning="换皮肤",a.MenuJoint="加关节",a.MenuMinJointAngle="设置关节的最小位置",a.MenuMaxJointAngle="设置关节的最大位置",a.MenuKeyUnjoint="去关节",a.MenuSetStageSize="设置舞台的大小",a.MenuLockIt="锁定物体,防止误操作",a.MenuUploadImage="上传图片",a.MenuPreviousLevel="上一场景",a.MenuNextLevel="下一场景",a.MenuAnimation="动作表",a.Menu3Dfy="打包成3D元素",a.MenuGroup="打包成复合大物体",a.MenuKeyUngroup="拆散复合物体",a.MenuBeginning="开头",a.MenuEnd="结尾",a.MenuSubElement="进入/退出零件编辑模式",a.MenuLinearMode="进入/退出连续动画模式",a.MenuStop="停止",a.MenuPlay="播放动画",a.MenuKeyMove="平移",a.MenuKeyScale="缩放",a.MenuKeyRotate="旋转",a.MenuKeyShift="上下",a.MenuKeyHideShow="隐藏/显示",a.MenuKeyRemoveTrack="消除所选对象的动画",a.NAME_EXIST="名字已经存在",a.NAME_NOT_EXIST="名字不存在",a.IS_SAVING="正在保存，请勿关闭页面！",a.FAILED="不成功",a.SaveItPlease="当前文件已经修改， 要保存吗？",a.Yes="是",a.No="不",a.IS_PROCESSING="正在处理，请稍后......",TQ.Dictionary=a}(),window.TQ=window.TQ||{},function(){function a(){}a.DOMAIN_NAME=window.location.host,a.EXTENSION="",a.color="#0000FF",a.fontFace=window.TQ.Dictionary.fontFace,a.fontSize="36",a.BACKGROUND_COLOR="#FFF",a.workingRegionX0=160,a.workingRegionY0=63,a.workingRegionWidth=662,a.workingRegionHeight=485,a.zoomX=1,a.zoomY=1,a.validPageWidth=960,a.MouseSensitivity=10,a.RotateSensitivity=2,a.pivotX=.5,a.pivotY=.5,a.TEXT_PIVOT_X=0,a.TEXT_PIVOT_Y=a.pivotY,a.DISPLAY_CLIPS=!1,a.THUMBNAIL_WIDTH=175,a.THUMBNAIL_HEIGHT=128,a.RESOURCE_PAGE_SIZE=15,a.IK_ITERATE_TIME=1,a.DEMO_SCENE_NAME="SystemDemo1",a.UNNAMED_SCENE="wcy01",a.THUMBS_CORE_PATH="mcThumbs/",a.IMAGES_CORE_PATH="mcImages/",a.SCENES_CORE_PATH="mcAssets/",a.SOUNDS_PATH="mcSounds/",a.SOUND_PLUGIN_PATH="../soundjs/",a.DefaultUserID=1e4,a.REMOVE_EMPTY_LEVEL_ON=!0,a.IS_DEBUG=!1,a.LOG_LEVEL=2,a.AutoPlay=!0,window.TQ.Config=a}(),window.TQ=window.TQ||{},function(){var a=function(){};a.CLOSE=0,a.CRITICAL_LEVEL=1,a.ERROR_LEVEL=2,a.WARN_LEVEL=5,a.INFO_LEVEL=7,a.level=TQ.Config.LOG_LEVEL,a.open=function(){a.level=a.INFO_LEVEL},a.close=function(){a.level=a.CLOSE},a.setLevel=function(b){a.level=b},a.trace=function(a){console.log(a)},a.criticalError=function(b){a.level>=a.CRITICAL_LEVEL&&console.log(b)},a.error=function(b){a.level>=a.ERROR_LEVEL&&console.log(b)},a.warn=function(b){a.level>=a.WARN_LEVEL&&console.log(b)},a.info=a.out=a.level>=a.INFO_LEVEL?function(a){console.log(a)}:function(){},TQ.Log=a}(),jstestdriver.assertCount=0,jstestdriver.jQuery=jQuery;var fail=function(a){var b=new Error(a);if(b.name="AssertError",b.message||(b.message=a),TQ.Config.IS_DEBUG)throw b;TQ.Log.criticalError(b.name+": "+a)},isElement_=function(){function a(a){try{b.appendChild(a),b.removeChild(a)}catch(c){return!1}return!0}var b=document.createElement("div");return function(b){return b&&1===b.nodeType&&a(b)}}(),assert=assertTrue;window.TQ=window.TQ||{},function a(){function a(){}a.range=function(a,b,c){return b>=a?b:a>=c?c:a},a.unifyValue10=function(b,c,d){var e=c+b*(d-c)/10;return e=a.range(e,c,d)},a.minZIndex=function(a,b,c){return b&&b.hasFlag(TQ.Element.IN_STAGE)?(b.jsonObj.zIndex>=c&&(a?a.jsonObj.zIndex>=b.jsonObj.zIndex&&(a=b):a=b),a):a},a.findUpperBoundary=function(b,c){for(var d=null,e=null,f=0;f<b.length;f++)if(e=b[f],d=a.minZIndex(d,e,c),e.children&&e.children.length>0){var g=a.findUpperBoundary(e.children,c);d=a.minZIndex(d,g,c)}return d},a.round2=function(a){return Math.round(100*a)/100},a.DEG_TO_RAD=Math.PI/180,a.RAD_TO_DEG=180/Math.PI,TQ.MathExt=a}(),window.TQ=window.TQ||{},function(){function a(){}var b=a.prototype=$V([1,0]);a.create=function(b){var c=new a;return c.setElements(b)},b.angle360=function(){assertFalse("vector  not 0",0==this.elements[0]&&0==this.elements[1]);var a=this.angleFrom($V([1,0]))*TQ.MathExt.RAD_TO_DEG,b=this.elements[0],c=this.elements[1];return c>0?a:0>c?360-a:b>0?a:0>b?180:(assertTrue("vector is 0, has no angle",!1),0)},b.signFrom=function(a){var b=$V([a.elements[0],a.elements[1],0]),c=$V([this.elements[0],this.elements[1],0]),d=b.cross(c),e=d.elements[2];return e>0?1:-1},b.angle360From=function(a){return this.signFrom(a)*TQ.MathExt.RAD_TO_DEG*this.angleFrom(a)},TQ.Vector2D=a}(),window.TQ=window.TQ||{},function(){function a(){}a.prototype=$M([1,0,0],[0,1,0],[0,0,1]);a.DEG_TO_RAD=Math.PI/180,a.create=function(b){var c=new a;return c.setElements(b)},a.I=function(){return a.create([[1,0,0],[0,1,0],[0,0,1]])},a.translation=function(b,c){return a.create([[1,0,b],[0,1,c],[0,0,1]])},a.scale=function(b,c){return a.create([[b,0,0],[0,c,0],[0,0,1]])},a.rotation=function(b){var c=null==b?0:b*a.DEG_TO_RAD,d=Math.cos(c),e=Math.sin(c);return a.create([[d,-e,0],[e,d,0],[0,0,1]])},a.transformation=function(b,c,d,e,f){b=null==b?0:b,c=null==c?0:c,e=null==e?1:e,f=null==f?1:f;var g=null==d?0:d*a.DEG_TO_RAD,h=Math.cos(g),i=Math.sin(g);return a.create([[h*e,-i*f,b],[i*e,h*f,c],[0,0,1]])},TQ.Matrix2D=a}(),window.TQ=window.TQ||{},function(){function a(){}a.toCssFont=function(a,b){return a+"px "+b},a.extractAttr=function(a,b,c,d){var e=new RegExp("<"+a+"[^<>]*?\\s"+b+"=['\"]?(.*?)['\"]?\\s.*?>(.*?)</"+a+">"),f=new RegExp("<"+a+"[^<>]*?\\s"+b+"=['\"]?(.*?)['\"]>(.*?)</"+a+">");try{var g=e.exec(c);if(null!=g){var h=null;g.length>=2&&(h=g[1])}(null==h||""==h)&&(g=f.exec(c),h=null!=g&&g.length>=2?g[1]:d)}catch(i){}return h},a.extractTag=function(a,b,c){var d=new RegExp("<"+a+"[^<>]*?>(.*?)</"+a+">");try{var e=d.exec(b);if(null!=e)return e.length>=2?e[1]:c}catch(f){}return c},a.forceExt=function(a){return a.indexOf(".")>0?a=a.substr(0,a.indexOf("."))+TQ.Config.EXTENSION:a+=TQ.Config.EXTENSION,a},a.getAudioByThumbnail=function(a){a=a.replace("./","/"),assertTrue(TQ.Dictionary.INVALID_PARAMETER,a.lastIndexOf("\\")<=0);var b=a.replace("http://"+TQ.Config.DOMAIN_NAME+"/","");return"http://"+TQ.Config.DOMAIN_NAME+"/"+b},a.getImageByThumbnail=function(a){var b="mcImages/",c="mcThumbs/";return assertTrue(TQ.Dictionary.INVALID_PARAMETER,a.lastIndexOf("\\")<=0),a=a.replace("http://"+TQ.Config.DOMAIN_NAME,""),a.replace(c,b)},a.getComponentByThumbnail=function(a){var b="mcThumbs/";assertTrue(TQ.Dictionary.INVALID_PARAMETER,a.lastIndexOf("\\")<=0),a=a.replace("http://"+TQ.Config.DOMAIN_NAME,"");var c=a.indexOf(b)+b.length,d=a.substr(c),e=d.lastIndexOf(".");return 0>=e&&(e=d.length),d.substring(0,e)+TQ.Config.EXTENSION},a.getSceneByThumbnail=function(b){return a.getComponentByThumbnail(b)},a.isComponent=function(){return 1==$("#tab_right_panel").tabs("option","active")},a.isScene=function(){return 0==$("#tab_right_panel").tabs("option","active")},a.getEmptyScene=function(){return{levels:[{jsonElements:null,FPS:20,elements:null,name:"0"}],overlay:null,currentLevelId:0,currentLevel:null}},a.assertValid=function(a){assertNotUndefined(TQ.Dictionary.FoundNull,a),assertNotNull(TQ.Dictionary.FoundNull,a)},a.isAnimationDesc=function(a){return a.lastIndexOf(".adm")>0},a.isSoundResource=function(a){for(var b=[".wav",".mp3",".ogg"],c=0;c<b.length;c++)if(a.lastIndexOf(b[c])>0)return!0;return!1},a.isImage=function(a){for(var b=a.toLowerCase(),c=[".png",".jpg",".bmp",".gif"],d=0;d<c.length;d++)if(b.lastIndexOf(c[d])>0)return!0;return!1},a.isJSON=function(a){if(void 0!=a&&null!=a){if(void 0!=a.type&&null!=a.type)return!0;if(void 0!=a.src&&null!=a.src)return!0}return!1},a.deltaYinWorld=function(a,b,c){var d=c.stageY+b.y-a.y;return-d},a.deviceToWorld=function(b,c){return{x:b,y:a.toWorldCoord(c)}},a.worldToDevioce=function(b,c){return{x:b,y:a.toDeviceCoord(c)}},a.toDeviceCoord=function(a){return TQ.Config.workingRegionHeight-a},a.toDeviceRotation=function(a){return-a},a.toWorldCoord=function(a){return TQ.Config.workingRegionHeight-a},a.canvas2WindowX=function(a){return window.canvas.offsetLeft+a},a.canvas2WindowY=function(a){return window.canvas.offsetTop+a},a.toDevicePivot=function(a){return 1-a},a.readLocalStorage=function(a,b){var c=localStorage.getItem(a);return(""==c||"null"==c)&&(c=b),c},a.writeLocalStorage=function(a,b){return localStorage.setItem(a,b)},a.getUrlParam=function(a){var b={QueryString:function(a){var b=window.location.search,c=new RegExp(""+a+"=([^&?]*)","ig");try{var d=b.match(c)?decodeURIComponent(b.match(c)[0].substr(a.length+1)):""}catch(e){TQ.Log.criticalError("Error in URL Parameter:"+b+":"+e.toString()),d=""}return d}};return b.QueryString(a)},a.getUserID=function(){var b=TQ.Init.uid;if(""==b){var c=a.readLocalStorage("userID","");b=""!=c?c:TQ.Config.DefaultUserID}else localStorage.setItem("userID",b);return b},a.DEV_PC=1,a.DEV_PAD=2,a.DEV_MOBILE=4,a.OS_ANDROID=16,a.OS_IPHONE=32,a.OS_WINDOWS=64,a.OS_MAC=128,a.BR_FIREFOX=256,a.BR_CHROME=512,a.BR_SAFARI=1024,a.env=0,a.setEnv=function(b){a.env|=b},a.clearEnv=function(b){a.env&=~b},a.hasEnv=function(b){return a.env&b},a.isSupportedEnvironment=function(){var b=""!=TQ.Utility.getUrlParam("B"),c=!1;return b&&alert(navigator.userAgent),navigator.userAgent.match(/(Android)/i)?(a.setEnv(a.DEV_MOBILE),a.setEnv(a.OS_ANDROID)):(a.setEnv(a.DEV_PC),a.setEnv(a.OS_WINDOWS)),navigator.userAgent.indexOf("Chrome")>0?(a.setEnv(a.BR_CHROME),c=!0):navigator.userAgent.indexOf("Firefox")>0?(a.setEnv(a.BR_FIREFOX),c=!0):navigator.userAgent.indexOf("Safari")>0&&(a.setEnv(a.BR_SAFARI),c=!0),c||(window.location=a.hasEnv(a.DEV_PC)?"ShowBrowsers.php":"MobileBrowsers.php"),c},a.CheckUserRight=function(){a.getUserID()},a.getMaxZ=function(){return assertNotNull(currScene,TQ.Dictionary.FoundNull),assertNotNull(currScene.currentLevel,TQ.Dictionary.FoundNull),currScene&&currScene.currentLevel?(currScene.currentLevel.persist(),stage.getNumChildren()):0},a.isTouchEvent=function(a){var b=a.nativeEvent;return null!=b.touches&&null!=b.changedTouches},a.isMultiTouchEvent=function(b){return a.isTouchEvent(b)&&b.nativeEvent.touches.length>=2};var b=-1;a.isTouchScreen=function(){if(-1==b){var a=navigator.userAgent.toLowerCase();b=Modernizr.touch||a.match(/(iphone|ipod|ipad)/)||a.match(/(android)/)||a.match(/(iemobile)/)||a.match(/iphone/i)||a.match(/ipad/i)||a.match(/ipod/i)||a.match(/blackberry/i)||a.match(/bada/i)}return b},a.getOffsetTop=function(b){return b.offsetParent?b.offsetTop+a.getOffsetTop(b.offsetParent):b.offsetTop},a.getOffsetLeft=function(b){return b.offsetParent?b.offsetLeft+a.getOffsetLeft(b.offsetParent):b.offsetLeft},a.getDefultActionIcon=function(){var a=100;return a},TQ.Utility=a}(),window.TQ=window.TQ||{},function(){function a(){}var b=!1,c=!1;a.initialize=function(){if(c){{document.getElementById("touchPic")}a.addTouchHandler(document)}},a.addTouchHandler=function(b){null!=b&&(b.addEventListener("touchstart",a.handleTouchEvent,!1),b.addEventListener("touchend",a.handleTouchEvent,!1),b.addEventListener("touchmove",a.handleTouchEvent,!1),b.addEventListener("touchcancel",a.handleTouchEvent,!1),b.addEventListener("gesturestart",a.handleTouchEvent,!1),b.addEventListener("gestureend",a.handleTouchEvent,!1),b.addEventListener("gesturechange",a.handleTouchEvent,!1),b.addEventListener("onscroll",a.handleTouchEvent,!1))},a.handleTouchEvent=function(a){assertNotNull(TQ.Dictionary.INVALID_PARAMETER,a.touches),assertNotNull(TQ.Dictionary.INVALID_PARAMETER,a.changedTouches);var c=a.touches.length,d=a.changedTouches.length,e=document.getElementById("testLabelInfo"),f=0,g=0,h=0,i=0,j=a.type+":"+c+","+d;j+=null!=a.scale?", "+TQ.MathExt.round2(a.scale):", 0",j+=null!=a.rotation?", "+TQ.MathExt.round2(a.rotation):", 0";for(var k=Math.max(c,d),l=0;k>l;l++)f=0,g=0,h=0,i=0,c>l&&(f=a.touches[l].clientX,g=a.touches[l].clientY),d>l&&(h=a.changedTouches[l].clientX,i=a.changedTouches[l].clientY),j+=",("+f+","+g+") ("+h+", "+i+")";if(c>=1||d>=1)switch(a.type){case"touchstart":j="<br><br>Touch started: "+j;break;case"touchend":j="<br>Touch ended: "+j;break;case"touchmove":a.preventDefault(),j="<br>Touch moved :"+j;break;case"touchcancel":a.preventDefault(),j="<br>Touch cancel: "+j;break;case"gesturestart":a.preventDefault(),j="<br><br>Gesture started :"+j;break;case"gestureend":a.preventDefault(),j="<br>Gesture ended : "+j;break;case"gesturechange":a.preventDefault(),j="<br>Gesture changed :"+j;break;case"onscroll":a.preventDefault(),j="<br>onscroll :"+j;break;default:j="<br>unknown event : "+j}else j="<br>有事件， 但是touches为空)："+j;b&&(null!=e?e.innerHTML+=j:console.log(j))},TQ.TouchMgr=a}(),TQ=TQ||{},function(){function a(){}var b=a.prototype;a.initialize=function(a){a.addHandler=b.addHandler,a.removeHandler=b.removeHandler,a.removeAllHandlers=b.removeAllHandlers,a.hasHandler=b.hasHandler,a.handleEvent=b.handleEvent},b._handlers=null,b._captureHandlers=null,b.initialize=function(){},b.handleEvent=function(a){if(this._handlers){var b=this._handlers[a];if(b)for(var c=0,d=b.length;d>c;c++){var e=b[c];e&&e()}}},b.addHandler=function(a,b,c){var d;d=c?this._captureHandlers=this._captureHandlers||{}:this._handlers=this._handlers||{};var e=d[a];return e&&this.removeHandler(a,b,c),e=d[a],e?e.push(b):d[a]=[b],b},b.removeHandler=function(a,b,c){var d=c?this._captureHandlers:this._handlers;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.removeAllHandlers=function(a){a?(this._handlers&&delete this._handlers[a],this._captureHandlers&&delete this._captureHandlers[a]):this._handlers=this._captureHandlers=null},b.hasHandler=function(a){var b=this._handlers,c=this._captureHandlers;return!!(b&&b[a]||c&&c[a])},TQ.EventHandler=a}(),this.TQ=this.TQ||{},function(){function a(){}var b=a;b.NOSOUND="/mcSounds/p1.wav",b.NOPIC="/mcImages/p1.png",b.BASE_PATH=null,b.isEmpty=!0,b.items=[],b.preloader={},b.callbackList=[],b.dataReady=!1,b.completeOnceHandlers=[],b.initialize=function(){b._hasCreated||(b._hasCreated=!0,b.hasDefaultResource=!1,b.BASE_PATH="http://"+TQ.Config.DOMAIN_NAME,b.NOPIC=b.toFullPath(b.NOPIC),b.NOSOUND=b.toFullPath(b.NOSOUND),createjs.FlashPlugin.swfPath="../src/soundjs/",createjs.Sound.registerPlugins(createjs.Sound.BrowserDetect.isChrome||createjs.Sound.BrowserDetect.isIOS?[createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]:[createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashPlugin]),b.preloader=new createjs.LoadQueue(!0),b.preloader.installPlugin(createjs.Sound),b.setupListeners())
},b.setupDefaultResource=function(){b.hasDefaultResource=!0,b.addItem(b.NOPIC),b.addItem(b.NOSOUND)},b.setupListeners=function(){b.preloader.on("fileload",function(a){var c=a.item.id,d=a.result;b.items[c]={ID:c,res:d,type:a.item.type},console.log(a.toString()+": "+a.item.id),b.onFileLoad(c,d,a)}),b.preloader.addEventListener("complete",function(a){console.log(a.toString()),b.dataReady=!0;for(var c=b.completeOnceHandlers.length;c>0;c--){var d=b.completeOnceHandlers.shift();d(a)}b.isEmpty=!0}),b.preloader.addEventListener("error",function(a){console.log(a.item.src+": "+a.toString());var c=a.item.id,d=null,e=null;switch(a.item.type){case createjs.LoadQueue.IMAGE:e=b.toFullPath(b.NOPIC);break;case createjs.LoadQueue.SOUND:e=b.toFullPath(b.NOSOUND);break;case createjs.LoadQueue.TEXT:break;default:console.log(a.item.type+": 未处理的资源类型!")}null!=e&&b.items[e]?d=b.items[e].res:assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),b.items[c]={ID:c,res:d,type:a.item.type},null==d?(b.addItem(e,function(){b.items[c].res=b.items[e].res,b.items[c].altResID=b.items[e].ID}),assertTrue(TQ.Dictionary.INVALID_LOGIC,!1)):(b.items[c].altResID=b.items[e].ID,b.onFileLoad(c,d,null))}),b.preloader.addEventListener("progress",function(){}),b.dataReady=!1},b.onFileLoad=function(a,c,d){for(var e=0;e<b.callbackList.length;e++)if(b.callbackList[e].ID==a){console.log("find immediate call back to do");var f=b.callbackList.splice(e,1);f[0].func(d),e--}},b.getID=function(a){return a.altResID?a.altResID:a.ID},b.reset=function(){b.completeOnceHandlers.splice(0),b.preloader.removeAllEventListeners(),b.preloader.reset(),b.preloader.removeAll(),b.setupListeners(),b.isEmpry=!0},b.setPaused=function(a){b.preloader.setPaused(a)},b.on=function(a,c){b.preloader.addEventListener(a,c)},b.onCompleteOnce=function(a){b.completeOnceHandlers.push(a)},b.removeEventListener=function(a,c){b.preloader.removeEventListener(a,c)},b.addItem=function(a,c){b.hasDefaultResource||b.setupDefaultResource(),a=b.toFullPath(a),this.hasResource(a)||(c&&b.callbackList.push({ID:a,func:c}),b.dataReady=!1,b.preloader.loadManifest([{src:a,id:a,data:3}]),b.isEmpty=!1)},b.addElementDesc=function(a,c){if(!a)return!1;var d=!1;if(a.children)for(var e=0;e<a.children.length;e++)b.addElementDesc(a.children[e])&&(d=!0);if("Group"===a.type)return d;if(a.src){var f=b.toRelative(a.src);f.trim(),f.length>0&&(b.hasResource(f)?c&&c():(b.addItem(f,c),d=!0))}return d},b.hasElementDesc=function(a){if(!a)return!0;var c=!0;if(a.children)for(var d=0;d<a.children.length;d++)b.addElementDesc(a.children[d])&&(c=!1);if(a.src){var e=b.toRelative(a.src);e.trim(),e.length>0&&(b.hasResource(e)||(c=!1))}return c},b.hasResource=function(a){return!!b.items[b.toFullPath(a)]},b.getResource=function(a){return a=b.toFullPath(a),b.items[a]?b.items[a]:(console.log(a+": 没有此资源, 需要加载, 如果需要回调函数，用 addItem 替代 getResource"),null)};b.toRelative=function(a){var b=a.replace("http://"+TQ.Config.DOMAIN_NAME+"/","");return b=b.replace("http://",""),b=b.replace("test.udoido.cn",""),b=b.replace("www.udoido.cn","")},b._isFullPath=function(a){return a.indexOf(b.BASE_PATH)>=0},b.toFullPath=function(a){return b._isFullPath(a)?a:"/"==a[0]?b.BASE_PATH+a:b.BASE_PATH+"/"+a},TQ.RM=b,TQ.ResourceManager=b}(),window.TQ=window.TQ||{},function(){var a=function(){throw"GarbageCollector cannot be instantiated"};a._members=[],a.initialize=function(){a.clear()},a.add=function(b){a._members.push(b)},a.remove=function(b){if(b){var c=a._members.indexOf(b);return c>=0&&a._members.splice(c,1),b}},a.clear=function(){for(var b=0;b<a._members.length;b++){var c=a._members[b];assertNotNull(TQ.Dictionary.FoundNull,c),a._members.splice(b,1),c.destroy()}a._members.splice(0)},TQ.GarbageCollector=a}(),window.TQ=window.TQ||{},function(){function a(a,b,c){this.f=a,this.params=b,this.path=null==c?!0:c}a.prototype.exec=function(a){this.f.apply(a,this.params)};var b={};b.queue=[],b.preferredQueue=[],b.isWorking=!1,b._timerID=-1,b.initialize=function(){b.queue=[],b.preferredQueue=[]},b.invoke=function(){b._timerID=setTimeout(function(){b._runOnce()},0)},b.stop=function(){b._timerID>=0&&clearTimeout(b._timerID),b._timerID=-1},b.addTask=function(c,d,e){e?b.preferredQueue.push(new a(c,d,null)):b.queue.push(new a(c,d,null)),b.isWorking||b.invoke()},b._getTask=function(){var a=b.preferredQueue.shift();return null==a?b.queue.shift():a},b._runOnce=function(){b.isWorking=!0;for(var a=b._getTask();null!=a;a=b._getTask())a.exec(b);b.isWorking=!1},TQ.TaskMgr=b}(),window.TQ=window.TQ||{},function(){function a(){}function b(){this.commands=[]}function c(a,b){this.receiver=a,this.newValue=Math.truncate6(b),this.oldValue=Math.truncate6(a.jsonObj.rotation)}function d(a,b){this.receiver=a,this.oldValue={x:a.jsonObj.x,y:a.jsonObj.y},this.newValue=b}function e(a,b,c,d){this.receiver=a,this.receiver2=d;var e={pivotX:Math.truncate6(a.jsonObj.pivotX),pivotY:Math.truncate6(a.jsonObj.pivotY)},f={x:Math.truncate6(a.jsonObj.x),y:Math.truncate6(a.jsonObj.y)};this.oldValue={pivot:e,pos:f},b.pivotX=Math.truncate6(b.pivotX),b.pivotY=Math.truncate6(b.pivotY),c.x=Math.truncate6(c.x),c.y=Math.truncate6(c.y),this.newValue={pivot:b,pos:c}}function f(a){this.receiver=TQ.FrameCounter,this.oldValue=TQ.FrameCounter.v,this.newValue=a}function g(a,b){this.receiver=a,this.receiver2=null!=b.parent?b.parent:null,this.oldValue=b,this.newValue=b}var h=a.prototype;h.do=function(){},h.undo=function(){},h.redo=function(){},h.addCommand=function(a){return a},h.removeCommand=function(a){return a},h.getCommand=function(a){return a},inherit(b,a),b.prototype.do=function(){for(var a=0;a<this.commands.length;a++)this.commands[a].do()},b.prototype.redo=function(){for(var a=0;a<this.commands.length;a++)this.commands[a].redo()},b.prototype.undo=function(){for(var a=this.commands.length-1;a>=0;a--)this.commands[a].undo()},b.prototype.addCommand=function(a){this.commands.push(a)},b.prototype.removeCommand=function(a){var b=this.commands.indexOf(a);return 0>b?(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1):null!=this.commands.splice(b,1)},b.prototype.getCommand=function(a){return 0==this.commands.length?(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),null):(a<this.commands.length&&(assertTrue(TQ.Dictionary.INVALID_PARAMETER,!1),a=0),this.commands[a])},b.open=function(){i.__openedComposite||(i.__openedComposite=new b,$(document).mouseup(b.close))},b.close=function(){i.__openedComposite&&(i.addToUndoStack(i.__openedComposite),i.__openedComposite=null)},inherit(c,a),c.prototype.do=function(){return this.receiver.rotateTo(this.newValue),"rotate"+this.receiver},c.prototype.undo=function(){return this.receiver.rotateTo(this.oldValue),"undo rotate"+this.receiver},c.prototype.redo=function(){return this.receiver.rotateTo(this.newValue),"redo rotate"+this.receiver},inherit(d,a),d.prototype.do=function(){return this.receiver.moveTo(this.newValue),"move"+this.receiver},d.prototype.undo=function(){return this.receiver.moveTo(this.oldValue),"undo move"+this.receiver},d.prototype.redo=function(){return this.receiver.moveTo(this.newValue),"redo move"+this.receiver},inherit(e,a),e.prototype.do=function(){return this.receiver.movePivot(this.newValue.pivot,this.newValue.pos,this.receiver2),this.name+this.receiver},e.prototype.undo=function(){return this.receiver.movePivot(this.oldValue.pivot,this.oldValue.pos,this.receiver2),"undo move"+this.receiver},e.prototype.redo=e.prototype.do,inherit(f,a),f.prototype.do=function(){this.receiver.gotoFrame(this.newValue)},f.prototype.undo=function(){this.receiver.gotoFrame(this.oldValue)},f.prototype.redo=f.prototype.do,inherit(g,a),g.prototype.do=function(){this.receiver.deleteElement(this.newValue)},g.prototype.undo=function(){null!=this.receiver2?this.receiver2.undeleteChild(this.oldValue):this.receiver.undeleteElement(this.oldValue)},g.prototype.redo=g.prototype.do;var i={};i.queue=[],i.preferredQueue=[],i.MAX_UNDO_STEP=100,i.lastCmd=null,i.undoStack=[],i.redoStack=[],i.preferredQueue=[],i.isWorking=!1,i._timerID=-1,i._cmdGroupID=0,i._lastCmdGroupID=0,i.invoke=function(){i._timerID=setTimeout(function(){i._runOnce()},0)},i.stop=function(){i._timerID>=0&&clearTimeout(i._timerID),i._timerID=-1},i.addCommand=function(a,b){b?i.preferredQueue.push(a):i.queue.push(a),i.isWorking||i.invoke()},i._getCommand=function(){var a=i.preferredQueue.shift();return null==a?i.queue.shift():a},i.addToUndoStack=function(a){for(;i.undoStack.length>i.MAX_UNDO_STEP;)i.undoStack.shift();var b;null!=(b=i.mergeCommand(i.lastCmd,a))&&(i.undoStack.pop(),a=b),i.undoStack.push(a),i.lastCmd=a,i._lastCmdGroupID=i._cmdGroupID},i.mergeCommand=function(a,b){if(null!=a&&i._lastCmdGroupID==i._cmdGroupID&&a.constructor.name==b.constructor.name){if("DeleteEleCommand"==a.constructor.name||"CompositeCommand"==a.constructor.name)return null;if(JSON.stringify(a.newValue)==JSON.stringify(b.oldValue))return b.oldValue=a.oldValue,b}return null},i.addToRedoStack=function(a){for(;i.redoStack.length>i.MAX_UNDO_STEP;)i.redoStack.shift();i.redoStack.push(a)},i.directDo=function(a){a.do(),"CompositeCommand"==a.constructor.name&&assertTrue(TQ.Dictionary.INVALID_LOGIC,a.commands.length>0),i.__openedComposite?i.__openedComposite.addCommand(a):i.addToUndoStack(a)},i._runOnce=function(){i.isWorking=!0;for(var a=i._getCommand();null!=a;a=i._getCommand())i.directDo(a);i.isWorking=!1},i.undo=function(){if(i.undoStack.length>=1){var a=i.undoStack.pop(),b=a.undo();return i.addToRedoStack(a),b}return null},i.redo=function(){if(i.redoStack.length>=1){var a=i.redoStack.pop(),b=a.redo();return i.addToUndoStack(a),b}return null},i.clear=function(){i.stop(),i.undoStack.splice(0),i.redoStack.splice(0),i.queue.splice(0),i.preferredQueue.splice(0),i.isWorking=!1,i._cmdGroupID=0},i.initialize=function(){i.clear(),$(document).mousedown(function(){i._cmdGroupID++}),TQ.InputMap.registerAction(TQ.InputMap.Z|TQ.InputMap.LEFT_CTRL_FLAG,i.undo),TQ.InputMap.registerAction(TQ.InputMap.Y|TQ.InputMap.LEFT_CTRL_FLAG,i.redo)},TQ.CommandMgr=i,TQ.AbstractCommand=a,TQ.CompositeCommand=b,TQ.MoveCommand=d,TQ.MovePivotCommand=e,TQ.RotateCommand=c,TQ.SetTimeCommand=f,TQ.DeleteEleCommand=g}(),window.TQ=window.TQ||{},function(){function GenCommand(a,b,c,d){fns||GenCommand.initialize(),this.receiver=b,this.newValue=c,this.oldValue=d,this.dofn=fns[a].dofn,this.undofn=fns[a].undofn}var fns=null;GenCommand.SCALE="cmd_scale",GenCommand.MIN_JOINT_ANGLE="cmd_min_joint_angle",GenCommand.MAX_JOINT_ANGLE="cmd_max_joint_angle",GenCommand.CHANGE_LAYER="cmd_change_layer",GenCommand.SET_3D_OBJ="cmd_set_3D_obj",GenCommand.ADD_ITEM="cmd_add_item",GenCommand.initialize=function(){fns=[],fns[GenCommand.SCALE]={dofn:"scaleTo",undofn:"scaleTo"},fns[GenCommand.MIN_JOINT_ANGLE]={dofn:"setMinAngle",undofn:"setMinAngle"},fns[GenCommand.MAX_JOINT_ANGLE]={dofn:"setMaxAngle",undofn:"setMaxAngle"},fns[GenCommand.CHANGE_LAYER]={dofn:"moveZ",undofn:" moveToZ"},fns[GenCommand.SET_3D_OBJ]={dofn:"attachTo",undofn:"detach"},fns[GenCommand.ADD_ITEM]={dofn:"addElementDirect",undofn:"deleteElement"}},inherit(GenCommand,TQ.AbstractCommand),GenCommand.prototype.do=function(){eval("this.receiver."+this.dofn+"(this.newValue)")},GenCommand.prototype.undo=function(){eval("this.receiver."+this.undofn+"(this.oldValue)")},GenCommand.prototype.redo=GenCommand.prototype.do,TQ.GenCommand=GenCommand}(),window.TQ=window.TQ||{},function(){var a=function(){throw"TraceMgr cannot be instantiated"};a.initialize=function(){},a.addNewPosition=function(a){var c=TQ.Utility.worldToDevioce(a.jsonObj.x,a.jsonObj.y);a.trace||(a.trace=new b("#0000FF",2)),a.trace.add(c)},a.removeFromStage=function(a){a.trace&&a.trace.removeFromStage()},a.delete=function(b){b.trace&&(a.removeFromStage(b),b.trace=null)};var b=function(a,b){this.color=a,this.thickness=b,this.shape=new createjs.Shape,this.addToStage(),this.shape.x=0,this.graphics=this.shape.graphics,this.graphics.setStrokeStyle(this.thickness,"round",null,null).beginStroke(this.color),this.lastPt=null,this.shape.uncache(),this.points=[]};b.prototype.add=function(a){return this.lastPt?(this.graphics.moveTo(this.lastPt.x,this.lastPt.y),this.lastPt=a,this.graphics.lineTo(this.lastPt.x,this.lastPt.y),void this.points.push(a)):void(this.lastPt=a)},b.prototype.addToStage=function(){stage.addChild(this.shape)},b.prototype.removeFromStage=function(){stage.removeChild(this.shape)},b.prototype.destory=function(){stage.removeChild(this.shape),this.shape=null,this.graphics=null},b.prototype.toJSON=function(){return{color:this.color,thickness:this.thickness,points:this.points}},b.build=function(a){if(!a.points)return null;for(var c=new b(a.color,a.thickness),d=0;d<a.points.length;d++)c.add(a.points[d]);return a.points=null,c},TQ.TraceMgr=a,TQ.Trace=b}(),window.TQ=window.TQ||{},function(){function a(){assertNotHere(TQ.Dictionary.INVALID_LOGIC)}a.GO=1,a.STOP=0,a.isNew=!0,a.v=0,a.defaultFPS=20,a.max=120*a.defaultFPS,a._FPS=a.defaultFPS,a.BASE_STEP=1,a._step=a.BASE_STEP,a._state=TQ.Config.AutoPlay?a.GO:a.STOP,a._requestState=null,a._autoRewind=!1,a._level=null,a.initialize=function(b,c,d){assertNotNull(TQ.Dictionary.FoundNull,b),assertNotNull(TQ.Dictionary.FoundNull,c),assertNotNull(TQ.Dictionary.FoundNull,d),a.v=b*c,a._FPS=c,a._level=d,a.max=d.getTime(),TQ.InputMap.registerAction(TQ.InputMap.LAST_FRAME_KEY,function(){d.setTime(a.v),a.max=a.v})},a.t=function(){return a.v/a._FPS},a.f2t=function(b){return b/a._FPS},a.t2f=function(b){return b*a._FPS},a.forward=function(){a._step=2*a.BASE_STEP,a._state=a.GO},a.backward=function(){a._step=-2*a.BASE_STEP,a._state=a.GO},a.gotoBeginning=function(){a.gotoFrame(0),TQ.CommandMgr.directDo(new TQ.SetTimeCommand(a.v))},a.gotoEnd=function(){a.gotoFrame(a.max),TQ.CommandMgr.directDo(new TQ.SetTimeCommand(a.v))},a.gotoFrame=function(b){a.v=b,TQ.FrameCounter.isNew=!0},a.goto=function(b){a.gotoFrame(b*a._FPS)},a.update=function(){if(a.updateState(),a._state==a.GO){if(a.hasUIData)return void(a.hasUIData=!1);var b=a._step;a.v=a.v+b,a.v>a.max&&(a.v=a.max),a.v<0&&(a.v=a._autoRewind?a.max:0),TQ.FrameCounter.isNew=!0,assertTrue(TQ.Dictionary.CounterValidation,a.v>=0)}},a.updateState=function(){switch(a._requestState){case null:break;case a.GO:a._step=a.BASE_STEP,a._state=a.GO;break;case a.STOP:a._state=a.STOP}a._requestState=null},a.play=function(){a._requestState=a.GO},a.stop=function(){a._requestState=a.STOP,TQ.CommandMgr.directDo(new TQ.SetTimeCommand(a.v)),TQ.GifManager.isOpen&&(TQ.GifManager.end(),canvas.width=TQ.Config.workingRegionWidth,canvas.height=TQ.Config.workingRegionHeight,$("#testCanvas").show())},a.autoRewind=function(){a._autoRewind=!a._autoRewind},a.isInverse=function(){return a._step<0},a.isPlaying=function(){return a._state==a.GO},a.isRequestedToStop=function(){return a._requestState==a.STOP},a.finished=function(){return a.v>=a.max},a.isAutoRewind=function(){return a._autoRewind},a.maxTime=function(){return a.max/a._FPS},a.reset=function(){a._requestState=null,a.v=0,a._state=TQ.Config.AutoPlay?a.GO:a.STOP},TQ.FrameCounter=a}(),window.TQ=window.TQ||{};var __gGifGenerator=null;!function(){function a(){assertNotHere(TQ.Dictionary.INVALID_LOGIC)}a.isWorking=!1,a.isOpen=!1,a.begin=function(){return a.isWorking?void assertTrue(TQ.Dictionary.INVALID_LOGIC,!1):(__gGifGenerator||(__gGifGenerator=new GIF({workers:"4",quality:"90",repeat:"0",background:"#000000",width:"180",height:"180"})),a.isWorking=!0,void(a.isOpen=!0))},a.end=function(){return a.isOpen?void(__gGifGenerator&&(__gGifGenerator.on("finished",function(b){window.open(TQ.Utility.hasEnv(TQ.Utility.BR_CHROME)?window.webkitURL.createObjectURL(b):window.URL.createObjectURL(b)),__gGifGenerator=null,a.isWorking=!1,TQ.MessageBubble.close()}),__gGifGenerator.render(),a.isOpen=!1,TQ.MessageBubble.show(TQ.Dictionary.IS_PROCESSING))):void assertTrue(TQ.Dictionary.INVALID_LOGIC,!1)},a.addFrame=function(){a.isOpen&&__gGifGenerator&&__gGifGenerator.addFrame(canvas,{copy:!0,delay:20})},TQ.GifManager=a}(),TQ=TQ||{};var TOUCH_MOVING_FLAG=999;!function(){var a={};a.isPresseds=[],a.lastPresseds=[],a.DELETE_KEY=46,a.ERASE_KEY=a.R=82,a.SHOW_ALL_HIDEN_OBJECT_KEY=a.A=65,a.CLONE_Key=a.C=67,a.TEXT_EDIT_KEY=a.E=69,a.GRID_ON_OFF_KEY=a.G=71,a.HIDE_KEY=a.H=72,a.SHOW_KEY=a.S=83,a.ROTATE_KEY=a.Z=90,a.ROTATE_KEY=a.Y=89,a.PLAY_STOP_KEY=a.SPACE=32,a.LAST_FRAME_KEY=a.F7=118,a.LEFT_SHIFT=16,a.LEFT_CTRL=17,a.LEFT_ALT=18,a.EMPTY_SELECTOR=27,a.D0=48,a.D1=49,a.D2=50,a.D3=51,a.D4=52,a.D5=53,a.D6=54,a.D7=55,a.D8=56,a.D9=57,a.LEFT_ARROW=39,a.RIGHT_ARROW=37,a.LEFT_SHIFT_FLAG=4096,a.LEFT_CTRL_FLAG=8192,a.LEFT_ALT_FLAG=16384,a.isMouseDown=!1,a.isTouchMoving=!1,a.toolbarState=a.NO_TOOLBAR_ACTION=null,a._on=!0,a.setToolbarState=function(b){assertNotNull(TQ.Dictionary.FoundNull,b),a.toolbarState=b,TQBase.LevelState.saveOperation(TQBase.LevelState.OP_TOOLBAR)},a.IsOperating=function(){return(a.isTouchMoving||a.isMouseDown)&&null==a.toolbarState},a.maps=[],a.registerAction=function(b,c){a.maps[b]=c},a.restart=function(){a.mouseMoving=!1,a.toolbarState=a.NO_TOOLBAR_ACTION,a.lastPresseds=a.isPresseds,a.isPresseds=[],a.isPresseds[a.Z]=a.lastPresseds[a.Z],a.isPresseds[a.LEFT_SHIFT]=a.lastPresseds[a.LEFT_SHIFT],a.isPresseds[a.LEFT_CTRL]=a.lastPresseds[a.LEFT_CTRL],a.isPresseds[a.LEFT_ALT]=a.lastPresseds[a.LEFT_ALT]},$(document).bind("mousemove touchmove touchcancel",function(b){TQ.Log.info("which:"+b.which+"mousedown:"+a.isMouseDown+" type:"+b.type+"(x,y):"+b.screenX+","+b.screenY),a.mouseMoving=!0,a.updateSpecialKey(b)}),$(document).bind("mouseup touchend",function(b){a._updateMouse(b,!1),a.updateSpecialKey(b)}),$(document).bind("mousedown touchstart",function(b){a._updateMouse(b,!0),a.updateSpecialKey(b)}),$(document).keydown(function(b){if(a._on){a.updateSpecialKey(b);var c=a.maps[a.getCombination(b)];null==c||a.isPresseds[b.which]||(b.stopPropagation(),b.preventDefault(),TQ.TaskMgr.addTask(c,[])),a._updateKey(b,!0)}}),$(document).keyup(function(b){a._on&&(a.updateSpecialKey(b),a._updateKey(b,!1))}),a._updateKey=function(b,c){a.isPresseds[b.which]=c},a._updateMouse=function(b,c){a.isMouseDown=c},a.getCombination=function(b){var c=b.which;return a.isPresseds[a.LEFT_CTRL]&&(c|=a.LEFT_CTRL_FLAG),a.isPresseds[a.LEFT_SHIFT]&&(c|=a.LEFT_SHIFT_FLAG),a.isPresseds[a.LEFT_ALT]&&(c|=a.LEFT_ALT_FLAG),c},a.updateSpecialKey=function(b){a.isPresseds[a.LEFT_CTRL]=b.ctrlKey,a.isPresseds[a.LEFT_SHIFT]=b.shiftKey,a.isPresseds[a.LEFT_ALT]=b.altKey,a.isMouseDown=b.which,a.updateTouch(b)},a.updateTouch=function(b){switch(b.type){case"touchmove":a.isTouchMoving=!0;break;case"touchstart":a.isTouchMoving=!0;break;case"touchend":break;default:a.isTouchMoving=!1}},a.turnOn=function(){TQ.InputMap._on=!0},a.turnOff=function(){TQ.InputMap._on=!1},TQ.InputMap=a}(),window.TQBase=window.TQBase||{},function(){function a(){}a.NOT_INIT=0,a.ISLOADING=1,a.LOADED=2,a.INITING=3,a.RUNNING=4,a.EDITING=5,a.EXIT=6,a.SHOOTING=16,a.PLAYING=17,a.PAUSE=18,a.operation=0,a.OP_TIMER_UI=257,a.OP_TOOLBAR=259,a.OP_TABS=263,a.OP_CANVAS=271,a.OP_FLOATTOOLBAR=287,a.saveOperation=function(b){a.operation=b},a.isOperatingCanvas=function(){return a.operation==a.OP_CANVAS},a.isOperatingTimerUI=function(){return a.operation==a.OP_TIMER_UI},TQBase.LevelState=a}(),window.TQBase=window.TQBase||{},function(){function a(){}a.lastOperationFlag=0,a.do=function(b,c,d,e,f){var g=b.displayObj;if(b.isPinned())return void displayInfo2(TQ.Dictionary.Locked);if(null==g)return void displayInfo2("empty object or deleted, element.TBD = "+b.TBD);if(currScene.isSaved=!1,TQBase.LevelState.saveOperation(TQBase.LevelState.OP_CANVAS),TQ.SkinningCtrl.hasNew);else if(TQ.InputMap.isPresseds[TQ.InputMap.LEFT_SHIFT]||TQ.InputCtrl.vkeyLift)b.setFlag(TQ.Element.ZING),TQ.MoveCtrl.moveZ(b,d,e);else if(b.isJoint()&&!TQ.InputCtrl.inSubobjectMode)b.setFlag(TQ.Element.TRANSLATING),b.setFlag(TQ.Element.ROTATING),a.lastOperationFlag=b.getOperationFlags(),TQ.CompositeCommand.open(),TQ.IKCtrl.do(b,d,e,!1);else if(TQ.InputMap.isPresseds[TQ.InputMap.Z]||TQ.InputCtrl.vkeyRotate)b.setFlag(TQ.Element.ROTATING),a.lastOperationFlag=b.getOperationFlags(),TQ.IKCtrl.do(b,d,e,!0);else if(TQ.InputMap.isPresseds[TQ.InputMap.LEFT_CTRL]||TQ.InputCtrl.vkeyScale)b.setFlag(TQ.Element.SCALING),TQ.InputCtrl.scale(b,g,d,e);else if(TQ.Utility.isMultiTouchEvent(e)&&e.nativeEvent.scale){var h=1+.5*(e.nativeEvent.scale-1);TQ.InputCtrl.doScale(b,h,h)}else b.setFlag(TQ.Element.TRANSLATING),this._move(b,c,d,e),g.isClipPoint&&this._calculateScale(g,c,d,e,f),a.displayClips(g.isClipPoint?f:g);a.lastOperationFlag=b.getOperationFlags(),TQ.Log.out("OP: "+a.lastOperationFlag),b.dirty=!0,b.dirty2=!0,b.isOperating=!0,c.dirty=!0},a._move=function(a,b,c,d){var e=d.stageX+c.x,f=d.stageY+c.y;TQ.CommandMgr.directDo(new TQ.MoveCommand(a,{x:e,y:TQ.Utility.toWorldCoord(f)})),TQ.InputCtrl.leaveTraceOn&&TQ.TraceMgr.addNewPosition(a)},a.displayClips=function(b){if(TQ.Config.DISPLAY_CLIPS){const c=8;if((void 0==a.clipPoints||null==a.clipPoints||void 0==a.clipPoints[0])&&a.generateClips(),!b.isClipPoint)for(var d=b.getHeight(),e=b.getWidth(),f=[{x:0,y:0},{x:0,y:d/2},{x:0,y:d},{x:e/2,y:d},{x:e,y:d},{x:e,y:d/2},{x:e,y:0},{x:e/2,y:0},{x:0,y:0}],g=0;8>g;g++)a.positionIt(a.clipPoints[g],b.x+f[g].x-c,b.y+f[g].y-c)}},a.positionIt=function(a,b,c){void 0!=a.displayObj&&(a.x=a.displayObj.x=b,a.y=a.displayObj.y=c)},a.clipPoints=null,a.generateClips=function(){var b=[{isVis:1,x:10,y:11,ID:0,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:20,y:11,ID:1,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:30,y:11,ID:2,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:40,y:11,ID:3,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:50,y:11,ID:4,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:60,y:11,ID:5,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:70,y:11,ID:6,isClipPoint:!0,src:"sysImages/dragpoint.jpg"},{isVis:1,x:80,y:11,ID:7,isClipPoint:!0,src:"sysImages/dragpoint.jpg"}];a.clipPoints=new Array(8);for(var c=0;8>c;c++)a.clipPoints[c]=currScene.addItem(b[c],b[c].x,b[c].y,1)},a.getClipID=function(a){return a.jsonObj.ID},a._calculateScale=function(a,b,c,d,e){var f=2*(a.x-e.getCenterX())/e.naturalWidth(),g=2*(a.y-e.getCenterY())/e.naturalHeight(),h=this.getClipID(a);switch(h){case 3:e.scaleY=g;break;case 4:e.scaleX=f,e.scaleY=g;break;case 5:e.scaleX=f;break;default:assertNotHere(TQ.Dictionary.INVALID_PARAMETER)}e.jsonObj.scaleX=e.scaleX,e.jsonObj.scaleY=e.scaleY},TQBase.Trsa=a}(),TQ=TQ||{},function(){function a(){this.levels=[],this.onsceneload=null,this.version=a.VER2}a.VER1="V1",a.VER2="V2";var b=a.prototype;TQ.EventHandler.initialize(b),b.filename=null,b.title=null,b.isPreloading=!1,b.currentLevelId=0,b.currentLevel=null,b.overlay=null,b.stage=null,b.isSaved=!1,b.state=TQBase.LevelState.NOT_INIT,b.shooting=function(){this.state=TQBase.LevelState.SHOOTING},b.isUpdating=!1,b.tick=function(){var a=this;TQ.TaskMgr.addTask(function(){a.onTick()},null)},b.onTick=function(){this.state<=TQBase.LevelState.INITING&&this.update(0),this.state<TQBase.LevelState.RUNNING||this.isUpdating||(this.isUpdating=!0,TQ.FrameCounter.update(),TQ.TimerUI.update(),this.update(TQ.FrameCounter.t()),this.overlay&&this.overlay.update(TQ.FrameCounter.t()),this.render(),TQ.GifManager.isOpen&&TQ.GifManager.addFrame(),TQ.InputMap.restart(),TQ.FrameCounter.isNew=!1,this.isUpdating=!1)},b.update=function(b){TQ.SceneEditor.updateMode(),null!=this.currentLevel&&(this.currentLevel.update(b),this.version>=a.VER2&&this.updateTimeTable(),TQ.FrameCounter.finished()&&TQ.FrameCounter.isPlaying()&&(this.isLastLevel()?TQ.FrameCounter.isAutoRewind()?TQ.FrameCounter.isInverse()||a.doReplay():$("#stop").click():this.nextLevel()))},b.updateTimeTable=function(){if(TQ.SceneEditor.isEditMode()){var a=100,b=10;TQ.FrameCounter.v+b>TQ.FrameCounter.max&&(TQ.FrameCounter.max+=a,this.currentLevel.setTime(TQ.FrameCounter.v),$("#maxTimeValue").text(TQ.FrameCounter.max),TQ.TimerUI.body.slider("option","max",TQ.FrameCounter.max))}else TQ.FrameCounter.max=this.currentLevel.getTime();for(var c=0,d=0;d<this.levels.length;d++)this.levels[d].setT0(c),c+=TQ.FrameCounter.t2f(this.levels[d].getTime())},a.doReplay=function(){currScene&&(currScene.stop(),currScene.gotoLevel(0),TQ.FrameCounter.gotoBeginning(),currScene.play())},b.render=function(){stage.update()},b.showLevel=function(){assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.currentLevelId<this.levelNum()),this.currentLevelId=this.currentLevelId<this.levelNum()?this.currentLevelId:0,this.selectLevel(this.currentLevelId),this.currentLevel.show()},b.selectLevel=function(a){this.currentLevelId=a,this.currentLevel=this.getLevel(this.currentLevelId),assertNotNull(TQ.Dictionary.INVALID_LOGIC,this.currentLevel),this.currentLevel.onSelected();var b=this;this.currentLevel.onLevelRunning=function(){b.state=TQBase.LevelState.RUNNING,b.handleEvent("sceneReady")}},b.joint=function(a,b){b?this.currentLevel.unJoint(a):(TQ.InputCtrl.inSubobjectMode||$("#subElementMode").click(),this.currentLevel.joint(a),clearSubjectModeAndMultiSelect()),this.isSaved=!1},b.groupIt=function(a,b){b?this.currentLevel.unGroup(a):(this.currentLevel.groupIt(a),clearSubjectModeAndMultiSelect()),this.isSaved=!1},b.skinning=function(a,b){this.currentLevel.skinning(a,b),this.isSaved=!1},b.addItem=function(a){this.isSaved=!1;var b=this.currentLevel;void 0==a.toOverlay||null==a.toOverlay?void 0!=a.levelID&&(b=this.getLevel(a.levelID)):(assertTrue(TQ.Dictionary.INVALID_PARAMETER+": "+a.toOverlay,1==a.toOverlay),assertTrue("is empty? ",this.overlay),this.overlay&&(b=this.overlay));var c=TQ.Element.build(b,a);assertTrue(TQ.INVALID_LOGIC,c.level==b),c.level=b;var d=this;return TQ.CommandMgr.directDo(new TQ.GenCommand(TQ.GenCommand.ADD_ITEM,d,c,c)),c},b.undeleteElement=function(a){TQ.GarbageCollector.remove(a),a.level=this.currentLevel,this.addElementDirect(a)},b.addElementDirect=function(a){var b=a.level;b.addElementDirect(a),a.hasFlag(TQ.Element.LOADED)&&a.addItemToStage()},b.addText=function(a){return this.isSaved=!1,this.currentLevel.addElement(a)},b.deleteElement=function(a){this.isSaved=!1,assertNotNull(TQ.Dictionary.PleaseSelectOne,a),null!=a&&(this.currentLevel.deleteElement(a),a.isSound()&&TQ.SoundMgr.deleteItem(a))},b.preLevel=function(){this.currentLevelId>0&&this.gotoLevel(this.currentLevelId-1)},b.nextLevel=function(){this.isLastLevel()||this.gotoLevel(this.currentLevelId+1)},b.isLastLevel=function(){return this.currentLevelId+1>=this.levelNum()},b.gotoLevel=function(a){a=a>=this.levelNum()?this.levelNum()-1:a,a=0>a?0:a,null!=this.currentLevel&&(TQ.floatToolbar.show(!1),this.currentLevel.exit(),this.currentLevelId=a),this.showLevel()},b.open=function(b){$("#stop").trigger("click"),this.setEditor(),this.isSaved=!0,initMenu(),TQ.SceneEditor.isEditMode()&&this.reset(),void 0!=this.currentLevel&&null!=this.currentLevel&&(a.stopAux(),this.close()),this.filename=b.name,this.title=null,this.onsceneload=this.showLevel,b.content||b.name!==TQ.Config.UNNAMED_SCENE||(b.content=a.getEmptySceneJSON()),b.content?this._jsonStrToScene(this,b.content,"gameScene"):this.loadFromJson(b.name,"gameScenes"),null==this.overlay&&(this.overlay=new TQ.Overlay({}))},b.reset=function(){a.stopAux(),TQ.FrameCounter.gotoBeginning(),TQ.FrameCounter.isAutoRewind()&&$("#rewind").click(),TQ.TrackRecorder.style==TQ.TrackDecoder.JUMP_INTERPOLATION&&$("#linearMode").click()},b.getLevel=function(a){return a<this.levels.length?this.levels[a]:null},b.getElement=function(a){return assertValid("this.currentLevel",this.currentLevel),this.currentLevel.getElement(a)},b.getAllSounds=function(){if(this.currentLevel)var a=this.currentLevel.getSounds();else a=[];return a},b.findAtom=function(a){return assertValid("this.currentLevel",this.currentLevel),this.currentLevel.findAtom(a)},b.getSelectedElement=function(){assertTrue(TQ.Dictionary.isDepreciated,!1)},b.levelNum=function(){return this.levels.length},b.addLevel=function(a,b){var c=this.levelNum();if(void 0===a&&(a=c),a=TQ.MathExt.range(a,0,c),this.isSaved=!1,!b){var d=c;b=new TQ.Level({name:d})}return this.levels.splice(a,0,b),this.levelNum()-1},b.deleteLevel=function(a){if(0>a||a>=this.levelNum())return void assertTrue(TQ.Dictionary.INVALID_PARAMETER,!1);this.isSaved=!1;var b=this.levels.splice(a,1);return b},b.moveTo=function(a,b){var c=this.deleteLevel(a);b>a&&b--,this.addLevel(b,c)},b.copyTo=function(a,b){var c=this.levels[a];return this.addLevel(b,c)},b.forceToRemoveAll=function(){for(this.stop(),this.close();this.levelNum()>0;)this.deleteLevel(0);this.addLevel(),this.selectLevel(0),this.currentLevel.state=TQBase.LevelState.INITING,this.currentLevel.onLevelCreated(),this.title=TQ.Config.UNNAMED_SCENE,this.state=TQBase.LevelState.NOT_INIT,this.isSaved=!0},b.loadFromJson=function(a,b){!function(c){netOpen(a,function(a){c._jsonStrToScene(c,a,b)})}(this)},b._jsonStrToScene=function(a,b,c){try{b=TQ.Element.upgrade(b);var d=JSON.parse(b)}catch(e){displayInfo2(b),TQ.Log.error(b+". "+e.toString()),d=TQ.Utility.getEmptyScene()}d.alias=null==c?"none":c,d.remote=!0,a._fixedUp(d)},a.removeEmptyLevel=function(a){for(var b=a.levels.length-1;b>=0;b--){var c=a.levels[b];(null==c.elements||c.elements.length<=0)&&(0!=b||a.levels.length>1)&&(this.isSaved=!1,a.levels.splice(b,1))}},b._fixedUp=function(b){TQ.Config.REMOVE_EMPTY_LEVEL_ON&&a.removeEmptyLevel(b),b.currentLevelId>=b.levels.length&&(b.currentLevelId=0),this.version=b.version?b.version:this.filename==TQ.Config.UNNAMED_SCENE?a.VER2:a.VER1,b.currentLevelId=void 0==b.currentLevelId?0:b.currentLevelId,this.currentLevelId=b.currentLevelId,this.currentLevelId=0,this.title=b.title?b.title:null,null==this.title&&(this.title=this.filename);for(var c=b.levels.length,d=0;c>d;d++){var e=b.levels[d];null==e.name&&(e.name=d.toString()),this.levels[d]=new TQ.Level(e),0==d&&!function(a){a.startPreloader(a,0,c)}(this)}if(0===c){assertTrue(TQ.Dictionary.INVALID_LOGIC,!1);var e=null;this.levels[0]=new TQ.Level(e)}console.info(b.remote?b.alias+" has been added to the scene [Remote]":b.alias+" has been added to the scene [Local]"),void 0!=this.onsceneload&&null!=this.onsceneload&&this.onsceneload(),displayInfo2(TQ.Dictionary.Load+"<"+this.title+">.")},b.setEditor=function(){TQ.SceneEditor.isEditMode()?$("#playRecord").click():TQ.SceneEditor.isPlayMode()?TQ.WCY.isPlayOnly?TQ.WCY.doStopRecord():$("#stopRecord").click():assertTrue(TQ.Dictionary.INVALID_LOGIC,!1)},b.startPreloader=function(a,b,c){c>b&&(a.levels[b].setupPreloader(),TQ.RM.onCompleteOnce(function(){a.levels[b].resourceReady=!0,console.log(b+" level resource OK!"),b++,c>b&&a.startPreloader(a,b,c)}))},b.save=function(b,c){a.stopAux(),this.currentLevel.exit();var d=this.currentLevel,e=this.overlay;this.currentLevel=null,this.overlay=null;for(var f=0;f<this.levelNum();f++)this.levels[f].prepareForJSONOut();this.title=b,TQ.MessageBubble.counter=0,netSave(this.title,this,c),TQ.ScreenShot.SaveScreen(this.title,c),this.currentLevel=d,this.overlay=e,this.afterToJSON(),this.showLevel(),this.isSaved=!0},b.afterToJSON=function(){for(var a=0;a<this.levelNum();a++)this.levels[a].afterToJSON()},b.toJSON=function(){var a={};return a.levels=this.levels,a.version=this.version,a.currentLevelId=this.currentLevelId,a.title=this.title,a},b.getData=function(){for(var a=0;a<this.levelNum();a++)this.levels[a].prepareForJSONOut();var b=JSON.stringify(this);return this.afterToJSON(),b},b.close=function(){return this.isSaved?(null!=this.currentLevel&&(TQ.RM.reset(),TQ.SoundMgr.close(),TQ.TextEditor.onNo(),this.currentLevel.exit(),this.currentLevel.delete(),this.currentLevel=null),this.levels=[],this.currentLevel=null,this.currentLevelId=0,this.onsceneload=null,!0):!1},b.toGlobalTime=function(a){return this.currentLevel?a+this.currentLevel.getT0():(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),a)},b.stop=function(){this.currentLevel&&this.currentLevel.stop(),TQ.FrameCounter.stop(),TQ.SoundMgr.pause(),TQ.SnowEffect.stop(),TQ.RainEffect.stop()},b.play=function(){TQ.floatToolbar.show(!1),TQ.FrameCounter.play(),TQ.SoundMgr.resume(),this.currentLevel&&this.currentLevel.play()},a.stopAux=function(){TQ.FrameCounter.isPlaying()&&$("#stop").click()},a.getEmptySceneJSON=function(){var a={levels:[{jsonElements:null,FPS:20,_t:0,elements:null,name:"0",itemCounter:8,dataReady:!0,state:6,isWaitingForShow:!1,isDirty:!1,dirty:!0}],overlay:null,currentLevelId:0,currentLevel:null,state:4,isUpdating:!1};
return JSON.stringify(a)},TQ.Scene=a}(),window.TQ=window.TQ||{},function(){function a(a){this.latestElement=null,this.tMaxFrame=200,this.t0=0,this.resourceReady=!1,this.initialize(a)}var b=a.prototype;b.isDirty=!1,b.isPreloading=!1,b.initialize=function(a){a=a?a:{},a.elements=a.elements?a.elements:[],this.elements=a.elements,this.FPS=a.FPS?a.FPS:TQ.FrameCounter.defaultFPS,this.tMaxFrame=a.tMaxFrame?a.tMaxFrame:this.tMaxFrame,this._t=a._t?a._t:0,this.setupTimer(),assertNotNull(TQ.Dictionary.FoundNull,a.name),this.name=a.name,this.itemCounter=0,this.dataReady=!1,this.state=TQBase.LevelState.NOT_INIT,this.isWaitingForShow=!1,this.dirtyZ=!1},b.onSelected=function(){TQ.FrameCounter.initialize(this._t,this.FPS,this),TQ.TimerUI.initialize()},b.itemNum=function(){return assertDepreciated(TQ.Dictionary.isDepreciated),this.elements.length},b.atomNum=function(){for(var a=0,b=0;b<this.elements.length;b++)assertNotNull(TQ.Dictionary.FoundNull,this.elements[b]),a+=this.elements[b].atomNum();return a},b.joint=function(a){if(assertTrue(TQ.Dictionary.INVALID_LOGIC,TQ.InputCtrl.inSubobjectMode),a.length<2)return null;var b=a[0];b.isJoint()||b.setFlag(TQ.Element.ROOT_JOINT);for(var c=1;c<a.length;c++)this.pickOffChild(a[c]),b.addJoint(a[c]),b=a[c]},b.unJoint=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;null!=d&&(assertTrue(TQ.Dictionary.INVALID_PARAMETER,null!=d),d.removeChild(c),c.clearFlag(TQ.Element.JOINTED),this.addElementDirect(c));for(var e=c.children.length,f=0;e>f;f++){var g=c.removeChild(c.children[0]);this.addElementDirect(g),this.unJoint([g])}c.clearFlag(TQ.Element.JOINTED),c.clearFlag(TQ.Element.ROOT_JOINT)}},b.groupIt=function(a){TQ.Log.out("Group it");var b={x:a[0].jsonObj.x,y:a[0].jsonObj.y,type:"Group"},c=this.addElement(b);c.update(TQ.FrameCounter.t());for(var d=0;d<a.length;d++)this.pickOffChild(a[d]),c.addChild(a[d]);this.latestElement=c,this.dirtyZ=!0},b.unGroup=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c.isJoint()&&!c.hasFlag(TQ.Element.ROOT_JOINT)&&(c.isVirtualObject()||(c=c.parent),null!=c&&c.isVirtualObject())){for(;c.children.length>0;){var d=c.removeChild(c.children[0]);this.addElementDirect(d)}this.deleteElement(c)}}this.dirtyZ=!0},b.cloneElement=function(b){for(var c=0;c<b.length;c++){b[c].persist();var d=JSON.parse(JSON.stringify(b[c].jsonObj));a.removeMarker(d),null==b[c].parent?this.addElementDirect(TQ.Element.build(this,d)):b[c].parent.addChild(d)}this.dirtyZ=!0},a.removeMarker=function(a){if(a.children)for(var b=0;b<a.children.length;b++)if("JointMarker"==a.children[b].type){a.children.splice(b,1);break}},b.skinning=function(a,b){assertNotNull(TQ.Dictionary.FoundNull,a),assertNotNull(TQ.Dictionary.FoundNull,b),a.skinning(b)},b.findAtom=function(a){for(var b=null,c=0;c<this.elements.length;c++){if(null!=this.elements[c].displayObj&&void 0!=this.elements[c].displayObj.id&&this.elements[c].displayObj.id==a.id)return b=this.elements[c];if(b=this.elements[c].findChild(a),null!=b){TQ.InputCtrl.inSubobjectMode||b.isJoint()||(b=this.elements[c]);break}}return b},b.pickOffChild=function(a){assertNotNull(TQ.Dictionary.PleaseSelectOne,a);var b=this.elements.indexOf(a);if(b>=0)this.removeElementAt(b);else{var c=a.parent;assertTrue(TQ.Dictionary.FoundNull,null!=c),c&&c.removeChild(a)}return a},b.addElement=function(a){var b=TQ.Element.build(this,a);return this.addElementDirect(b)},b.addElementDirect=function(a){return assertNotNull(TQ.Dictionary.FoundNull,a),this.elements.push(a),this.isDirty=!0,a},b.deleteElementAt=function(a){var b=this.removeElementAt(a);return null!=b&&(b.removeFromStage(),TQ.GarbageCollector.add(b)),b},b.removeElementAt=function(a){return assertTrue(TQ.Dictionary.INVALID_PARAMETER,a>=0&&a<this.elements.length),this.elements.splice(a,1)[0]},b.getElement=function(a){return this.elements.length<=0?(assertFalse(TQ.Dictionary.INVALID_LOGIC,!1),null):(assertTrue("id < (this.elements.length)",a<this.elements.length),a=0>a?0:a,a=a>=this.elements.length-1?this.elements.length-1:a,this.elements[a])},b.getSounds=function(){var a=[];if(this.resourceReady)for(var b=this.elements.length,c=0;b>c&&this.elements[c].isSound;c++)this.elements[c].isSound()&&a.push(this.elements[c]);return a},b.setDisplaceX=function(){assertNotHere(TQ.Dictionary.isDepreciated)},b.onLoaded=function(){this.state=TQBase.LevelState.LOADED,this.build(),this.isWaitingForShow&&(TQ.Log.info("onLoaded"+this.name),this.show())},b.show=function(){TQ.Log.info("show level :"+this.name),this.dataReady?(TQ.Log.info("data ready"),this.isWaitingForShow=!1,this.onLevelCreated()):(TQ.Log.info("data ready: NO"),this.isWaitingForShow=!0)},b.build=function(){if(!this.dataReady){this.itemCounter=0;var a=this.elements;this.elements=[];for(var b=0;b<(null!=a&&a.length);b++)a[b]&&this.addElementDirect(TQ.Element.build(this,a[b]));this.state=TQBase.LevelState.INITING,TQ.SoundMgr.start(),a=null,this.dataReady=!0}},b.fixupButtons=function(){for(var a=0;a<this.elements.length;a++){var b=this.elements[a];void 0!=b.isButton&&b.isButton()&&b.buildLinks()}},b.findByDescID=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.jsonObj.id==a)return c}return null},b.setupPreloader=function(){if(!this.hasSentToRM){this.hasSentToRM=!0;for(var a=this.elements,b=0;b<(null!=a&&a.length);b++)TQ.RM.addElementDesc(a[b])}},b.addAllItems=function(){TQ.StageBuffer.open();for(var a=this.elements.length,b=0;a>b;b++)this.elements[b].addItemToStage();TQ.StageBuffer.close(),this.state=TQ.SceneEditor.getMode()},b.addLastItems=function(){assertDepreciated(TQ.Dictionary.isDepreciated),assertTrue(TQ.Dictionary.isDepreciated,!1)},b.hitTest=function(){for(var a=0;a<this.itemNum();a++){var b=this.elements[a].displayObj;b.hitTest(stage.mouseX,stage.mouseY)&&(b.alpha=.5,stage.update())}},b.onLevelRunning=null,b.onLevelCreated=function(){this.state==TQBase.LevelState.INITING||this.state==TQBase.LevelState.LOADED||this.state==TQBase.LevelState.EXIT?(this.setupTimer(),this.addAllItems(),this.update(this._t),stage.update(),this.watchRestart(),this.state=TQ.SceneEditor.getMode(),null!=this.onLevelRunning&&this.onLevelRunning()):assertNotHere(TQ.Dictionary.CurrentState+this.state)},b.watchRestart=function(){stage.update()},b.update=function(a){if(this.updateState(),this.dataReady){this._t=a;for(var b=0;b<this.elements.length;++b)if(this.elements[b].TBD){var c=this.elements[b];this.elements[b].TBD=void 0,TQ.CommandMgr.directDo(new TQ.DeleteEleCommand(currScene,c)),b--}else this.elements[b].update(a);this.isDirty&&stage.update(),this.dirtyZ&&this.persist(),this.dirtyZ=!1,this.isDirty=!1}},b.updateState=function(){TQ.Log.info("update state"),this.state<=TQBase.LevelState.INITING&&(this.resourceReady||TQ.RM.isEmpty)&&this.onLoaded()},b._removeAllItems=function(){for(var a=0;a<this.elements.length;a++)this.elements[a].removeFromStage()},b.delete=function(){(this.state===TQBase.LevelState.EDITING||this.state===TQBase.LevelState.RUNNING)&&this._removeAllItems()},b.deleteElement=function(a){for(var b=!1,c=0;c<this.elements.length;c++){if(this.elements[c]==a){this.deleteElementAt(c),b=!0;break}if(1==this.elements[c].deleteChild(a)){b=!0;break}}return b?(this.isDirty=!0,!0):(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1)},b.stop=function(){for(var a=0;a<this.elements.length;a++)this.elements[a].stop()},b.play=function(){for(var a=0;a<this.elements.length;a++)this.elements[a].play()},b.exit=function(){TQ.SelectSet.clear(),this.state===TQBase.LevelState.EDITING||this.state===TQBase.LevelState.RUNNING?(this.sort(),this._removeAllItems()):console.log("is loading, or not loaded!"),TQ.SoundMgr.removeAll(),this.state=TQBase.LevelState.EXIT},b.prepareForJSONOut=function(){},b.afterToJSON=function(){if(this.dataReady)for(var a=0;a<this.elements.length;a++)this.elements[a].afterToJSON()},b.persist=function(){for(var a=0;a<this.elements.length;a++)this.elements[a].persist()},b.sort=function(){assertNotNull(this.elements),this.persist(),this.elements.sort(TQ.Element.compare);for(var a=0;a<this.elements.length;a++)this.elements[a].sort()},b.onItemLoaded=function(a){this.itemCounter++,(this.state==TQBase.LevelState.EDITING||this.state==TQBase.LevelState.RUNNING)&&(TQ.Log.out(TQ.Dictionary.isDepreciated),a.addItemToStage())},b.setupTimer=function(){TQ.FrameCounter.isPlaying()&&(this._t=0,TQ.FrameCounter.gotoBeginning())},b.calculateLastFrame=function(){if(!this.dataReady)return this.tMaxFrame;for(var a=0,b=0;b<this.elements.length;b++)assertNotNull(TQ.Dictionary.FoundNull,this.elements[b]),this.elements[b].calculateLastFrame?a=Math.max(a,this.elements[b].calculateLastFrame()):assertTrue(TQ.Dictionary.INVALID_LOGIC,!1);return this.tMaxFrame=20*a,a},b.setTime=function(a){this.tMaxFrame=a},b.getTime=function(){return this.tMaxFrame},b.setT0=function(a){this.t0=a},b.getT0=function(){return this.t0},TQ.Level=a}(),window.TQ=window.TQ||{},function(){function a(a){this.initialize(a)}var b=a.prototype=new TQ.Level;b.Level_update=b.update,b.Level_initialize=b.initialize,b.initialize=function(a){this.Level_initialize(a),this.show()},b.update=function(a){this.Level_update(a),this.hideClipPoint(null==stage.selectedItem?!0:!1)},b.hideClipPoint=function(a){for(var b=0;b<this.elements.length;++b)this.elements[b].isClipPoint()&&void 0!=this.elements[b].displayObj&&this.elements[b].show(a)},TQ.Overlay=a}(),window.TQ=window.TQ||{},function(){function a(a){this.messageField=new createjs.Text("","bold 24px Arial","#FF0000"),this.messageField.maxWidth=1e3,this.messageField.textAlign="center",this.messageField.x=a.width/3,this.messageField.y=a.height/3,this.messageField.visible=!1,stage.addChild(this.messageField)}a.prototype.show=function(a){stage.contains(this.messageField)||stage.addChild(this.messageField),this.messageField.text=a,this.messageField.visible||(this.messageField.visible=!0)},a.prototype.hide=function(){this.messageField.visible=!1,stage.removeChild(this.messageField)},TQ.MessageBox=a}(),TQ=TQ||{},function(){function a(){}a.started=!1,a.isSupported=!1,a.items=[],a.initialize=function(){a.isSupported=!0},a.start=function(){a.isSupported&&(a.started=!0)},a._auditioningInstance=null,a.isPlaying=function(a){return a?a.playState==createjs.Sound.PLAY_SUCCEEDED:!1},a.play=function(b){if(a.isSupported){TQ.Log.info("start to play "+b);var c=TQ.RM.getResource(b);c?(a._auditioningInstance&&a.isPlaying(a._auditioningInstance)&&a._auditioningInstance.stop(),a._auditioningInstance=createjs.Sound.play(TQ.RM.getID(c))):TQ.RM.addItem(b,function(){a.play(b)})}},a.stop=function(a){createjs.Sound.stop(a)},a.addItem=function(b){a.items.indexOf(b)>=0||a.items.push(b)},a.deleteItem=function(b){var c=a.items.indexOf(b);c>=0&&a.items.splice(c,1)},a.pause=function(){for(var b=a.items.length;b--;)a.items[b].pause()},a.resume=function(){for(var b=TQ.FrameCounter.t(),c=0;c<a.items.length;c++){var d=a.items[c];if(d.isMultiScene){var e=currScene.toGlobalTime(b);d.resume(e)}else d.resume(b)}},a.stopAll=function(){for(var b=0;b<a.items.length;b++){var c=a.items[b];c.stop()}a._auditioningInstance&&a._auditioningInstance.stop()},a.removeAll=function(){for(var b=a.items.length-1;b>=0;b--){var c=a.items[b];c.isMultiScene||a.items.splice(b,1)}},a.close=function(){a.isSupported&&(a.stopAll(),a.removeAll(),a.items.splice(0),a.started=!1)},TQ.SoundMgr=a}(),window.TQ=window.TQ||{},function(){var a=function(){};a.isBatchMode=!0,a.members=[],a.open=function(){a.isBatchMode=!0},a.close=function(){a.flush(),a.isBatchMode=!1},a.findUpperBoundary=function(a){return currScene&&currScene.currentLevel&&currScene.currentLevel.elements?-1==a?null:TQ.MathExt.findUpperBoundary(currScene.currentLevel.elements,a):null},a.add=function(b){if(a.isBatchMode)a.members.push(b);else{var c=a.findUpperBoundary(b.jsonObj.zIndex);b._doAddItemToStage(c)}},a.flush=function(){assertTrue(TQ.Dictionary.MustBeBatchMode,a.isBatchMode),a.members.sort(TQ.Element.compare);for(var b=0;b<a.members.length;b++){var c=a.members[b],d=a.findUpperBoundary(c.jsonObj.zIndex);c._doAddItemToStage(d)}a.members.splice(0)},TQ.StageBuffer=a}(),window.TQ=window.TQ||{},function(){function a(){}var b={};b.x=0,b.y=0,b.sx=1,b.sy=1,b.rotation=0,b.M=TQ.Matrix2D.I(),b.IM=TQ.Matrix2D.I();var c={};a.x=c.x=0,a.y=c.y=0,a.rotation=c.rotation=0,a.sx=c.sx=1,a.sy=c.sy=1,a.visible=c.visible=1,a.action=c.action="idle",a._parentPoseWorld=null,a._toWorldCoordinate=function(c,d){null==d&&(d=b);var e=TQ.Matrix2D.transformation(a.x,a.y,a.rotation,a.sx,a.sy);c.M=d.M.multiply(e),c.IM=null;var f=d.M.multiply($V([a.x,a.y,1]));c.x=f.elements[0],c.y=f.elements[1],(f.elements[2]<.99||f.elements[2]>1.01)&&assertEqualsDelta(TQ.Dictionary.INVALID_PARAMETER,1,f.elements[2],.01),c.rotation=d.rotation+a.rotation,c.sx=d.sx*a.sx,c.sy=d.sy*a.sy,c.isVis=a.visible},a.worldToObject=function(c,d){null==d&&(d=b),void 0==d.IM&&(assertValid(TQ.Dictionary.ParentMatrixFromLastIteration,d.M),d.IM=d.M.inverse()),assertValid(TQ.Dictionary.ParentMatrixFromLastIteration,d.IM);var e=d.IM.multiply($V([c.x,c.y,1]));a.x=e.elements[0],a.y=e.elements[1],(e.elements[2]<.99||e.elements[2]>1.01)&&assertEqualsDelta(TQ.Dictionary.INVALID_PARAMETER,1,e.elements[2],.01),a._parentPoseWorld=d},a.worldToObjectExt=function(b,c){a.worldToObject(b,c),c=a._parentPoseWorld,a.rotation=b.rotation-c.rotation,a.sx=b.sx/c.sx,a.sy=b.sy/c.sy;var d=TQ.Matrix2D.transformation(a.x,a.y,a.rotation,a.sx,a.sy);b.M=c.M.multiply(d),b.IM=b.M.inverse(),assertNotNull(b.IM),a.visible=b.isVis},TQ.poseDefault=c,TQ.Pose=a}(),window.TQ=window.TQ||{},function(){function a(a){(void 0==a||null==a)&&(a=0),this.initialize(a)}var b=a.prototype;b.t=[],b.value=[],b.c=[],b.initialize=function(a){var b=TQ.FrameCounter.t();void 0==a.value||null==a.value?(this.t=[b],this.value=[a],this.c=[1]):(this.t=a.t,this.value=a.value,this.c=a.c),this.tid1=void 0==a.tid1?0:a.tid1,this.tid2=void 0==a.tid2?0:a.tid2},b.erase=function(){assertEqualsDelta("t == 0",0,TQ.FrameCounter.t(),.001),this.initialize(this.value[0])},b.reset=function(){this.t=[this.t[0]],this.value=[this.value[0]],this.c=[1],this.tid1=0,this.tid2=0},TQ.OneTrack=a}(),TQ=TQ||{},function(){function a(a){this.initialize(a)}var b=a.prototype;b.erase=function(){this.x&&this.x.erase(),this.y&&this.y.erase(),this.rotation&&this.rotation.erase(),this.sx&&this.sx.erase(),this.sy&&this.sy.erase(),this.visible&&this.visible.erase()},b.initialize=function(a){assertNotNull(TQ.Dictionary.FoundNull,a),assertNotNull(TQ.Dictionary.FoundNull,a.x),assertNotNull(TQ.Dictionary.FoundNull,a.y),assertNotNull(TQ.Dictionary.FoundNull,a.rotation),assertNotNull(TQ.Dictionary.FoundNull,a.sx),assertNotNull(TQ.Dictionary.FoundNull,a.sy),this.x=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.x||null==a.animeTrack.x?a.x:a.animeTrack.x),this.y=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.y||null==a.animeTrack.y?a.y:a.animeTrack.y),this.rotation=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.rotation||null==a.animeTrack.rotation?a.rotation:a.animeTrack.rotation),this.sx=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.sx||null==a.animeTrack.sx?a.sx:a.animeTrack.sx),this.sy=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.sy||null==a.animeTrack.sy?a.sy:a.animeTrack.sy),this.visible=new TQ.OneTrack(void 0==a.animeTrack||null==a.animeTrack||void 0==a.animeTrack.visible||null==a.animeTrack.visible?a.isVis:a.animeTrack.visible),a.animeTrack&&a.animeTrack.action&&(this.action=new TQ.OneTrack(a.animeTrack.action))},a.validate=function(b){a._validateOne(b.x),a._validateOne(b.y),a._validateOne(b.rotation),a._validateOne(b.sx),a._validateOne(b.sy),a._validateOne(b.visible)},a._validateOne=function(a){a.tid1=void 0==a.tid1?0:a.tid1,a.tid2=void 0==a.tid2?0:a.tid2},a.calculateLastFrame=function(a){assertTrue(TQ.Dictionary.INVALID_LOGIC,!!a);var b=0;return b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.x)),b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.y)),b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.sx)),b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.sy)),b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.rotation)),b=Math.max(b,TQ.TrackDecoder.calculateLastFrame(a.visible))},a.hideToNow=function(a,b){TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,0,!1,TQ.TrackDecoder.JUMP_INTERPOLATION),TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,b,!0,TQ.TrackDecoder.JUMP_INTERPOLATION)},a.hide=function(a,b){TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,0,!1,TQ.TrackDecoder.JUMP_INTERPOLATION),TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,b,!1,TQ.TrackDecoder.JUMP_INTERPOLATION)},a.unHide=function(a,b){TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,0,!1,TQ.TrackDecoder.JUMP_INTERPOLATION),TQ.TrackRecorder.recordOneTrack(a.animeTrack.visible,b,!0,TQ.TrackDecoder.JUMP_INTERPOLATION)},a.setButton=function(b,c){var d=.15;b.animeTrack.visible.reset(),a.hideToNow(b,c),TQ.TrackRecorder.recordOneTrack(b.animeTrack.visible,c+d,!1,TQ.TrackDecoder.JUMP_INTERPOLATION)},TQ.AnimeTrack=a}(),window.TQ=window.TQ||{},function(){function a(){}a.LINE_INTERPOLATION=1,a.JUMP_INTERPOLATION=0,a.calculate=function(b,c,d){TQ.Pose.rotation=void 0==b.rotation||null==b.rotation?TQ.poseDefault.rotation:a.calOneTrack(b.rotation,d),TQ.Pose.x=void 0==b.x||null==b.x?TQ.poseDefault.x:a.calOneTrack(b.x,d),TQ.Pose.y=void 0==b.y||null==b.y?TQ.poseDefault.y:a.calOneTrack(b.y,d),TQ.Pose.sx=void 0==b.sx||null==b.sx?TQ.poseDefault.sx:a.calOneTrack(b.sx,d),TQ.Pose.sy=void 0==b.sy||null==b.sy?TQ.poseDefault.sy:a.calOneTrack(b.sy,d),TQ.Pose.visible=void 0==b.visible||null==b.visible?TQ.poseDefault.visible:a.calOneTrack(b.visible,d)},a.calOneTrack=function(b,c){if(a.searchInterval(c,b),b.tid1==b.tid2)return b.value[b.tid1];var d=b.t[b.tid1],e=b.t[b.tid2],f=b.value[b.tid1],g=b.value[b.tid2],h=f;return d>e?(TQ.Log.out("Data Error, Skip t="+c+" t1="+d+" t2 = "+e+" id1="+b.tid1+" tid2="+b.tid2),f):h=d>=c?f:c>=e?g:b.c[b.tid2]==a.LINE_INTERPOLATION?(c-d)*(f-g)/(d-e)+f:f},a.searchInterval=function(a,b){if(assertValid(TQ.Dictionary.INVALID_PARAMETER,b.tid1),b.t.length<=1)return assertTrue(TQ.Dictionary.INVALID_PARAMETER,0==b.tid1),void(b.tid1=b.tid2=0);var c=b.tid1;if(a<b.t[c])for(;a<=b.t[c];c--)if(0>=c){c=0;break}var d=TQ.MathExt.range(c+1,0,b.t.length-1);if(a>b.t[d])for(;a>b.t[d];d++)if(b.t[c]>b.t[d],d>=b.t.length-1){d=b.t.length-1;break}c=TQ.MathExt.range(d-1,0,b.t.length-1),b.t[c]>b.t[d]&&(d=c),b.tid1=c,b.tid2=d},a.calculateLastFrame=function(a){var b=0;if(!a||!a.t)return b;var c=a.t.length;if(b=a.t[0],c>1)for(var d=1;c>d;d++)assertTrue(TQ.Dictionary.INVALID_LOGIC,b<=a.t[d]),b=Math.max(b,a.t[d]);return b=a.t[c-1]},TQ.TrackDecoder=a}(),window.TQ=window.TQ||{},function(){function a(){}a.style=TQ.TrackDecoder.LINE_INTERPOLATION,a.initialize=function(){},a.record=function(b,c){var d=b.animeTrack,e=b.jsonObj;(void 0==d||null==d)&&(d=b.animeTrack=new TQ.AnimeTrack(e),assertNotUndefined(TQ.Dictionary.FoundNull,d)),(void 0==d.rotation||null==d.rotation)&&assertNotUndefined(TQ.Dictionary.FoundNull,d.tid1),void 0==d.rotation||null==d.rotation?d.rotation=new TQ.OneTrack(TQ.Pose.rotation):b.hasFlag(TQ.Element.ROTATING)&&a.recordOneTrack(d.rotation,c,TQ.Pose.rotation,a.style),void 0==d.x||null==d.x?new TQ.OneTrack(TQ.Pose.x):b.hasFlag(TQ.Element.TRANSLATING)&&(!b.isJoint()||TQ.InputCtrl.inSubobjectMode)&&a.recordOneTrack(d.x,c,TQ.Pose.x,a.style),void 0==d.y||null==d.y?new TQ.OneTrack(TQ.Pose.y):b.hasFlag(TQ.Element.TRANSLATING)&&(!b.isJoint()||TQ.InputCtrl.inSubobjectMode)&&a.recordOneTrack(d.y,c,TQ.Pose.y,a.style),void 0==d.sx||null==d.sx?d.sx=new TQ.OneTrack(TQ.Pose.sx):b.hasFlag(TQ.Element.SCALING)&&(!b.isJoint()||TQ.InputCtrl.inSubobjectMode)&&a.recordOneTrack(d.sx,c,TQ.Pose.sx,a.style),void 0==d.sy||null==d.sy?d.sy=new TQ.OneTrack(TQ.Pose.sy):b.hasFlag(TQ.Element.SCALING)&&(!b.isJoint()||TQ.InputCtrl.inSubobjectMode)&&a.recordOneTrack(d.sy,c,TQ.Pose.sy,a.style),void 0==d.visible||null==d.visible?d.visible=new TQ.OneTrack(TQ.Pose.visible):b.hasFlag(TQ.Element.VISIBLE_CHANGED)&&(a.recordOneTrack(d.visible,c,TQ.Pose.visible,TQ.TrackDecoder.JUMP_INTERPOLATION),b.clearFlag(TQ.Element.VISIBLE_CHANGED)),b.clearFlag(TQ.Element.TRANSLATING|TQ.Element.ROTATING|TQ.Element.SCALING|TQ.Element.ALPHAING|TQ.Element.ZING|TQ.Element.VISIBLE_CHANGED)},a.erase=function(a){a.animeTrack.erase()},a.recordOneTrack=function(a,b,c,d){assertNotNull(TQ.Dictionary.FoundNull,a),assertNotUndefined(TQ.Dictionary.FoundNull,a.tid1),assertNotNull(TQ.Dictionary.FoundNull,a.tid1),d=null==d?TQ.TrackDecoder.LINE_INTERPOLATION:d,TQ.TrackDecoder.searchInterval(b,a);var e=a.tid1,f=a.tid2,g=.01,h=!1;if(Math.abs(b-a.t[e])<g?(i=e,h=!0):Math.abs(b-a.t[f])<g&&(i=f,h=!0),h)return a.value[i]=c,a.c[i]=d,c;var i=f;return b>=a.t[f]?i=f+1:b<a.t[e]&&(i=e),a.t.splice(i,0,b),a.c.splice(i,0,d),a.value.splice(i,0,c),c},TQ.TrackRecorder=a}(),window.TQ=window.TQ||{},function(){function a(){}a.calculate=function(b,c){return TQ.Pose.action=b.action?TQ.TrackDecoder.calOneTrack(b.action,c):TQ.poseDefault.action,TQ.Pose.action||(assertTrue(TQ.Dictionary.INVALID_LOGIC,TQ.Pose.action),TQ.Pose.action=a._findValidName(b.action.value)),TQ.Pose.action},a._findValidName=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b]},TQ.ActionDecoder=a}(),window.TQ=window.TQ||{},function(){function a(){}a.style=TQ.TrackDecoder.LINE_INTERPOLATION,a.initialize=function(){},a.record=function(a,b,c){var d=a.animeTrack,e=a.jsonObj;return b?((void 0==d||null==d)&&(d=a.animeTrack=new TQ.AnimeTrack(e),assertNotUndefined(TQ.Dictionary.FoundNull,d)),void(d.action?a.hasFlag(TQ.Element.ACTION_CHANGED)&&(TQ.TrackRecorder.recordOneTrack(d.action,c,b,TQ.TrackDecoder.JUMP_INTERPOLATION),a.clearFlag(TQ.Element.ACTION_CHANGED)):d.action=new TQ.OneTrack(b))):void assertFalse(TQ.Dictionary.INVALID_LOGIC,!b)},TQ.ActionRecorder=a}(),TQ=TQ||{},function(){function a(b,c,d,e,f){assertTrue(TQ.Dictionary.INVALID_PARAMETER,d>=c),assertFalse(TQ.Dictionary.INVALID_PARAMETER,!f),this.name=b,this.fs=c,this.F=d-c,this.n=0,this.style=e,this.state=a.STOP,this.gifIconID=f}a.STOP=0,a.PLAYING=1,a.STYLE_REPEAT=-1,a.STYLE_1=1;var b=a.prototype;b.play=function(b){this.tc=b,this.state=a.PLAYING,this.T=TQ.FrameCounter.f2t(this.F),this.ts=TQ.FrameCounter.f2t(this.fs),this.tcn=this.tc+this.n*this.T,this.te=this.tcn+this.T},b.tMapping=function(b){return(b<this.tcn||b>this.te)&&(this.style==a.STYLE_REPEAT?this.T>0?(this.n=Math.floor((b-this.tc)/this.T),b<this.tc&&(this.n-=1),this.tcn=this.tc+this.n*this.T,this.te=this.tcn+this.T):(this.tcn=b,this.te=b):b=TQ.MathExt.range(b,this.tcn,this.te)),assertTrue(TQ.Dictionary.INVALID_PARAMETER,b>=this.tcn),this.ts+(b-this.tcn)},b.stop=function(){this.state=a.STOP},b.isPlaying=function(){return this.state==a.PLAYING},TQ.Action=a}(),TQ=TQ||{},function(){function a(a){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof a),this.currentAction=null,this.actionTable=[],this.fixedUp(a)}var b=a.prototype;a.unitTest=function(a){a.addAction("idle",1,50,TQ.Action.STYLE_REPEAT),a.addAction("work",60,120,TQ.Action.STYLE_REPEAT),a.addAction("run",130,150,TQ.Action.STYLE_REPEAT),a.addAction("smile",160,180,TQ.Action.STYLE_1),a.addAction("stand",181,200,TQ.Action.STYLE_1)},b.fixedUp=function(a){if(null!=a&&null!=a.actionTable)for(var b=0;b<a.actionTable.length;b++){var c=a.actionTable[b],d=Number(c.fs),e=d+Number(c.F);c.gifIconID||(c.gifIconID=TQ.Utility.getDefultActionIcon()),this.addAction(new TQ.Action(c.name,d,e,c.style,c.gifIconID))}},b.play=function(a){this.currentAction=this._findAction(a),this.currentAction==TQ.ERROR?(TQ.MessageBubble.show(TQ.Dictionary.NAME_NOT_EXIST),"idle"!=a&&this.play("idle")):this.currentAction.play(TQ.FrameCounter.t())},b.pause=function(){assertNotNull(TQ.Dictionary.INVALID_PARAMETER,this.currentAction),null!=this.currentAction&&this.currentAction.stop()},b.resume=function(){assertNotNull(TQ.Dictionary.INVALID_PARAMETER,this.currentAction),null!=this.currentAction&&this.currentAction.resume()},b.stop=function(){assertNotNull(TQ.Dictionary.INVALID_PARAMETER,this.currentAction),null!=this.currentAction&&(this.currentAction.stop(),this.currentAction=null)},b.addAction=function(a,b){var c=this._findActionID(a.name);if(c!=TQ.ERROR){if(!b)return!1;this.actionTable[c]=a}else this.actionTable.push(a);return!0},b.deleteAction=function(a){var b=this._findActionID(a);b==TQ.ERROR?TQ.MessageBubble.show(TQ.Dictionary.INVALID_PARAMETER+a):this.actionTable.splice(b,1)},b._findActionID=function(a){for(var b=0;b<this.actionTable.length;b++)if(this.actionTable[b].name==a)return b;return TQ.ERROR},b._findAction=function(a){var b=this._findActionID(a);return b!=TQ.ERROR?this.actionTable[b]:TQ.ERROR},b.isAnimation=function(){return!0},b.isPlaying=function(){return null!=this.currentAction&&this.currentAction.isPlaying()},b.hasAction=function(a){return this._findAction(a)==TQ.ERROR?!1:!0},TQ.Animation=a}(),TQ=TQ||{},function(){function a(a){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof a),this.viewID=0,this.fixedUp(a)}var b=a.prototype;b.fixedUp=function(a){null!=a&&null!=a.viewID&&(this.viewID=a.viewID)},b.setupView=function(){TQ.InputMap.registerAction(TQ.InputMap.LEFT_ARROW,function(){var a=TQ.SelectSet.peek();null!=a&&null!=a.viewCtrl&&a.viewCtrl.changeView(-1)}),TQ.InputMap.registerAction(TQ.InputMap.RIGHT_ARROW,function(){var a=TQ.SelectSet.peek();null!=a&&null!=a.viewCtrl&&a.viewCtrl.changeView(1)})},b.changeView=function(a){if(null!=this.parent){this.viewID+=a;var b=this.parent.children.length;this.viewID=TQ.MathExt.range(this.viewID,0,b-1);for(var c=0;b>c;c++){var d=this.parent.children[c];d.show(c==this.viewID)}}},b.hideView=function(){if(this.parent&&this.parent.children)for(var a=TQ.FrameCounter.t(),b=this.parent.children.length,c=0;b>c;c++){var d=this.parent.children[c];TQ.AnimeTrack.hide(d,a)}},b.unHideView=function(){for(var a=TQ.FrameCounter.t(),b=this.parent.children.length,c=0;b>c;c++){var d=this.parent.children[c];TQ.AnimeTrack.unHide(d,a)}},b.attachTo=function(a){null!=a&&(this.parent=a,a.viewCtrl=this,this.setupView(),this.hideView(),this.changeView(0))},b.detach=function(a){null!=a&&(this.unHideView(),this.parent=null,a.viewCtrl=null)},b.toJSON=function(){return this.viewID},b.isMultiView=function(){return!0},TQ.MultiView=a}(),window.TQ=window.TQ||{},function(){function a(a,b){null!=a&&(this.level=a,this.children=[],this.decorations=null,this._isNewSkin=!1,this._isHighlighting=!1,this.animeCtrl=null,this.viewCtrl=null,this.state=void 0==b.state?0:b.state,this.dirty=this.dirty2=!1,this.initialize(b))}a.VER1="V1",a.VER2="V2",a.JOINTED=2,a.ROOT_JOINT=4,a.BROKEN=16,a.TRANSLATING=32,a.ROTATING=64,a.SCALING=128,a.ALPHAING=256,a.ZING=512,a.VISIBLE_CHANGED=1024,a.ACTION_CHANGED=2048,a.ETYPE_BACKGROUND=1,a.ETYPE_PROP=2,a.ETYPE_CHARACTER=3,a.ETYPE_TEXT=4,a.ETYPE_EFFECT=5,a.ETYPE_BUTTON=6,a.ETYPE_AUDIO=7,a.ETYPE_PART=8,a.TYPE_BITMAP=2,a.TYPE_COMPONENT=3,a.TYPE_BUTTON=4,a.TYPE_AUDIO=11,a.TO_RELATIVE_POSE=a.TRANSLATING|a.ROTATING|a.SCALING|a.ZING|a.ALPHAING,a.CLEAR_ANIMATATION=32768,a.IN_STAGE=65536,a.LOADED=131072,a.showHidenObjectFlag=!1;var b=a.prototype;b.loaded=!1,b.jsonObj=null,b.displayObj=null,b.parent=null,b.children=[],b.animeTrack={},b.show=function(b){void 0!=this.displayObj&&(this.jsonObj.isVis=b,this.jsonObj.isVis&&!this.hasFlag(a.IN_STAGE)&&(TQ.Log.out(TQ.Dictionary.INVALID_LOGIC),TQ.StageBuffer.add(this)),this.dirty2=!0,this.setFlag(a.VISIBLE_CHANGED))},b.toggleVisibility=function(){this.show(!this.jsonObj.isVis)},b.initialize=function(a){if(this.id=createjs.UID.get(),!(this.level.state!=TQBase.LevelState.EDITING&&this.level.state!=TQBase.LevelState.RUNNING||"SOUND"!=a.type&&"Bitmap"!=a.type&&"BUTTON"!=a.type||TQ.RM.hasElementDesc(a)))return TQ.RM.addElementDesc(a),function(b){TQ.RM.setPaused(!0),TQ.RM.isEmpty||TQ.RM.onCompleteOnce(function(){b.initialize(a)}),TQ.RM.setPaused(!1)}(this),this;switch(this.dirty=!1,this.dirty2=!1,this.version=a.version,a.x=null==a.x?0:a.x,a.y=null==a.y?0:a.y,this.jsonObj=this.fillGap(a),a.type){case"GroupFile":this._addComponent(a);break;case"Text":this.load(a);break;case"Group":this.load(a);break;case"Bitmap":this.load(a);break;case"SOUND":this.load(a);break;case"BitmapAnimation":this._addActorByUrl(a,null);break;default:this.load(a)}return null},b._initializeComponent=function(a){TQ.StageBuffer.open(),this.initialize(a),TQ.StageBuffer.close()},b._addComponent=function(a){this.children=[],function(b){netOpen(a.src,function(c){try{var d=JSON.parse(c)}catch(e){displayInfo2(c),TQ.Log.error(c+". "+e.toString()),d=TQ.Utility.getEmptyScene()}d=b._extractComponent(d,a.x,a.y,a.zIndex),d.t0=a.t0,TQ.RM.setPaused(!0),TQ.RM.isEmpty?(TQ.RM.setPaused(!1),b._initializeComponent(d)):(TQ.RM.onCompleteOnce(function(){b._initializeComponent(d),TQ.SelectSet.add(b)}),TQ.RM.setPaused(!1))})}(this),this.animeTrack=this.jsonObj.animeTrack},b._loadComponent=function(){assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj),this.displayObj={},this.loaded=!0,this._afterItemLoaded(),this.setTRSAVZ()},a.liftZ=function(b,c){if(-1!=b.zIndex&&(b.zIndex+=c),b.children)for(var d=0;d<b.children.length;d++)a.liftZ(b.children[d],c)},b._extractComponent=function(b,c,d,e){this.jsonObj||(this.jsonObj={}),this.jsonObj.children||(this.jsonObj.children=[]);for(var f=0;f<b.levels.length;f++){var g=b.levels[f];if(null!=g.elements&&g.elements.length>0)for(var h=0;h<g.elements.length;h++)a.liftZ(g.elements[h],e),this.jsonObj.children.push(g.elements[h]),TQ.RM.addElementDesc(g.elements[h])}return this.jsonObj.type="Group",this.jsonObj.x=c,this.jsonObj.y=d,this.jsonObj.zIndex=e,this.jsonObj},b._addActorByUrl=function(a,b){var c=new XMLHttpRequest;console.info("Requesting "+a.src),c.open("GET",a.src),function(d){c.onreadystatechange=function(){if(4==c.readyState)if(404==c.status)console.info(a.src+" does not exist");else{var e=JSON.parse(c.responseText);e.alias=null==b?"none":b,e.remote=!0,e.type||(e.type="BitmapAnimation"),e.x=void 0==e.x?a.x:e.x,e.y=void 0==e.y?a.y:e.y,e.PivotX=void 0==e.PivotX?TQ.Config.pivotX:e.PivotX,e.PivotY=void 0==e.PivotY?TQ.Config.pivotY:e.PivotY,d.load(e)}}}(this),c.send()},b.fillGap=function(b){return void 0==b.type&&(b.type="Bitmap"),void 0==b.eType&&(b.eType=a.type2eType(b.type)),void 0==b.state&&(b.state=0),void 0==b.isVis&&(b.isVis=!0),void 0==b.isClipPoint&&(b.isClipPoint=!1),void 0==b.x&&(b.x=100),void 0==b.y&&(b.y=200),void 0==b.zIndex&&(b.zIndex=0),"Text"==b.type?(b.pivotX=void 0==b.pivotX?TQ.Config.TEXT_PIVOT_X:b.pivotX,b.pivotY=void 0==b.pivotY?TQ.Config.TEXT_PIVOT_Y:b.pivotY,b.font&&this.upgradeFont(b),b.fontFace||(b.fontFace=TQ.Config.fontFace),b.fontSize||(b.fontSize=TQ.Config.fontSize),b.color||(b.color=TQ.Config.color)):(b.pivotX=void 0==b.pivotX?TQ.Config.pivotX:b.pivotX,b.pivotY=void 0==b.pivotY?TQ.Config.pivotY:b.pivotY),void 0==b.sx&&(b.sx=1),void 0==b.sy&&(b.sy=1),void 0==b.rotation&&(b.rotation=0),b.IM=b.M=null,b.animeTrack=new TQ.AnimeTrack(b),TQ.AnimeTrack.validate(b.animeTrack),b},a.type2eType=function(a){switch(a){case"Text":return 4;case"SOUND":return 7;case"Group":return 2;case"Bitmap":return 1;default:return 1}return 1},b.load=function(){void 0!=this.jsonObj.src&&null!=this.jsonObj.src&&(this.jsonObj.src=a.upgrade(this.jsonObj.src));var b=this.jsonObj;switch(b.type){case"BitmapAnimation":this._loadActor();break;case"Group":this._loadComponent();break;case"JointMarker":this._loadMarker();break;case"Text":case"SOUND":case"Bitmap":default:this._doLoad()}return b.trace&&(this.trace=TQ.Trace.build(b.trace)),null!=b.animeCtrl&&(this.animeCtrl=new TQ.Animation(b.animeCtrl)),null!=b.viewCtrl&&(this.viewCtrl=new TQ.MultiView(b.viewCtrl)),this.setupChildren(),b},b.setupChildren=function(){if(this.jsonObj.children)for(var a=0;a<this.jsonObj.children.length;a++)this.addChild(this.jsonObj.children[a])},b.findChild=function(a){if(null==this.children)return null;for(var b=null,c=0;c<this.children.length;c++){if(null!=this.children[c].displayObj&&this.children[c].displayObj.id==a.id)return this.children[c];if(b=this.children[c].findChild(a),null!=b)break
}return b},b.addJoint=function(b){assertTrue(TQ.Dictionary.INVALID_LOGIC,TQ.InputCtrl.inSubobjectMode),void 0==b.state&&(b.state=0),b.setFlag(a.JOINTED),this.addChild(b),this.dirty2=!0},b.addChild=function(b){if(null!=b.displayObj){var c=b,d=TQ.FrameCounter.t();c.update(d);var e={};e.t=d,a.copyWorldData(e,c.jsonObj);var f=[];this.saveWorldDataAll(f,c),c.parent=this,c.animeTrack=null,this.children.push(c),this.toRelative(f,c),a.copyWorldData(c.jsonObj,e),this.jsonObj.children||(this.jsonObj.children=[]),this.jsonObj.children.push(c.jsonObj),c.dirty2=this.dirty2=this.dirty=!0,c.setFlag(a.TO_RELATIVE_POSE)}else c=a.build(this.level,b),this.addChildDirect(c);return c},b.addChildDirect=function(a){a.parent=this,this.children||(this.children=[]),this.children.push(a)},b.undeleteChild=function(a){this.addChildDirect(a),a.addItemToStage()},a.copyWorldData=function(a,b){a.x=b.x,a.y=b.y,a.sx=b.sx,a.sy=b.sy,a.rotation=b.rotation,a.isVis=b.isVis},b.saveWorldDataAll=function(b,c){c.animeTrack.x&&c.saveWorldData(b,c.animeTrack.x,a.TRANSLATING),c.animeTrack.sx&&c.saveWorldData(b,c.animeTrack.sx,a.SCALING),c.animeTrack.rotation&&c.saveWorldData(b,c.animeTrack.rotation,a.ROTATING),c.animeTrack.visible&&c.saveWorldData(b,c.animeTrack.visible,a.VISIBLE_CHANGED)},b.toRelative=function(b,c){for(var d=0;d<b.length;d++){var e=b[d];c.dirty2=this.dirty2=this.dirty=!0,c.setFlag(e.type),a.copyWorldData(c.jsonObj,e),this.update(e.t)}},b.saveWorldData=function(b,c,d){for(var e=0;e<c.t.length;e++){var f=c.t[e];this.update(f);var g={};g.t=f,g.type=d,a.copyWorldData(g,this.jsonObj),b.push(g)}},b.removeChild=function(b){assertNotNull(TQ.Dictionary.FoundNull,this.children);var c=this.children.indexOf(b);assertTrue(TQ.Dictionary.INVALID_LOGIC,c>=0),c>=0&&(b=this.children.splice(c,1)[0],c=this.jsonObj.children.indexOf(b.jsonObj),this.jsonObj.children.splice(c,1),b.parent=null),b.dirty2=this.dirty2=this.dirty=!0,b.setFlag(a.TO_RELATIVE_POSE);var d=TQ.FrameCounter.t();return b.update(d),b},b.atomNum=function(){for(var a=1,b=0;b<this.children.length;b++)a+=this.children[b].atomNum();return a},b.skinning=function(a){var b=this.getType();return"BUTTON"==b&&(b="Bitmap"),b!=a.getType()?void TQ.MessageBubble.show(TQ.Dictionary.SAME_TYPE_SKIN+a.getType(),!1):(this.persist(),this.isText()?(this.jsonObj.text=a.jsonObj.text,this.jsonObj.fontSize=a.jsonObj.fontSize,this.jsonObj.fontFace=a.jsonObj.fontFace,this.jsonObj.color=a.jsonObj.color):this.jsonObj.src=a.jsonObj.src,this._doRemoveFromStage(),this._isNewSkin=!0,this._doLoad(),void(a.TBD=!0))},b.attachDecoration=function(b){this.decorations=b;var c=this.decorations[0];c.host=this,c.level=this.level,c.attach(),c.createImage(),this.dirty2=c.dirty2=!0,c.setFlag(a.TO_RELATIVE_POSE|a.CLEAR_ANIMATATION),this.addChild(c),c.show(!0),c.moveToTop()},b.detachDecoration=function(){if(!this.decorations)return null;var a=this.decorations;this.decorations=null,assertNotNull(TQ.Dictionary.FoundNull,a);for(var b=0;b<a.length;b++){var c=a[b];c.show(!1),c.displayObj.visible=!1,c.host=null,c.level=null,this.removeChild(c)}return a},b.getImageResource=function(a,b){return a?a.res:b.img},b._doLoad=function(){assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj);var a=this.jsonObj,b=TQ.RM.getResource(a.src);if(b){this.loaded=!0;var c=this.getImageResource(b,a);this.displayObj=new createjs.Bitmap(c),this._afterItemLoaded(),this.setTRSAVZ()}else{var d=new Image;!function(c){d.onload=function(){c.loaded=!0;var d=c.getImageResource(b,a);c.displayObj=new createjs.Bitmap(d),a.img=null,c._afterItemLoaded(),c.setTRSAVZ()}}(this),d.src=a.src,a.img=d}},b.setTRSAVZ=function(){var b=this.jsonObj;assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj),this.isSound()||assertNotNull(TQ.Dictionary.FoundNull,this.displayObj),!b.isVis||this.isVirtualObject()||this.hasFlag(a.IN_STAGE)||TQ.Log.out(TQ.Dictionary.INVALID_LOGIC+this.jsonObj.src);var c=!1;c=this.parent?this.parent.isVisible()&&b.isVis:b.isVis,c=c||a.showHidenObjectFlag,this.doShow(c)},b.doShow=function(a){this.displayObj?(this.displayObj.visible=a,this.toDeviceCoord(this.displayObj,this.jsonObj)):this.visibleTemp=a},b.toDeviceCoord=function(a,b){if(assertValid(TQ.Dictionary.FoundNull,a),assertValid(TQ.Dictionary.FoundNull,b),a){if(a.x=TQ.Config.zoomX*b.x,a.y=TQ.Utility.toDeviceCoord(TQ.Config.zoomY*b.y),this.isMarker()||this.isSound())return a.scaleX=a.scaleY=1,a.regX=a.regY=0,void(a.rotation=0);this.isMarker()?(a.regX=0,a.regY=0):(a.regX=b.pivotX*this.getWidth(),a.regY=TQ.Utility.toDevicePivot(b.pivotY)*this.getHeight()),a.rotation=TQ.Utility.toDeviceRotation(b.rotation),a.scaleX=TQ.Config.zoomX*b.sx,a.scaleY=TQ.Config.zoomY*b.sy}},b._loadActor=function(){assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj);var a=this.jsonObj,b=new createjs.SpriteSheet(a),c=new createjs.Sprite(b);this.loaded=!0,b.getAnimation("run").next="run",b.getAnimation("jump").next="run",c.gotoAndPlay("jump"),this.displayObj=c,this._afterItemLoaded(),this.setTRSAVZ()},b.removeFromStage=function(){this._doRemoveFromStage();for(var a=0;a<this.children.length;a++){var b=this.children[a];b.removeFromStage()}},b._doRemoveFromStage=function(){TQ.TraceMgr.removeFromStage(this),this.displayObj&&stage.removeChild(this.displayObj),this.clearFlag(a.IN_STAGE)},b.persist=function(){if(this.jsonObj){this.jsonObj.zIndex=this.displayObj?stage.getChildIndex(this.displayObj):-1;for(var a=0;a<this.children.length;a++)this.children[a].persist()}},b.destroy=function(){if(null!=this.children)for(var a=0;a<this.children.length;a++)this.children[a].destroy();this.destroyDisplayObj(),this.children=null,this.jsonObj=null,this.animeTrack=null},b.destroyDisplayObj=function(){this._doRemoveFromStage(),null!=this.displayObj&&(this.displayObj.jsobObj=null,this.displayObj.onPress=null,this.displayObj.onMouseOver=null,this.displayObj.onMouseOut=null,this.displayObj=null)},b.eraseAnimeTrack=function(){if(null!=this.children)for(var a=0;a<this.children.length;a++)this.children[a].eraseAnimeTrack();TQ.TrackRecorder.erase(this)},b.deleteChild=function(a){if(null==this.children)return!1;for(var b=0;b<this.children.length;b++){if(this.children[b]==a)return this.children[b]._doRemoveFromStage(),this.children.splice(b,1),this.jsonObj.children.splice(b,1),!0;if(1==this.children[b].deleteChild(a))return!0}return!1},b.addItemToStage=function(){if(TQ.StageBuffer.add(this),null!=this.children)for(var a=0;a<this.children.length;a++){var b=this.children[a];b.addItemToStage()}},b._doAddItemToStage=function(b){if(null!=this.displayObj&&!this.isVirtualObject()){-1==this.jsonObj.zIndex&&assertTrue(TQ.Dictionary.INVALID_LOGIC,!1);var c=this.level,d=this.displayObj;if(assertNotNull(TQ.Dictionary.FoundNull,this.displayObj),d.jsonObj=this.jsonObj,d.ele=this,this.setFlag(a.IN_STAGE),b&&b.displayObj){var e=stage.getChildIndex(b.displayObj);0>e?stage.addChild(d):(assertTrue(TQ.Dictionary.INVALID_PARAMETER,e>=0),assertTrue(TQ.Dictionary.INVALID_PARAMETER,e<stage.getNumChildren()),stage.addChildAt(d,e))}else stage.addChild(d);this.trace&&this.trace.addToStage(),function(a){var b=function(a){void 0!=TQ.floatToolbar&&TQ.floatToolbar.setPosition&&TQ.floatToolbar.show&&(TQ.floatToolbar.setPosition(a.stageX,a.stageY),TQ.floatToolbar.show(!0))};d.onPress=function(d){if(!TQ.SceneEditor.isPlayMode()){var e=TQ.SelectSet.getEditableEle(a);TQ.SelectSet.add(e);var f=e.displayObj;if(null!=f){var g={x:f.x-d.stageX,y:f.y-d.stageY,firstTime:!0};b(d),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_CANVAS),d.onMouseMove=function(a){TQ.SceneEditor.isPlayMode()||(TQ.floatToolbar.show(!1),TQBase.Trsa.do(e,c,g,a,stage.selectedItem))},d.onMouseUp=function(a){b(a),a.onMouseUp=null},TQ.displayUI&&TQ.displayUI.displayMenu&&TQ.displayUI.displayActionSet&&(TQ.displayUI.displayMenu(e,e.geteType()),TQ.displayUI.displayActionSet(e,e.geteType()))}}},d.onMouseOver=function(){a.highlight(!0),c.dirty=!0},d.onMouseOut=function(){TQ.SelectSet.isSelected(a)||a.highlight(!1)}}(this)}},b.highlight=function(b){return this.isSound()||this.isGroupFile()||this.isButton()?void 0:(assertNotNull(TQ.Dictionary.FoundNull,this.displayObj),this.displayObj?void(this._isHighlighting!=b&&(this._isHighlighting=b,this.displayObj.shadow=this._isHighlighting?a.getShadow():null)):void TQ.Log.criticalError(TQ.Dictionary.FoundNull))},b.pinIt=function(){if(this.jsonObj.isPinned=this.jsonObj.isPinned?!1:!0,"Group"==this.jsonObj.type)for(var a=0;a<this.children.length;a++){var b=this.children[a];b.isJoint()||b.pinIt()}},a.getShadow=function(){return a._shadow||(a._shadow=new createjs.Shadow("#000000",1,1,10)),a._shadow},b._afterItemLoaded=function(){this.displayObj&&(this.displayObj.isClipPoint=this.jsonObj.isClipPoint),this.animeTrack=this.jsonObj.animeTrack,(this.level.state==TQBase.LevelState.EDITING||this.level.state==TQBase.LevelState.RUNNING)&&void 0!=this.jsonObj.t0&&(this.jsonObj.isVis?TQ.AnimeTrack.hideToNow(this,this.jsonObj.t0):TQ.AnimeTrack.hide(this,this.jsonObj.t0)),this._isNewSkin?(TQ.Log.out("element._afterItemLoaded"),assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),TQ.StageBuffer.add(this),null!=this.jsonObj.zIndex&&this.jsonObj.zIndex>=0&&stage.setChildIndex(this.displayObj,this.jsonObj.zIndex+1),this._isNewSkin=!1):this.level.onItemLoaded(this),this.setFlag(a.LOADED)},a.compare=function(a,b){assertNotNull(a),assertNotNull(b);var c=a.jsonObj.zIndex,d=b.jsonObj.zIndex;return assertTrue(TQ.Dictionary.INVALID_LOGIC,c>=-1),assertTrue(TQ.Dictionary.INVALID_LOGIC,d>=-1),c-d},b.sort=function(){this.children.sort(TQ.Element.compare)},b._removeM=function(){if(this.jsonObj.IM=null,this.jsonObj.M=null,null!=this.children)for(var a=0;a<this.children.length;a++)this.children[a]._removeM()},b.toJSON=function(){if(this.highlight(!1),this.jsonObj.displayObj=null,this.jsonObj.animeTrack=this.animeTrack,this.jsonObj.animeCtrl=this.animeCtrl,this.jsonObj.viewCtrl=this.viewCtrl,this.jsonObj.state=31&this.state,this.jsonObj.src&&(this.jsonObj.src=TQ.RM.toRelative(this.jsonObj.src)),this._removeM(),this.parent=null,this.trace&&(this.jsonObj.trace=this.trace),null!=this.children)for(var a=0;a<this.children.length;a++)this.jsonObj.children[a]=this.children[a].toJSON();return this.jsonObj},b.afterToJSON=function(){if(this.jsonObj.animeTrack=null,this.jsonObj.animeCtrl=null,this.jsonObj.viewCtrl=null,null!=this.children)for(var a=0;a<this.children.length;a++)this.children[a].parent=this,this.children[a].afterToJSON()},b.isUserControlling=function(){return TQ.InputMap.IsOperating()&&TQ.SelectSet.isSelected(this)},b.attachCtrl=function(a){this.animeCtrl=a,this.animeCtrl.play("idle")},b.addAction=function(a,b,c,d,e,f){this.animeCtrl||(this.animeCtrl=new TQ.Animation(null));var g=new TQ.Action(a,parseInt(b),parseInt(c),d,parseInt(e));return this.animeCtrl.addAction(g,f)},b.deleteAction=function(a){return this.animeCtrl?void this.animeCtrl.deleteAction(a):void assertTrue(TQ.Dictionary.INVALID_LOGIC,this.animeCtrl)},b.hasAction=function(a){return this.animeCtrl?this.animeCtrl.hasAction(a):(assertTrue(TQ.Dictionary.INVALID_LOGIC,this.animeCtrl),!1)},b.stop=function(){this.animeCtrl&&this.animeCtrl.stop()},b.play=function(){},b.playAction=function(a,b){this._controlerInst||(this._controlerInst=this.getFirstAnimeCtrl()),this._controlerInst&&(this._controlerInst.play(a),b||(this.setFlag(TQ.Element.ACTION_CHANGED),TQ.ActionRecorder.record(this,a,TQ.FrameCounter.t()),TQ.FrameCounter.isPlaying()||$("#play").click()))},b.getActionSet=function(){var a=this.getFirstAnimeCtrl();return null!=a?a.actionTable:null},b.getFirstAnimeCtrl=function(){if(this.animeCtrl)return this.animeCtrl;var a=null;if(this.children)for(var b=0;b<this.children.length&&!(a=this.children[b].getFirstAnimeCtrl());b++);return a},b.updateAction=function(a){if(this.hasActionTrack()){var b=TQ.ActionDecoder.calculate(this.animeTrack,a),c=!1;this.currentActionName?this.currentActionName!=b&&(this.currentActionName=b,c=!0):(this.currentActionName=b,c=!0),c&&this.playAction(this.currentActionName,!0)}},b.update=function(a){var b=!1;if(this.isLoaded()){this.hasActionTrack()&&this.updateAction(a),this.animeCtrl&&this.animeCtrl.currentAction&&(a=this.animeCtrl.currentAction.tMapping(a)),this.updateDecorations(a);var c=null==this.parent?null:this.parent.jsonObj,d=0;if(TQBase.LevelState.isOperatingTimerUI()||(this.dirty2||this.isUserControlling())&&(this.getOperationFlags()||this.setFlag(TQBase.Trsa.lastOperationFlag),TQ.Pose.worldToObjectExt(this.jsonObj,c),TQ.TrackRecorder.record(this,a),b=!0,d+=2),c=null==this.parent?null:this.parent.jsonObj,this.hasAnimation()){var e=a;b&&TQ.TrackRecorder.style==TQ.TrackDecoder.JUMP_INTERPOLATION&&(e=a+.01),this.isSound()&&this.isMultiScene&&(e=currScene.toGlobalTime(e)),TQ.TrackDecoder.calculate(this.animeTrack,this.jsonObj,e),TQ.Pose._toWorldCoordinate(this.jsonObj,c),d+=4}else 0==d&&this.dirty&&(TQ.Pose.worldToObjectExt(this.jsonObj,c),TQ.Pose._toWorldCoordinate(this.jsonObj,c));this.setTRSAVZ(),this.applyToDecorations();var f=!1;if(f&&null!=stage.selectedItem&&stage.selectedItem.id==this.displayObj.id){var g=TQ.Dictionary.Selected+stage.selectedItem.id;displayInfo2(g+"本物体id:"+this.displayObj.id+"motionType: "+d+" Pose: "+TQ.Pose.x+","+TQ.Pose.y+",jsonObjXY:"+this.jsonObj.x+", "+this.jsonObj.y+"displayObjXY:"+this.displayObj.x+", "+this.displayObj.y)}if(0==this.jsonObj.isClipPoint){assertArray(TQ.Dictionary.INVALID_LOGIC,this.children);for(var h=0;h<this.children.length;h++)(this.dirty||this.dirty2)&&(this.children[h].dirty=!0),this.isMarker()&&this.children[h].isUserControlling()||this.children[h].update(a)}this.dirty=this.dirty2=!1}},b.calPivot=function(a,b){var c=a/this.getWidth(),d=b/this.getHeight();return{pivotX:this.jsonObj.pivotX+c,pivotY:this.jsonObj.pivotY+d}},b.getWidth=function(){if(this.isVirtualObject())var a=100;else a=this.displayObj.getWidth(!0);return a},b.getHeight=function(){if(this.isVirtualObject())var a=100;else a=this.displayObj.getHeight(!0);return a},b.movePivot=function(b,c,d){this.jsonObj.pivotX=b.pivotX,this.jsonObj.pivotY=b.pivotY,this.moveTo(c),d.jsonObj.x=0,d.jsonObj.y=0,d.setFlag(a.TRANSLATING),d.dirty=!0},b._move_TBD_NOT_USED=function(b,c){this.jsonObj.x+=b,this.jsonObj.y+=c,this.setFlag(a.TRANSLATING)},b.moveTo=function(b){this.jsonObj.x=b.x,this.jsonObj.y=b.y,this.setFlag(a.TRANSLATING),this.dirty=!0,this.dirty2=!0},b.getScale=function(){return{sx:this.jsonObj.sx,sy:this.jsonObj.sy}},b.getRotation=function(){return this.jsonObj.rotation},b.rotateTo=function(b){this.jsonObj.rotation=b,this.setFlag(a.ROTATING),this.dirty=!0,this.dirty2=!0},b.scaleTo=function(b){this.jsonObj.sx=b.sx,this.jsonObj.sy=b.sy,this.setFlag(a.SCALING),this.dirty=!0,this.dirty2=!0},b.scale=function(a){var b={};b.sx=a*this.jsonObj.sx,b.sy=a*this.jsonObj.sy,this.scaleTo(b)},b.updateDecorations=function(a){if(this.decorations)for(var b=0;b<this.decorations.length;b++){var c=this.decorations[b];c&&c.update2(a)}},b.applyToDecorations=function(){if(this.decorations)for(var a=0;a<this.decorations.length;a++){var b=this.decorations[a];null!=b&&b.isUserControlling()&&b.apply(this)}},b.calculateLastFrame=function(){var a=0;if(this.animeTrack&&(a=Math.max(a,TQ.AnimeTrack.calculateLastFrame(this.animeTrack))),b.children)for(var c=0;c<b.children.length;c++)a=Math.max(a,b.children[c].calculateLastFrame());return a},a.upgrade=function(a){return a.indexOf("images/")>=0&&(a=a.replace("images/",TQ.Config.IMAGES_CORE_PATH)),a.indexOf("assets/")>=0&&(a=a.replace("assets/",TQ.Config.SCENES_CORE_PATH)),a.indexOf("thumbs/")>=0&&a.replace("thumbs/",TQ.Config.THUMBS_CORE_PATH),TQ.RM.toRelative(a)},b.upgradeFont=function(a){var b=a.font.replace("px",""),c=b.split(" ");c.length>=1&&(a.fontFace||(a.fontFace=c[1]),a.fontSize||(a.fontSize=c[0])),a.fontFace||(a.fontFace=TQ.Config.fontFace),a.fontSize||(a.fontSize=TQ.Config.fontSize),a.color||(a.color=TQ.Config.color)},b.setText=function(){assertDepreciated(TQ.Dictionary.isDepreciated)},b.setText=function(a,b,c,d){assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.isText()),null!=this.displayObj&&(this.displayObj.text=this.jsonObj.text=a,this.displayObj.color=this.jsonObj.color=d,this.jsonObj.fontSize=c,this.jsonObj.fontFace=b,this.displayObj.font=TQ.Utility.toCssFont(this.jsonObj.fontSize,this.jsonObj.fontFace))},b.hasAnimation=function(){return!(void 0==this.animeTrack||null==this.animeTrack)},b.isLoaded=function(){return this.loaded},b.toHtmlStr=function(){return'<font color="'+this.jsonObj.color+'" size="'+(this.jsonObj.fontSize-6)/5+'" face="'+this.jsonObj.fontFace+'">'+this.jsonObj.text+"</font>"},a.parseHtmlStr=function(a,b){a.text=TQ.Utility.extractTag("font",b,a.text);var c=a.fontSize;a.fontSize=TQ.Utility.extractAttr("font","size",b,a.fontSize),c!=a.fontSize&&(a.fontSize=5*a.fontSize+6),a.fontFace=TQ.Utility.extractAttr("font","face",b,a.fontFace),a.color=TQ.Utility.extractAttr("font","color",b,a.color)},b.isClipPoint=function(){return this.jsonObj.isClipPoint},b.isText=function(){return void 0!=this.jsonObj.text},b.isSound=function(){return"SOUND"==this.jsonObj.type},b.isGroupFile=function(){return"GroupFile"==this.jsonObj.type},b.isButton=function(){return!1},b.getTextHtml=function(){return assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.isText()),this.toHtmlStr()},b.getFont=function(){return assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.isText()),this.jsonObj.font},b.isLeaf=function(){return null==this.children||this.children.length<1},b.isRoot=function(){return this.hasFlag(a.ROOT_JOINT)},b.isJoint=function(){return null!=this.parent&&this.hasFlag(a.JOINTED)},b.isMarker=function(){return"JointMarker"==this.jsonObj.type},b.isVirtualObject=function(){return this.displayObj?(assertNotNull(TQ.Dictionary.FoundNull,this.displayObj),null==this.displayObj.image&&"Group"==this.jsonObj.type):this.isSound()},b.isValid=function(){return this.jsonObj||this.displayObj},b.isPinned=function(){return this.jsonObj.isPinned},b.isVisible=function(){return this.displayObj&&this.displayObj.visible?this.displayObj.visible:this.visibleTemp},b.hasBroken=function(){return this.hasFlag(a.BROKEN)},b.isGrouped=function(){return null!=this.children,null!=this.parent||null!=this.children},b.getRoot=function(){return this.isGrouped()&&null!=this.parent?this.parent.getRoot():this},b.setMinAngle=function(a){this.jsonObj.angleMin=a},b.setMaxAngle=function(a){this.jsonObj.angleMax=a},b.moveZ=function(a){TQ.MoveCtrl.cmdMoveLayer(this,a)},b.moveToZ=function(a){this.moveZ(a-this.getZ())},b.getType=function(){return this.jsonObj.type},b.geteType=function(){return this.jsonObj.eType},b.setFlag=function(a){this.state|=a},b.clearFlag=function(a){this.state&=~a},b.hasFlag=function(a){return this.state&a},b.hasActionTrack=function(){return this.animeTrack&&this.animeTrack.action},b.getOperationFlags=function(){return 65520&this.state},b.getAlias=function(){return null},b.getZ=function(){var a=this.displayObj,b=a?stage.getChildIndex(a):-1;if(b>=0)return b;if(this.children)for(var c=0;c<this.children.length;c++)if(b=this.children[c].getZ(),b>=0)return b;return assertTrue(TQ.INVALID_LOGIC+"没有可见物体的group",!1),b},TQ.Element=a}(),TQ=TQ||{},function(){function a(a,b){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof b),this.level=a,this.children=[],this.instance=null,this._isNewSkin=!1,this.isFirstTimePlay=!0,this.t0=b.t0?b.t0:0,this.isMultiScene=this.version==TQ.Element.VER2?!0:!1,this.initialize(b)}a.srcToObj=function(a){return{type:"SOUND",src:a,isVis:1}};var b=a.prototype=new TQ.Element(null,null,null,null);b._parent_doShow=b.doShow,b.doShow=function(a){this._parent_doShow(a),a?this.play():this.stop()},a.composeResource=function(b){var c=createjs.Sound.BrowserDetect,d=null;return d=c.isFirefox||c.isOpera?b.replace("mp3","ogg"):b.replace("ogg","mp3"),a._composeFullPath(d)},b._doLoad=function(){if(assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.isSound()),TQ.SoundMgr.isSupported){TQ.Log.info("start to play "+this.jsonObj.src);var a=TQ.RM.getResource(this.jsonObj.src);a?(this.loaded=!0,this.instance=createjs.Sound.createInstance(TQ.RM.getID(a)),this._afterItemLoaded()):!function(a){TQ.RM.addItem(a.jsonObj.src,function(){a._doLoad()})}(this)}},b._parent_doAddItemToStage=b._doAddItemToStage,b._parent_doRemoveFromStage=b._doRemoveFromStage,b._doAddItemToStage=function(){this.isSound()?TQ.SoundMgr.addItem(this):this._parent_doAddItemToStage()},b._parent_calculateLastFrame=b.calculateLastFrame,b.calculateLastFrame=function(){return this.instance?this.isMultiScene?0:this.t0+this.instance.duration/1e3:0},a._composeFullPath=function(a){return a.indexOf(TQ.Config.SOUNDS_PATH)<0?TQ.Config.SOUNDS_PATH+a:a},b._doRemoveFromStage=function(){this.isSound()?this.isMultiScene||this.stop():this._parent_doRemoveFromStage()},b.play=function(){if(!this.instance)return assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),void TQ.Log.info(TQ.Dictionary.INVALID_LOGIC+"in SoundElement.resume");if(this.visibleTemp&&TQ.FrameCounter.isPlaying()&&!TQ.FrameCounter.isRequestedToStop()){if(this.isPaused()||this.isFinished()){var a=TQ.FrameCounter.t();return this.isMultiScene&&(a=currScene.toGlobalTime(a)),void this.resume(a)}this.isPlaying()||this.isFirstTimePlay&&(this.isFirstTimePlay=!1,this.t0||(this.t0=TQ.FrameCounter.t()),this.instance.play())}},b.toGlobalTime=function(a){return this.level.getT0()+a},b.resume=function(a){if(!this.instance)return assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),void TQ.Log.info(TQ.Dictionary.INVALID_LOGIC+"in SoundElement.resume");if(this.isMultiScene)var b=this.toGlobalTime(this.t0);else var b=this.t0;if(this.isFirstTimePlay)return void this.play();var c=1e3*(a-b),d=1e3;if(c>=0&&c<Math.max(d,this.instance.duration-d))if(this.instance.paused)this.instance.resume(),this.instance.setPosition(c);else if(this.instance.playState==createjs.Sound.PLAY_FINISHED){var e=TQ.RM.getResource(this.jsonObj.src);e&&(this.instance=createjs.Sound.createInstance(TQ.RM.getID(e)));var f=createjs.Sound.INTERRUPT_NONE,g=0;this.instance.play(f,g,c)}},b.pause=function(){return this.instance?void this.instance.pause():void assertTrue(TQ.Dictionary.INVALID_LOGIC,!1)},b.isPlaying=function(){if(!this.instance)return assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1;var a=this.instance.playState;return a?!(a==createjs.Sound.PLAY_FINISHED||a==createjs.Sound.PLAY_INTERRUPTED||a==createjs.Sound.PLAY_FAILED):!1},b.isPaused=function(){if(!this.instance)return!1;var a=this.instance.playState;return a?this.instance.paused:!1},b.isFinished=function(){if(!this.instance)return!1;var a=this.instance.playState;return a?a==createjs.Sound.PLAY_FINISHED:!1},b.stop=function(){this.instance&&this.isPlaying()&&!this.instance.paused&&this.instance.stop()},b.getAlias=function(){var a="声音";return this.jsonObj&&this.jsonObj.alias&&(a=this.jsonObj.alias),a},TQ.SoundElement=a}(),TQ=TQ||{},function(){function ButtonElement(a,b){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof b),this.level=a,this.children=[],this.instance=null,this._isNewSkin=!1,this.state2=ButtonElement.INVISIBLE,this.onVisibleAction="if (TQ.WCY.isPlayOnly) {TQ.WCY.doStop();}else {$('#stop').click();}",this.onClickAction="if (TQ.WCY.isPlayOnly) {TQ.WCY.doPlay();}else {$('#play').click();}",this.actions=[],this.t0=b.t0?b.t0:0,this.initialize(b)}ButtonElement.INVISIBLE=1,ButtonElement.VISIBLE=4,ButtonElement.CLICKED=8;var p=ButtonElement.prototype=new TQ.Element(null,null);p._parent_afterItemLoaded=p._afterItemLoaded,p._afterItemLoaded=function(a){this._parent_afterItemLoaded(a),(this.level.state==TQBase.LevelState.EDITING||this.level.state==TQBase.LevelState.RUNNING)&&void 0!=this.jsonObj.t0&&TQ.AnimeTrack.setButton(this,this.jsonObj.t0),this.buildLinks()},p._parent_doShow=p.doShow,p.doShow=function(a){if(this._parent_doShow(a),a){if(this.state2==ButtonElement.INVISIBLE){if(this.state2=ButtonElement.VISIBLE,TQ.FrameCounter.isPlaying()){var b=this.displayObj;!function(a){b.onPress=function(){a.onClick()}}(this)}TQ.ButtonMgr.addItem(this),this.onVisible()}}else this.state2!=ButtonElement.INVISIBLE&&(this.state2=ButtonElement.INVISIBLE,TQ.ButtonMgr.deleteItem(this))},p.setButton=function(a){TQ.FrameCounter.isPlaying()&&TQ.AnimeTrack.setButton(this,a)},p.onVisible=function(){if(this.level.state==TQBase.LevelState.EDITING||this.level.state==TQBase.LevelState.RUNNING){var t=TQ.FrameCounter.t();this.setButton(t),eval(this.onVisibleAction)}},p.onClick=function(){if(TQ.SceneEditor.isPlayMode()){if(this.state2==ButtonElement.VISIBLE){this.state2=ButtonElement.CLICKED;var item=this.displayObj;item.onPress=null}eval(this.onClickAction);for(var i=0;i<this.actions.length;i++){var act=this.actions[i];act&&act.action&&act.ele.playAction(act.action,!0)}}},p.addAction=function(a,b){var c=this._findAction(a,b);return c==TQ.ERROR?this.actions.push({ele:a,action:b}):this.actions[c]={ele:a,action:b},c},p.deleteAction=function(a){a<this.actions.length&&(this.actions[a]=null)},p.removeAll=function(){this.actions.splice(0)},p._findAction=function(a,b){for(var c=0;c<this.actions.length;c++){var d=this.actions[c];if(d&&b==d.name&&d.ele==a)return c}return TQ.ERROR},p.parent_toJSON=p.toJSON,p.toJSON=function(){if(this.parent_toJSON(),this.actions){this.jsonObj.actions=[];for(var a=0;a<this.actions.length;a++){var b=this.actions[a];this.jsonObj.actions.push({elementID:b.ele.id,name:b.name})}}return this.jsonObj},p.isButton=function(){return!0},p.buildLinks=function(){if(this.actions=[],this.jsonObj.actions)for(var a=0;a<this.jsonObj.actions.length;a++){var b=this.jsonObj.actions[a];if(b&&b.action){var c=this.level.findByDescID(b.id);c&&this.addAction(c,b.name)}}},TQ.ButtonElement=ButtonElement}(),TQ=TQ||{},function(){function a(){}a.items=[],a.initialize=function(){},a.addItem=function(b){a.items.indexOf(b)>=0||a.items.push(b)},a.deleteItem=function(b){var c=a.items.indexOf(b);c>=0&&a.items.splice(c,1)},a.removeAll=function(){for(var b=a.items.length-1;b>=0;b--){{a.items[b]}a.items.splice(b,1)}},a.close=function(){a.removeAll(),a.items.splice(0)},TQ.ButtonMgr=a}(),window.TQ=window.TQ||{},function(){function a(a,b){null!=a&&(this.level=a,this.children=[],this.decorations=null,this._isNewSkin=!1,this._isHighlighting=!1,this.animeCtrl=null,this.viewCtrl=null,this.state=void 0==b.state?0:b.state,this.dirty=this.dirty2=!1,this.initialize(b))}var b=a.prototype=new TQ.Element(null,null);b._doLoad=function(){assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj);var a=this.jsonObj,b=new createjs.Text(a.text,TQ.Utility.toCssFont(a.fontSize,a.fontFace),a.color);this.loaded=!0,b.textAlign=null==a.textAlign?a.textAlign:"left",this.displayObj=b,this._afterItemLoaded(),this.setTRSAVZ()},TQ.TextElement=a}(),window.TQ=window.TQ||{},function(){TQ.Element.upgradeToVer2=function(a){a.version=a.version?a.version:TQ.Element.VER1,void 0==a.isPinned&&(a.isPinned=!1)},TQ.Element.build=function(a,b){if(!b)return assertTrue(TQ.Dictionary.INVALID_LOGIC,!b),TQ.ERROR;switch(TQ.Element.upgradeToVer2(b),b.type){case"SOUND":return new TQ.SoundElement(a,b);case"JointMarker":return new TQ.Marker(a,b);case"BUTTON":return new TQ.ButtonElement(a,b);case"Text":return new TQ.TextElement(a,b)}return TQ.Element.isVideo(b.src)?new TQ.VideoElement(a,b):new TQ.Element(a,b)},TQ.Element.isVideo=function(a){if(!a)return!1;var b=["mp4","mov"],c="",d=a.lastIndexOf(".");return d>=0&&(c=a.substr(d+1),b.indexOf(c)>=0)?!0:!1}}(),window.TQ=window.TQ||{},function(){function a(){}a._stage=null,a.MODE_ROTATE=1,a.MODE_SCALE=2,a.mode=a.MODE_ROTATE,a.inSubobjectMode=!1,a.showMarkerOnly=!1,a.vkeyMove=!1,a.vkeyRotate=!1,a.vkeyScale=!1,a.vkeyLift=!1,a.vkeyCtrl=!1,a.vkeyUnjoint=!1,a.vkeyUngroup=!1,a.clearVkey=function(){a.vkeyMove=!1,a.vkeyRotate=!1,a.vkeyScale=!1,a.vkeyLift=!1,a.vkeyUnjoint=!1,a.vkeyUngroup=!1},a.leaveTraceOn=!1,a.initialize=function(b){a._stage=b,TQ.InputMap.registerAction(TQ.InputMap.C,function(){currScene.currentLevel.cloneElement(TQ.SelectSet.members)}),TQ.InputMap.registerAction(TQ.InputMap.HIDE_KEY|TQ.InputMap.LEFT_ALT_FLAG,function(){TQ.SelectSet.show(!1)}),TQ.InputMap.registerAction(TQ.InputMap.HIDE_KEY,function(){TQ.SelectSet.show(!1)}),TQ.InputMap.registerAction(TQ.InputMap.SHOW_KEY,function(){TQ.SelectSet.show(!0)}),TQ.InputMap.registerAction(TQ.InputMap.SHOW_KEY|TQ.InputMap.LEFT_ALT_FLAG,function(){TQ.SelectSet.show(!0)}),TQ.InputMap.registerAction(TQ.InputMap.SHOW_ALL_HIDEN_OBJECT_KEY,function(){TQ.Element.showHidenObjectFlag=!TQ.Element.showHidenObjectFlag}),TQ.InputMap.registerAction(TQ.InputMap.PLAY_STOP_KEY,function(){TQ.WCY.doPlayStop()})},a._accumulateStep=0,a._lastItemID=-1,$(document).mouseup(function(){a._accumulateStep=0}),a.isSameItem=function(b){return a._lastItemID==b.id},a.getDelta=function(b,c,d,e,f){var g=TQ.Utility.deltaYinWorld(d,e,f),h=f.stageX+e.x-d.x,i=g+h,j=b==a.MODE_ROTATE?TQ.Config.RotateSensitivity:TQ.Config.MouseSensitivity;a.step=Math.floor(i/j);var k=a.isSameItem(d)?a.step-a._accumulateStep:a.step;return TQ.Log.out("ID:"+a._lastItemID+"sum"+a._accumulateStep+", step: "+a.step+", delta: "+k),null!=d&&(a._lastItemID=d.id),k},a.scale=function(b,c,d,e){var f=a.getDelta(a.MODE_SCALE,b,c,d,e),g=1;0!=f&&(f>0?g=1.1*f:0>f&&(g=.9*-f),g=TQ.MathExt.range(g,.8,1.2),null!=c&&(a.doScale(b,g),a._accumulateStep=a.step))},a.doScale=function(b,c){if(assertNotNull(TQ.Dictionary.FoundNull,b),b){assertTrue(TQ.Dictionary.INVALID_PARAMETER,c>0);var d=.1,e=2;c=a.limitScale(b.jsonObj.sx,d,e,c),c=a.limitScale(b.jsonObj.sy,d,e,c),a.doScaleCmd(b,{sx:b.jsonObj.sx*c,sy:b.jsonObj.sy*c})}},a.doScaleCmd=function(a,b){var c={sx:a.jsonObj.sx,sy:a.jsonObj.sy};TQ.CommandMgr.directDo(new TQ.GenCommand(TQ.GenCommand.SCALE,a,b,c))},a.mirrorX=function(b){if(assertNotNull(TQ.Dictionary.FoundNull,b),b){var c=-1;a.doScaleCmd(b,{sx:b.jsonObj.sx*c,sy:b.jsonObj.sy})}},a.mirrorY=function(b){if(assertNotNull(TQ.Dictionary.FoundNull,b),b){var c=-1;a.doScaleCmd(b,{sx:b.jsonObj.sx,sy:b.jsonObj.sy*c})}},a.limitScale=function(a,b,c,d){var e=a*d;return Math.abs(e)>c?d=c/a:Math.abs(e)<b&&(d=b/a),d},a.setSubobjectMode=function(){a.inSubobjectMode=!0;var b=$("#subElementMode");b[0].checked=!0,b.button("refresh")},TQ.InputCtrl=a}(),window.TQ=window.TQ||{},function(){function a(){}a._stage=null,a.initialize=function(b){a._stage=b,a.queue=[],a._direction=1},a._accumulateStep=0,a._lastItemID=-1,$(document).mouseup(function(){a._accumulateStep=0}),a.isSameItem=function(b){return a._lastItemID==b.id},a.moveZ=function(b,c,d){var e=b.displayObj,f=TQ.Utility.deltaYinWorld(e,c,d),g=Math.floor(f/TQ.Config.MouseSensitivity),h=a.isSameItem(e)?g-a._accumulateStep:g;0!=h&&(a._accumulateStep=g,a._doMoveZ(b,h),TQ.Log.out("ID:"+a._lastItemID+"sum"+a._accumulateStep+", step: "+g+", delta: "+h))},a.moveLayer=function(a,b){var c=a.getZ();TQ.CommandMgr.addCommand(new TQ.GenCommand(TQ.GenCommand.CHANGE_LAYER,a,b,c))},a.cmdMoveLayer=function(b,c){assertNotNull(TQ.Dictionary.FoundNull,b),b&&(a._openQueue(c),a._doMoveZ(b,c),a._flush())},a.moveToTop=function(b){assertNotNull(TQ.Dictionary.FoundNull,b),b&&a.moveLayer(b,99999)},a.moveToBottom=function(b){assertNotNull(TQ.Dictionary.FoundNull,b),b&&a.moveLayer(b,-99999)},a._doMoveZ=function(b,c){var d=b.displayObj;if(null!=d&&(a._moveZOne(b),a._lastItemID=d.id,b.children))for(var e=0;e<b.children.length;e++)a._doMoveZ(b.children[e],c)},a._moveZOne=function(b){if(b.displayObj){var c=a._stage.getChildIndex(b.displayObj);c>=0&&a.queue.push({id:c,ele:b})}},a._openQueue=function(b){a._direction=b,a.queue.splice(0)},a._flush=function(){var b=a.queue.length;if(b>0){a.queue.sort(a._direction<0?function(a,b){return a.id>=b.id}:function(a,b){return a.id<=b.id});var c=a._direction;if(1==c&&a._stage.getNumChildren()-1==a.queue[0].id)return;if(-1==c&&0==a.queue[0].id)return;if(c>1?c=a._stage.getNumChildren()-1-a.queue[0].id:-1>c&&(c=-a.queue[0].id),0==c)return;for(var d=0;b>d;d++){var e=a.queue.shift();a._doMoveZOne(e.ele,c)}}},a._doMoveZOne=function(b,c){var d=b.displayObj;if(d){var e=a._stage.getChildIndex(d);if(e>=0){var f=TQ.MathExt.range(e+c,0,a._stage.getNumChildren()-1);e!=f&&(c>1||-1>c?a._stage.setChildIndex(b.displayObj,f):a._stage.swapChildrenAt(e,f))}}},TQ.MoveCtrl=a}(),window.TQ=window.TQ||{},function(){function a(){}a.hasNew=!1,a._stage=null,a._scene=null,a._hostObj=null,a.isWorking=!1,a.initialize=function(b,c){a._stage=b,a._scene=c
},a.oldSubjectMode=null,a.start=function(){return a._hostObj=TQ.SelectSet.peek(),null==a._hostObj?void displayInfo2(TQ.Dictionary.PleaseSelectOne):(a.isWorking=!0,a.oldSubjectMode=TQ.InputCtrl.inSubobjectMode,TQ.InputCtrl.inSubobjectMode=!0,TQ.SelectSet.getSelectedElement(),a._hostObj=TQ.SelectSet.pop(),void $(document).bind("mousedown",a.getSkin))},a.getSkin=function(){var b=TQ.SelectSet.pop();assertNotNull(TQ.Dictionary.PleaseSelectHost,a._hostObj),null!=b&&b.displayObj.id!=a._hostObj.displayObj.id&&(a._scene.skinning(a._hostObj,b),TQ.SelectSet.clear(),a.end())},a.end=function(){a.isWorking&&(a.isWorking=!1,null!=a.oldSubjectMode&&(TQ.InputCtrl.inSubobjectMode=a.oldSubjectMode),$(document).unbind("mousedown",a.getSkin))},TQ.SkinningCtrl=a}(),window.TQ=window.TQ||{},function(){function a(){}a._stage=null,a._scene=null,a.EObj=null,a.initialize=function(b,c){a._stage=b,a._scene=c},a.isSimpleRotationMode=!1,a.angle=function(a,b,c){var d=TQ.Vector2D.create([b.x-a.x,b.y-a.y]),e=TQ.Vector2D.create([c.x-a.x,c.y-a.y]);return d.toUnitVector(),e.toUnitVector(),e.angle360From(d)},a.getE=function(b){assertNotNull(TQ.Dictionary.PleaseSelectOne,a.EObj);var c=b.jsonObj.M.multiply($V([a.EObj.x,a.EObj.y,1]));return{x:c.elements[0],y:c.elements[1]}},a.hasAchieved=function(a,b){var c=Math.abs(b.x-a.x)+Math.abs(b.y-a.y);return 1>c},a.applyLimitation=function(a,b){if(null!=a.jsonObj.angleMin||null!=a.jsonObj.angleMax){var c=a.jsonObj.angleMin,d=a.jsonObj.angleMax,e=0;null!=a.parent&&(e=a.parent.jsonObj.rotation);var f=b-e;f=TQ.MathExt.range(f,c,d),b=f+e}return b},a.setLimitation=function(a,b){var c=TQ.SelectSet.peek();if(null!=c){null==b&&(b=c.jsonObj.rotation);var d=0;null!=c.parent&&(d=c.parent.jsonObj.rotation);var e,f,g=b-d;0==a?(e=void 0==c.jsonObj.angleMin?null:c.jsonObj.angleMin,f=TQ.GenCommand.MIN_JOINT_ANGLE):(e=void 0==c.jsonObj.angleMax?null:c.jsonObj.angleMax,f=TQ.GenCommand.MAX_JOINT_ANGLE),TQ.CommandMgr.directDo(new TQ.GenCommand(f,c,g,e)),null!=c.jsonObj.angleMin&&null!=c.jsonObj.angleMax&&c.jsonObj.angleMin>c.jsonObj.angleMax&&TQ.MessageBubble(TQ.Dictionary.INVALID_PARAMETER)}},a.calOneBone=function(b,c,d){var e=b.jsonObj,f=a.getE(c);if(a.hasAchieved(f,d))return!0;var g=a.angle(e,f,d),h=b.getOperationFlags();return a.rotate(b,g),a.isSimpleRotationMode?!0:b.isRoot()||b.parent.isPinned()?!1:(assertNotNull(TQ.Dictionary.FoundNull,b.parent),b.parent.setFlag(h),a.calOneBone(b.parent,c,d))},a.rotate=function(b,c){assertNotNull(TQ.Dictionary.FoundNull,b),b&&(c=a.applyLimitation(b,b.jsonObj.rotation+c),TQ.CommandMgr.directDo(new TQ.RotateCommand(b,c)),b.update(TQ.FrameCounter.t()),TQ.Log.info("image: "+b.jsonObj.src+"angle = "+c))},a.do=function(b,c,d,e){a.isSimpleRotationMode=e;var f=a._stage.selectedItem;if(null==f)return void displayInfo2(TQ.Dictionary.PleaseSelectOne);var g=a._scene.findAtom(f);if(null==g)return void displayInfo2(TQ.Dictionary.PleaseSelectOne);var h=d.stageX,i=d.stageY,j=TQ.Utility.deviceToWorld(h,i);1==c.firstTime&&(a.EObj=a.determineE(b,c,d),c.firstTime=!1),a.EObj||displayInfo2(TQ.Dictionary.PleaseSelectOne);for(var k=0;k<TQ.Config.IK_ITERATE_TIME&&!a.calOneBone(g,g,j);k++);},a.determineE=function(a,b,c){var d={x:c.stageX,y:c.stageY},e=TQ.Utility.deviceToWorld(d.x,d.y),f=a.jsonObj;return TQ.Pose.worldToObject(e,f),{x:TQ.Pose.x,y:TQ.Pose.y}},TQ.IKCtrl=a}(),TQ=TQ||{},function(){function a(a,b){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof b),this.level=a,this.children=[],this.decorations=null,this.host=null,this._isNewSkin=!1,this.initialize(b)}a.RADIUS=10;var b=a.prototype=new TQ.Element(null,null,null,null);b.attach=function(){this.jsonObj.x=this.host.jsonObj.x,this.jsonObj.y=this.host.jsonObj.y},b._parent_update=b.update,b.update2=function(a){var b=this.host;if(this.moveToTop(),this.isUserControlling()&&TQ.InputMap.mouseMoving){this._parent_update(a);var c=this.jsonObj.x-b.jsonObj.x,d=this.jsonObj.y-b.jsonObj.y;TQ.CommandMgr.directDo(new TQ.MovePivotCommand(b,b.calPivot(TQ.Pose.x,TQ.Pose.y),{x:b.jsonObj.x+c,y:b.jsonObj.y+d},this))}},b.moveToTop=function(){var a=stage.getNumChildren();stage.setChildIndex(this.displayObj,a-1)},b.createImage=function(){var b=this.displayObj;if(!b)return void TQ.Log.criticalError(TQ.Dictionary.FoundNull);b.graphics.clear();var c=a.RADIUS;b.graphics.ss(c).beginStroke("#f0f").beginRadialGradientFill(["#FFF","#0FF"],[0,1],0,0,0,0,0,c).drawCircle(0,0,c).endFill()},b._loadMarker=function(){assertNotNull(TQ.Dictionary.FoundNull,this.jsonObj);var a=this.jsonObj,b=new createjs.Shape;this.loaded=!0,b.x=a.x,b.y=a.y,this.displayObj=b,this._afterItemLoaded(),this.setTRSAVZ()},b.apply=function(a){this.jsonObj.x=a.jsonObj.x,this.jsonObj.y=a.jsonObj.y,this.dirty2=!0,this.setFlag(TQ.Element.TRANSLATING),TQBase.LevelState.isOperatingCanvas()&&this.createImage()},TQ.Marker=a}(),TQ=TQ||{},function(){function a(a,b){this.receiver=[];for(var c=0;c<a.length;c++)this.receiver.push(a[c]);this.oldValue=!b,this.newValue=b}function b(a,b){this.receiver=[];for(var c=0;c<a.length;c++)this.receiver.push(a[c]);this.oldValue=!b,this.newValue=b}function c(a,b){this.receiver=[];for(var c=0;c<a.length;c++)this.receiver.push(a[c]);this.oldValue=b,this.newValue=b}var d={};d.members=[],d.decorations=[],d.workingDecorations=[],d.selectedMarkers=[],d.initialize=function(){TQ.InputMap.registerAction(TQ.InputMap.DELETE_KEY,function(){TQ.TextEditor.visible||TQ.FileDialog.visible||TQ.SelectSet.delete()}),TQ.InputMap.registerAction(TQ.InputMap.DELETE_KEY|TQ.InputMap.LEFT_ALT_FLAG,TQ.SelectSet.eraseAnimeTrack),TQ.InputMap.registerAction(TQ.InputMap.EMPTY_SELECTOR,TQ.SelectSet.clear);var a={1:"idle",2:"work",3:"run",4:"smile",5:"stand"};TQ.InputMap.registerAction(TQ.InputMap.D1,function(){d.playAnimation(a[1])}),TQ.InputMap.registerAction(TQ.InputMap.D2,function(){d.playAnimation(a[2])}),TQ.InputMap.registerAction(TQ.InputMap.D3,function(){d.playAnimation(a[3])}),TQ.InputMap.registerAction(TQ.InputMap.D4,function(){d.playAnimation(a[4])}),TQ.InputMap.registerAction(TQ.InputMap.D5,function(){d.playAnimation(a[5])})},d.playAnimation=function(a){var b=d.peek();null!=b&&b.playAction(a)},d.getDecoration=function(){var a=d.decorations.pop();if(null==a){var b=TQ.SelectSet.members[0];assertNotNull(TQ.Dictionary.PleaseSelectHost,b);var c=TQ.Element.build(b.level,{isVis:0,type:"JointMarker"});a=[c]}return d.workingDecorations.push(a),a},d.recycleDecoration=function(a){var b=d.workingDecorations.indexOf(a);d.workingDecorations.splice(b,1),d.decorations.push(a)},d.add=function(a){if(assertNotNull(TQ.Dictionary.PleaseSelectOne,a),null!=a){if(a.isMarker())return void d.selectedMarkers.push(a);d.selectedMarkers.splice(0),TQ.InputMap.isPresseds[TQ.InputMap.LEFT_CTRL]||TQ.InputCtrl.vkeyCtrl||(1!=d.members.length||0!=d.members.indexOf(a))&&d.clear(),d.members.indexOf(a)<0&&(d.members.push(a),a.highlight(!0),TQ.InputCtrl.inSubobjectMode&&d.attachDecoration(a),TQ.floatToolbar.selectedElement=!TQ.InputCtrl.inSubobjectMode&&a.isJoint()?a:a)}},d.delete=function(){d.clear(!0)},d.clear=function(a){var b;a&&(b=new TQ.CompositeCommand);for(var c=0;c<d.members.length;c++){var e=d.members[c];assertNotNull(TQ.Dictionary.FoundNull,e),e.isValid()&&e.highlight(!1),d.detachDecoration(e),a&&e.isValid()&&b.addCommand(new TQ.DeleteEleCommand(currScene,e))}a&&b.commands.length>0&&TQ.CommandMgr.directDo(b),null==d.getElementUnderMouse()&&(TQ.floatToolbar.show(!1),TQ.TabsMenu.closeDiv&&TQ.TabsMenu.closeDiv()),d.members.splice(0),d.selectedMarkers.splice(0)},d.updateDecorations=function(a){for(var b=0;b<d.members.length;b++){var c=d.members[b];a?d.attachDecoration(c):d.detachDecoration(c)}},d.groupIt=function(){var a=TQ.InputMap.isPresseds[TQ.InputMap.LEFT_CTRL]||TQ.InputCtrl.vkeyUngroup;return a||d.members.length>=2?(TQ.CommandMgr.directDo(new TQ.GroupCommand(d.members,a)),d.clear(),!0):!1},d.jointIt=function(){var a=TQ.InputMap.isPresseds[TQ.InputMap.LEFT_CTRL]||TQ.InputCtrl.vkeyUnjoint;TQ.CommandMgr.directDo(new TQ.JointCommand(d.members,a)),d.clear()},d.pinIt=function(){for(var a=0;a<d.members.length;a++){var b=d.members[a];assertNotNull(TQ.Dictionary.FoundNull,b),b.isValid()&&b.pinIt()}},d.show=function(){var a=TQ.InputCtrl.inSubobjectMode||TQ.InputMap.isPresseds[TQ.InputMap.LEFT_ALT];TQ.CommandMgr.directDo(new TQ.HideCommand(d.members,a))},d.doShow=function(a,b){for(var c=!1,d=0;d<a.length;d++){var e=a[d];if(!b)for(;e.isJoint()&&null!=e.parent;)e=e.parent;c=e.isVisible(),e.toggleVisibility()}TQ.floatToolbar.show(!c)},d.eraseAnimeTrack=function(){TQ.FrameCounter.gotoBeginning();for(var a=0;a<d.members.length;a++){var b=d.members[a];assertNotNull(TQ.Dictionary.FoundNull,b),b.isValid()&&b.eraseAnimeTrack()}},$(document).mousedown(function(a){a.target&&"testCanvas"==a.target.id?null==stage.selectedItem&&d.clear():a.target&&"BODY"==a.target.tagName&&d.clear()}),d.getElementUnderMouse=function(){var a=stage.selectedItem,b=null==a?null:currScene.findAtom(a);return null!=b&&(b=d.getEditableEle(b)),b},d.getSelectedElement=function(){var a=d.getElementUnderMouse();return null!=a?d.add(a):(TQ.InputMap.isPresseds[TQ.InputMap.LEFT_CTRL]||d.clear(),TQ.floatToolbar.show(!1)),TQ.SelectSet.peek()},d.getEditableEle=function(a){return TQ.InputCtrl.showMarkerOnly&&assertTrue(TQ.Dictionary.INVALID_LOGIC,TQ.InputCtrl.inSubobjectMode),a.isJoint()||!a.isGrouped()||TQ.InputCtrl.inSubobjectMode&&!TQ.InputCtrl.showMarkerOnly||null==a.parent?a:TQ.SelectSet.getEditableEle(a.parent)},d.isSelected=function(a){return d.members.indexOf(a)>=0||d.selectedMarkers.indexOf(a)>=0},d.pop=function(){assertTrue(TQ.Dictionary.INVALID_PARAMETER,d.members.length>0);var a=d.members.pop();return d.detachDecoration(a),a},d.peek=function(){return d.members.length<=0?null:d.members[0]},d.detachDecoration=function(a){if(null!=a.decorations){var b=a.detachDecoration();d.recycleDecoration(b)}},d.attachDecoration=function(a){a.decorations||a.attachDecoration(d.getDecoration())},inherit(a,TQ.AbstractCommand),a.prototype.do=function(){return currScene.groupIt(this.receiver,this.newValue),this.constructor.name+this.receiver},a.prototype.undo=function(){return this.oldValue&&(assertTrue(TQ.Dictionary.INVALID_PARAMETER,this.receiver.length>0),currScene.groupIt([this.receiver[0].parent],this.oldValue)),this.constructor.name+this.receiver},a.prototype.redo=a.prototype.do,inherit(b,TQ.AbstractCommand),b.prototype.do=function(){return currScene.joint(this.receiver,this.newValue),this.constructor.name+this.receiver},b.prototype.undo=function(){return currScene.joint(this.receiver,this.oldValue),this.constructor.name+this.receiver},b.prototype.redo=b.prototype.do,inherit(c,TQ.AbstractCommand),c.prototype.do=function(){return d.doShow(this.receiver,this.newValue),this.constructor.name+this.receiver},c.prototype.undo=function(){return d.doShow(this.receiver,this.oldValue),this.constructor.name+this.receiver},c.prototype.redo=c.prototype.do,TQ.GroupCommand=a,TQ.JointCommand=b,TQ.HideCommand=c,TQ.SelectSet=d}(),window.TQ=window.TQ||{},function(){function a(a,b){for(var c=$("#"+a).get(0),d=c.options.length,e=0;d>e;e++)if(c.options[e].text==b){c.options[e].selected=!0;break}}function b(a,b){for(var c=$("#"+a).get(0),d=c.options.length,e=0;d>e;e++)if(c.options[e].value==b){c.options[e].selected=!0;break}}var c={};c.visible=!1,c.lastElement=null,c.x0=100,c.initialize=function(){c.boxDiv=$("#textEditBoxDiv"),c.inputBox=$("#textEditBox"),c.boxDiv.hide(),TQ.InputMap.registerAction(TQ.InputMap.TEXT_EDIT_KEY,function(){var a=TQ.SelectSet.members[0];c.do(a)})},c.do=function(a){if(null!=a&&a.isText()&&!c.visible){c.visible=!0,c.lastElement=a;var b=a.jsonObj;a.show(!1);var d=document.getElementById("testCanvas");canvasLeft=d.offsetLeft+TQ.Utility.getOffsetLeft(d.offsetParent),canvasTop=d.offsetTop+TQ.Utility.getOffsetTop(d.offsetParent);var e=canvasLeft+a.displayObj.x,f=canvasTop+a.displayObj.y;c.getInput(b.text,b.fontFace,b.fontSize,b.color,e-25,f-5)}},c.addText=function(a){if(!c.visible){c.isCreating=!0,c.lastElement=null;var b=document.getElementById("testCanvas");canvasWidth=b.clientWidth||b.body.clientWidth||0,canvasHeight=b.clientHeight||b.body.clientHeight||0;var d=c.x0,e=canvasHeight/2,f=TQ.FrameCounter.t();jsonObj={type:"Text",isVis:1,x:d,y:e,zIndex:TQ.Utility.getMaxZ(),rotation:0,text:a,t0:f,fontFace:TQ.Config.fontFace,fontSize:TQ.Config.fontSize,color:TQ.Config.color},TQ.Element.parseHtmlStr(jsonObj,a),c.do(currScene.addText(jsonObj)),c.isCreating=!1}},c.yDiff=function(a){return(a-45)/3+19},c.getInput=function(d,e,f,g,h,i){TQ.InputMap.turnOff(),null==h&&(h=520),null==i&&(i=300),c.xCanvas=h,c.yCanvas=i;var j=f*d.length;c.setEditor(e,f,g,h,i,j),c.inputBox.val(d),c.boxDiv.show(),a("fontFamilySelector",e),a("fontSize",f),b("fontColor",g),$("select, input").bind("click keyup change",c.realTimeUpdate),$("#idOK").bind("click",c.onOK),$("#idNo").bind("click",c.onNo)},c.setEditor=function(a,b,d,e,f,g){e=TQ.Utility.canvas2WindowX(c.xCanvas-4),f=TQ.Utility.canvas2WindowY(c.yCanvas-c.yDiff(b)),c.boxDiv.css("left",e.toString()+"px"),c.boxDiv.css("top",f.toString()+"px"),c.inputBox.css("font-family",a),c.inputBox.css("font-size",b+"px"),c.inputBox.css("color",d),c.inputBox.css("opacity",1),c.inputBox.css("width",g+"px")},c.onOK=function(){TQ.InputMap.turnOn(),c.visible=!1,c.boxDiv.hide(),c.lastElement.show(!0)},c.onNo=function(){TQ.InputMap.turnOn(),c.visible&&(c.visible=!1,c.boxDiv.hide())},c.realTimeUpdate=function(){if(assertNotNull(TQ.Dictionary.PleaseSelectText,c.lastElement),null!=c.lastElement){var a=c.inputBox.val(),b=$("#fontFamilySelector :selected").val(),d=$("#fontSize :selected").val(),e=$("#fontColor :selected").val();c.lastElement.setText(a,b,d,e),c.setEditor(b,d,e,c.xCanvas,c.yCanvas)}},TQ.TextEditor=c}(),window.TQ=window.TQ||{},function(){var a={};a.obj=function(){return $("#floatToolbarDiv")},a.initialize=function(){TQ.floatToolbar.selectedElement=null,a.obj().css("display","none"),a.setupButtons()},a.show=function(b){var c="none";1==b&&(c="block"),a.obj().css("display",c)},a.setPosition=function(b,c){a.obj().css("left",b-100).css("top",c+30)},a.isVisible=function(){return status=a.obj().css("display"),"block"==status?!0:!1},a.setupButtons=function(){$("#doScaleBig").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.InputCtrl.doScale(TQ.floatToolbar.selectedElement,1.2)}),$("#doScaleSmall").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.InputCtrl.doScale(TQ.floatToolbar.selectedElement,.8)}),$("#rotateLeft").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.IKCtrl.rotate(TQ.floatToolbar.selectedElement,10)}),$("#rotateRight").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.IKCtrl.rotate(TQ.floatToolbar.selectedElement,-10)}),$("#moveLayerPrev").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.MoveCtrl.moveLayer(TQ.floatToolbar.selectedElement,1)}),$("#moveLayerNext").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.MoveCtrl.moveLayer(TQ.floatToolbar.selectedElement,-1)}),$("#moveToTop").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.MoveCtrl.moveToTop(TQ.floatToolbar.selectedElement)}),$("#moveToBottom").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.MoveCtrl.moveToBottom(TQ.floatToolbar.selectedElement)}),$("#delete").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.SelectSet.delete(),TQ.floatToolbar.show(!1)}),$("#mirrorX").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.InputCtrl.mirrorX(TQ.floatToolbar.selectedElement)}),$("#mirrorY").bind("touchstart click",function(a){a.stopPropagation(),a.preventDefault(),TQBase.LevelState.saveOperation(TQBase.LevelState.OP_FLOATTOOLBAR),TQ.InputCtrl.mirrorY(TQ.floatToolbar.selectedElement)})},TQ.floatToolbar=a}(),window.TQ=window.TQ||{},function(){function a(){}a.isPlayOnly=!1,a.currentScene=null,a.getCurrentScene=function(){return a.currentScene},a.getCurrentElement=function(){return TQ.SelectSet.peek()},a.gotoLevel=function(b){b=Number(b),assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.gotoLevel(b)},a.addLevelAt=function(b){b=Number(b),assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.addLevel(b)},a.addLevel=function(){assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.addLevel(a.currentScene.currentLevelId+1)},a.deleteLevel=function(b){b=Number(b),assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.deleteLevel(b)},a.moveTo=function(b,c){b=Number(b),c=Number(c),assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.moveTo(b,c)},a.copyTo=function(b,c){b=Number(b),c=Number(c),assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene&&a.currentScene.copyTo(b,c)},a.getLevelNum=function(){return assertNotNull(TQ.Dictionary.FoundNull,a.currentScene),a.currentScene?a.currentScene.levelNum():0},a.doStop=function(){assertTrue(TQ.Dictionary.INVALID_LOGIC,null!=a.currentScene),null!=a.currentScene&&a.currentScene.stop()},a.doPlay=function(){assertTrue(TQ.Dictionary.INVALID_LOGIC,null!=a.currentScene),null!=a.currentScene&&a.currentScene.play()},a.doPlayRecord=function(){TQ.SceneEditor.setEditMode()},a.doStopRecord=function(){TQ.SceneEditor.setPlayMode()},a.emptyScene=function(){TQ.SceneEditor.emptyScene()},a.doPlayStop=function(){a.isPlayOnly?TQ.FrameCounter.isPlaying()?a.doStop():a.doPlay():TQ.FrameCounter.isPlaying()?$("#stop").click():$("#play").click()};var b;a.fullscreenPlay=function(c,d){b=document.getElementById("testCanvas"),b.width=c,b.height=d,TQ.Config.zoomX=c/TQ.Config.workingRegionWidth,TQ.Config.zoomY=d/TQ.Config.workingRegionHeight,TQ.Config.workingRegionWidth=c,TQ.Config.workingRegionHeight=d,a.doPlay()},a.eixtFullscreen=function(){b.width=TQ.Config.workingRegionWidth,b.height=TQ.Config.workingRegionHeight,TQ.Config.zoomX=TQ.Config.zoomY=1},a.deleteElement=function(b){a.currentScene.deleteElement(b)},a.addResToStageCenter=function(a,b,c){return addResToStageCenter(a,b,c)},a.getCurrentLevelID=function(){return a.currentScene.currentLevelId},a.getCurrentTime=function(){return TQ.FrameCounter.t()},a.snow=function(a,b,c,d,e){TQ.SnowEffect.set(a,b,c,d,e)},a.snowChange=function(a,b,c){TQ.SnowEffect.set(a,b,c)},a.snowStop=function(){TQ.SnowEffect.stop()},a.rain=function(a,b,c,d,e){TQ.RainEffect.set(a,b,c,d,e)},a.rainChange=function(a,b,c){TQ.RainEffect.set(a,b,c)},a.rainStop=function(){TQ.RainEffect.stop()},a.firework=function(a){console.log(a)},a.setMarkerSize=function(a){TQ.Marker.RADIUS=a},TQ.WCY=a}(),window.TQ=window.TQ||{},function(){var a=function(){throw"Grid cannot be instantiated"};a._initialized=!1,a._on=!1,a.initialize=function(){a.M=100,a.N=100,a.COLOR="#cbcbcb",a.THICK=2,a.THIN=.5,a.grids=[];for(var b=canvas.width,c=canvas.height,d=b/(a.M-1),e=c/(a.N-1),f=0;f<a.M;f++){var g=f%5?a.THIN:a.THICK,h=new TQ.Trace(a.COLOR,g);h.add(TQ.Utility.worldToDevioce(d*f,0)),h.add(TQ.Utility.worldToDevioce(d*f,c)),a.grids.push(h)}for(var f=0;f<a.N;f++)g=f%5?a.THIN:a.THICK,h=new TQ.Trace(a.COLOR,g),h.add(TQ.Utility.worldToDevioce(0,e*f)),h.add(TQ.Utility.worldToDevioce(b,e*f)),a.grids.push(h);a._initialized=!0,a.show(!1)},a.show=function(b){a._initialized||a.initialize();for(var c=a.M+a.N,d=0;c>d;d++){var e=a.grids[d];if(!e)return;b?e.addToStage():e.removeFromStage()}a._on=b},TQ.Grid=a,TQ.InputMap.registerAction(TQ.InputMap.GRID_ON_OFF_KEY,function(){TQ.Grid.show(!a._on)})}(),window.TQ=window.TQ||{},function(){function a(){}a._mode=TQBase.LevelState.EDITING,a.loadScene=function(a){openScene(a)},a.emptyScene=function(){return currScene?void currScene.forceToRemoveAll():(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1)},a.getMode=function(){return TQ.WCY.isPlayOnly?TQBase.LevelState.RUNNING:a._mode},a.setEditMode=function(){return currScene?($("#stop").click(),void a.setMode(TQBase.LevelState.EDITING)):(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1)},a.setPlayMode=function(){return currScene?($("#play").click(),void a.setMode(TQBase.LevelState.RUNNING)):(assertTrue(TQ.Dictionary.INVALID_LOGIC,!1),!1)},a.updateMode=function(){null!=a._requestMode&&(a._mode=a._requestMode,a._requestMode=null)},a.setMode=function(b){a._requestMode=b},a.isEditMode=function(){return a.getMode()==TQBase.LevelState.EDITING},a.isPlayMode=function(){return a.getMode()==TQBase.LevelState.RUNNING},TQ.SceneEditor=a}();var canvas,messageBoard,stage=null,currScene=null;RotateCtrl.paras=null,RotateCtrl.timeStamp=0,RotateCtrl.target=null,RotateCtrl.oldAngle=0,RotateCtrl.do=function(a){if("rotate"===a.type){var b=null;RotateCtrl.paras=RotateCtrl.getParas(a),RotateCtrl.paras.isNewCmd?(b=getTarget(a),RotateCtrl.oldAngle=b.getRotation(),RotateCtrl.target=b):RotateCtrl.target?b=RotateCtrl.target:console.log("error:  it should be a new command. "),b&&RotateCtrl.paras.rotation&&!isNaN(RotateCtrl.paras.rotation)&&b.rotateTo(RotateCtrl.oldAngle-RotateCtrl.paras.rotation)}},RotateCtrl.getParas=function(a){return RotateCtrl.paras||(RotateCtrl.paras={},RotateCtrl.timeStamp=a.timeStamp),RotateCtrl.paras.type=a.type,RotateCtrl.paras.timeDiff=a.timeStamp-RotateCtrl.timeStamp,RotateCtrl.paras.isNewCmd=RotateCtrl.paras.timeDiff>100,RotateCtrl.paras.rotation=Math.truncate6(a.rotation),RotateCtrl.timeStamp=a.timeStamp,RotateCtrl.paras};var getTarget=function(a){var b={x:a.center.x,y:a.center.y},c=stage._getObjectsUnderPoint(b.x,b.y,null,!0,1);return c?c.ele||null:null};ScaleCtrl.prototype=Object.create(RotateCtrl.prototype),ScaleCtrl.test=function(){return ScaleCtrl.oldAngle=8,!0},TQ=TQ||{},function(){"use strict";function a(b,c){assertTrue(TQ.Dictionary.INVALID_PARAMETER,"string"!=typeof c),this.level=b,this.children=[],this.instance=null,this._isNewSkin=!1,this.state2=a.INVISIBLE,this.initialize(c)}var b=a.prototype=new TQ.Element(null,null);b.getImageResource=function(a,b){return c(b.src)},b._parent_doShow=b.doShow,b.doShow=function(a){this._parent_doShow(a),a&&TQ.FrameCounter.isPlaying()?this.play():this.stop()},b.stop=function(){var a=this.displayObj.image;a.paused||a.pause()},b.play=function(){var a=this.displayObj.image;a.paused&&a.play()};var c=function(a){var b=document.createElement("video");return b.src=TQ.ResourceManager.toFullPath(a),b.autoplay=!1,b.setAttribute("controls","false"),b};TQ.VideoElement=a}();var useHammer=!1,hammertime=null,hammerEle=null,addHammerByID=function(a){if(!hammertime){var b=document.getElementById(a);addHammer(b)}},addHammer=function(a){useHammer&&!hammertime&&(hammerEle=a,hammertime=new Hammer(a),hammertime.get("pinch").set({enable:!0}),hammertime.get("rotate").set({enable:!0}),hammertime.get("pan").set({direction:Hammer.DIRECTION_ALL}),hammertime.get("swipe").set({direction:Hammer.DIRECTION_VERTICAL}),hammertime.on("pan pinch rotate swipe",function(a){switch(RotateCtrl.paras?RotateCtrl.paras.isNewCmd=RotateCtrl.paras.type!==a.type:(RotateCtrl.paras={},RotateCtrl.paras.isNewCmd=!0,RotateCtrl.timeStamp=a.timeStamp),a.type){case"pinch":break;case"rotate":return RotateCtrl.do(a);default:console.log(a.type)}}))};this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;b.initialize=function(){},b.getBounds=function(){return new createjs.Rectangle(0,0,0,0)},b.applyFilter=function(){},b.toString=function(){return"[Filter]"},b.clone=function(){return new a},createjs.Filter=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c,d,e,f,g,h){this.initialize(a,b,c,d,e,f,g,h)},b=a.prototype=new createjs.Filter;b.redMultiplier=1,b.greenMultiplier=1,b.blueMultiplier=1,b.alphaMultiplier=1,b.redOffset=0,b.greenOffset=0,b.blueOffset=0,b.alphaOffset=0,b.initialize=function(a,b,c,d,e,f,g,h){this.redMultiplier=null!=a?a:1,this.greenMultiplier=null!=b?b:1,this.blueMultiplier=null!=c?c:1,this.alphaMultiplier=null!=d?d:1,this.redOffset=e||0,this.greenOffset=f||0,this.blueOffset=g||0,this.alphaOffset=h||0},b.applyFilter=function(a,b,c,d,e,f,g,h){f=f||a,null==g&&(g=b),null==h&&(h=c);try{var i=a.getImageData(b,c,d,e)}catch(j){return!1}for(var k=i.data,l=k.length,m=0;l>m;m+=4)k[m]=k[m]*this.redMultiplier+this.redOffset,k[m+1]=k[m+1]*this.greenMultiplier+this.greenOffset,k[m+2]=k[m+2]*this.blueMultiplier+this.blueOffset,k[m+3]=k[m+3]*this.alphaMultiplier+this.alphaOffset;return i.data=k,f.putImageData(i,g,h),!0},b.toString=function(){return"[ColorFilter]"},b.clone=function(){return new a(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},createjs.ColorFilter=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype;b.debugMode=!0,b.originX=0,b.originY=0,b.velocityX=0,b.velocityY=0,b.linearVelocityX=0,b.linearVelocityY=0,b.radialVelocity=0,b.tangentalVelocity=0,b.radialAcceleration=0,b.tangentalAcceleration=0,b.linearAccelerationX=0,b.linearAccelerationY=0,b.particleBaseId=0,b._lastUpdateTimeMs=0,b.initialize=function(a){this._particleObject=a},b.initializeProperties=function(a){this.particleBaseId=a},b.updateParticle=function(){var a=createjs.Ticker.getTime();TQ.FrameCounter.isPlaying()||(a=this._lastUpdateTimeMs),this.updatePosition(a)},b.updatePosition=function(a){var b=a-this._lastUpdateTimeMs,c=b/1e3;return this._lastUpdateTimeMs<=0?void(this._lastUpdateTimeMs=a):(this.velocityX=0,this.velocityY=0,this._processLinearAcceleration(c),this._processRadialAcceleration(c),this._processTangentalAcceleration(c),this._processLinearVelocity(c),this._processRadialAndTangentalVelocity(c),this._processVelocity(),void(this._lastUpdateTimeMs=a))},b._processLinearAcceleration=function(a){var b=this.linearAccelerationX*a,c=this.linearAccelerationY*a;this.linearVelocityX+=b,this.linearVelocityY+=c},b._processRadialAcceleration=function(a){var b=this.radialAcceleration*a;this.radialVelocity+=b},b._processTangentalAcceleration=function(a){var b=this.tangentalAcceleration*a;this.tangentalVelocity+=b},b._processLinearVelocity=function(a){var b=this.linearVelocityY*a,c=this.linearVelocityX*a;this.velocityX+=c,this.velocityY+=b},b._processRadialAndTangentalVelocity=function(a){var b=this._getParticleCenter(),c=this.originY-b.y,d=this.originX-b.x,e=Math.atan2(c,d);this._processRadialVelocity(a,e),this._processTangentalVelocity(a,e)},b._processRadialVelocity=function(a,b){var c=this.radialVelocity*a*Math.cos(b),d=this.radialVelocity*a*Math.sin(b);this.velocityX+=c,this.velocityY+=d},b._processTangentalVelocity=function(a,b){var c=this.tangentalVelocity*a*Math.cos(b-Math.PI/2),d=this.tangentalVelocity*a*Math.sin(b-Math.PI/2);this.velocityX+=c,this.velocityY+=d},b._processVelocity=function(){this._particleObject.x+=this.velocityX,this._particleObject.y+=this.velocityY},b._getParticleCenter=function(){var a={x:this._particleObject.x,y:this._particleObject.y};return a},b._debugText=function(a){this.debugMode&&console.log(a)},createjs.BaseParticle=a}(),this.createjs=this.createjs||{},function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.Bitmap;b.Bitmap_initialise=b.initialize,b.Bitmap_draw=b.draw,b.Bitmap_updateContext=b.updateContext,b.particleId=0,b._baseParticle=null,b.initialize=function(a){this.Bitmap_initialise(a),this._baseParticle=new createjs.BaseParticle(this)},b.initializeProperties=function(a){this.particleId=a,this._baseParticle.initializeProperties(a)},b.updateContext=function(a){this._baseParticle.updateParticle(),this.Bitmap_updateContext(a)},createjs.BitmapParticle=a}(),this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype=new createjs.Shape;b.Shape_initialise=b.initialize,b.Shape_draw=b.draw,b.Shape_updateContext=b.updateContext,b.particleId=0,b._baseParticle=null,b.initialize=function(){this.Shape_initialise(),this._baseParticle=new createjs.BaseParticle(this)},b.initializeProperties=function(a){this.particleId=a,this._baseParticle.initializeProperties(a)},b.updateContext=function(a){this.Shape_updateContext(a),this._baseParticle.updateParticle()},createjs.ShapeParticle=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a){null!=a&&(this.image=a),this.initialize()},b=a.prototype=new createjs.DisplayObject;a.stopped=!1,createjs.ParticleEmitterState={Created:0,Running:1,Finished:2},createjs.ParticleEmitterType={Emit:0,OneShot:1},b.REMAIN_UNCHANGED=null,b.INFINITE=-1,b.DisplayObject_initialise=b.initialize,b.DisplayObject_draw=b.draw,b.DisplayObject_updateContext=b.updateContext,b.autoRemoveOnFinished=!1,b.debugMode=!1,b.duration=b.INFINITE,b.emitterType=createjs.ParticleEmitterType.Emit,b.maxParticles=200,b.emissionRate=1,b.state=createjs.ParticleEmitterState.Created,b.image=null,b.accelerationX=0,b.accelerationY=0,b.angle=0,b.angleVar=0,b.endOpacity=b.REMAIN_UNCHANGED,b.endColor=b.REMAIN_UNCHANGED,b.endColorVar=[0,0,0],b.endSize=b.REMAIN_UNCHANGED,b.endSizeVar=0,b.endSpin=b.REMAIN_UNCHANGED,b.endSpinVar=0,b.life=4e3,b.lifeVar=0,b.positionVarX=0,b.positionVarY=0,b.radialAcceleration=0,b.radialAccelerationVar=0,b.speed=10,b.speedVar=0,b.startOpacity=1,b.startColor=[255,0,0],b.startColorVar=[0,0,0],b.startSize=20,b.startSizeVar=0,b.startSpin=0,b.startSpinVar=0,b.tangentalAcceleration=0,b.tangentalAccelerationVar=0,b._totalEmitted=0,b._timeStarted=0,b._timeLastParticleEmitted=0,b._particles=new Array,b.reset=function(){for(;this._particles.length>0;){var a=this._particles[0];if(null!=a.filters)for(var b in a.filters)createjs.Tween.removeTweens(a.filters[b]);a.uncache(),createjs.Tween.removeTweens(a),this._particles.splice(0,1),this.parent.removeChild(a)}this._timeLastParticleEmitted=0,this.state=createjs.ParticleEmitterState.Created},b.initialize=function(){this.DisplayObject_initialise()},b.updateContext=function(c){this.DisplayObject_updateContext(c);var d=createjs.Ticker.getTime();if(TQ.FrameCounter.isPlaying()||(d=this._lastUpdateTimeMs),a.stopped&&(d=this._lastUpdateTimeMs),this.state==createjs.ParticleEmitterState.Created?(this._timeStarted=d,this.state=createjs.ParticleEmitterState.Running):this.duration!=this.INFINITE&&d>this._timeStarted+this.duration&&(this.state=createjs.ParticleEmitterState.Finished),this.state==createjs.ParticleEmitterState.Running)switch(this.emitterType){case createjs.ParticleEmitterType.OneShot:this._oneShot(d);break;case createjs.ParticleEmitterType.Emit:default:this._emit(d)}else this.state==createjs.ParticleEmitterState.Finished&&this.autoRemoveOnFinished&&this.parent.removeChild(this);if(this.endColor!=b.REMAIN_UNCHANGED)for(var e=0;e<this._particles.length;e++)this._particles[e].updateCache()},b._emit=function(a){var b=1e3/this.emissionRate;a>this._timeLastParticleEmitted+b&&this._particles.length<this.maxParticles&&(this._generateParticle(),this._timeLastParticleEmitted=a)},b._oneShot=function(a){if(0==this._particles.length){for(var b=0;b<this.maxParticles;b++)this._generateParticle();this._timeLastParticleEmitted=a}},b._generateParticle=function(){var a=this;this._debugText("generateParticle");var b=this.startOpacity,c=this._getColor(this.startColor,this.startColorVar),d=this._getVariedValue(this.startSize,this.startSizeVar,!0),e=this._getVariedValue(this.startSpin,this.startSpinVar,!1),f=this.endColor==this.REMAIN_UNCHANGED?this.startColor:this._getColor(this.endColor,this.endColorVar),g=this.endSize==this.REMAIN_UNCHANGED?this.startSize:this._getVariedValue(this.endSize,this.endSizeVar,!0),h=this.endSpin==this.REMAIN_UNCHANGED?this.startSpin:this._getVariedValue(this.endSpin,this.endSpinVar,!0),i=this.endOpacity==this.REMAIN_UNCHANGED?this.startOpacity:this.endOpacity,j=g/d,k=this._getVariedValue(this.speed,this.speedVar,!0),l=this._getVariedValue(this.life,this.lifeVar,!0),m=this._getAngle(this.angle,this.angleVar),n=k*l/1e3,o={x:this._getVariedValue(this.position.x,this.positionVarX,!1),y:this._getVariedValue(this.position.y,this.positionVarY,!1)},p=this._getPositionInDirection(this.position,m,n),q=p.x-this.position.x,r=p.y-this.position.y,s=this._createParticle(o,c,b,d,e,l,q,r);
this.parent.addChild(s);var t=this._createColorFilter(s,c);null==this.image?s.cache(0,0,d,d):s.cache(0,0,this.image.width,this.image.height,d/this.image.width),j*=s.scaleX,createjs.Tween.get(s).to({scaleX:j,scaleY:j,rotation:h,alpha:i},l).call(function(){a._onParticleFinished(s)}),createjs.Tween.get(t).to({redMultiplier:f[0]/255,greenMultiplier:f[1]/255,blueMultiplier:f[2]/255},l),this._particles.push(s),this._totalEmitted++,this._debugText(this._format("Particle [s_x:{0}, s_y:{1}, e_x:{2}, e_y:{3}]",this.position.x,this.position.y,p.x,p.y))},b._createColorFilter=function(a,b){var c=new createjs.ColorFilter(b[0]/255,b[1]/255,b[2]/255,1);return a.filters=[c],c},b._createParticle=function(a,b,c,d,e,f,g,h){var i=null;i=null!=this.image?this._createImageParticle(b,d):this._createCircleParticle(b,d);var j=null!=this.image?this.image.width:d,k=null!=this.image?this.image.height:d;return i._baseParticle.originX=this.position.x,i._baseParticle.originY=this.position.y,i._baseParticle.linearVelocityX=g/f*1e3,i._baseParticle.linearVelocityY=h/f*1e3,i._baseParticle.linearAccelerationX=this.accelerationX,i._baseParticle.linearAccelerationY=this.accelerationY,i._baseParticle.radialAcceleration=this._getVariedValue(this.radialAcceleration,this.radialAccelerationVar,!1),i._baseParticle.tangentalAcceleration=this._getVariedValue(this.tangentalAcceleration,this.tangentalAccelerationVar,!1),i.alpha=c,i.rotation=e,i.x=a.x,i.y=a.y,i.regX=j/2,i.regY=k/2,i.initializeProperties(this._totalEmitted),i},b._createImageParticle=function(a,b){var c=new createjs.BitmapParticle(this.image);return c.scaleX=b/this.image.width,c.scaleY=c.scaleX,c},b._createCircleParticle=function(a,b){var c=new createjs.ShapeParticle,d=createjs.Graphics.getRGB(255,255,255);return c.graphics.beginFill(d).drawCircle(b/2,b/2,b/2),c.alpha=255,c},b._debugText=function(a){this.debugMode&&console.log(a)},b._getPositionInDirection=function(a,b,c){var d=a.x+this._cosd(b)*c,e=a.y+this._sind(b)*c;return new createjs.Point(d,e)},b._getVariedValue=function(a,b,c){var d=1==this._intRandom(1)?1:-1,e=a+this._intRandom(b)*d;return c&&(e=this._lowerLimit(e)),e},b._getAngle=function(a,b){var c=this._getVariedValue(a,b);return c=0>c?360+c:c,c=c>360?c-360:c},b._getColor=function(a,b){var c=null==b?a[0]:this._getVariedValue(a[0],b[0]),d=null==b?a[1]:this._getVariedValue(a[1],b[1]),e=null==b?a[2]:this._getVariedValue(a[2],b[2]);c=this._rgbLimit(c),d=this._rgbLimit(d),e=this._rgbLimit(e);var f=[c,d,e];return f},b._rgbLimit=function(a){var b=this._lowerLimit(a);return b=b>255?255:b},b._lowerLimit=function(a){var b=0>a?0:a;return b},b._intRandom=function(a){return Math.floor(Math.random()*(a+1))},b._sind=function(a){return Math.sin(this._toRadians(a))},b._cosd=function(a){return Math.cos(this._toRadians(a))},b._toRadians=function(a){return a*Math.PI/180},b._format=function(){for(var a=arguments[0],b=0;b<arguments.length-1;b++){var c=new RegExp("\\{"+b+"\\}","gm");a=a.replace(c,arguments[b+1])}return a},b._onParticleFinished=function(a){a.uncache();var b=this._particles.indexOf(a);this._particles.splice(b,1),this.parent.removeChild(a),0==this._particles.length&&this.state==createjs.ParticleEmitterState.Running&&this.emitterType==createjs.ParticleEmitterType.OneShot&&(this.state=createjs.ParticleEmitterState.Finished)},createjs.ParticleEmitter=a}(),this.TQ=this.TQ||{},function(){var a=function(){},b=a;b.initialize=function(){a.loadAsset()},b.set=function(a,c,d){a=TQ.MathExt.unifyValue10(a,10,20),c=TQ.MathExt.unifyValue10(c,75,105),d=TQ.MathExt.unifyValue10(d,30,40),b.rain1={density:40,startSize:10,direction:110,dy:50,v0:300,endOpacity:-1,endSize:0,endSizeVar:5},b.rain2={density:40,startSize:20,direction:110,dy:10,v0:100,endOpacity:.1,endSize:-1,endSizeVar:5},b.para1={density:d,startSize:a,direction:c,dy:10,v0:100,endOpacity:.1,endSize:-1,endSizeVar:5},b.emitter?b._apply():(b.para1=b.rain1,b._loadAsset()),TQ.FrameCounter.isPlaying()||$("#play").click(),createjs.ParticleEmitter.stopped=!1},b._apply=function(){for(var a=0;a<b.emitters.length;a++){var c=b.emitters[a];c.speed=b.para1.v0,c.positionVarY=b.para1.dy,c.angle=b.para1.direction,c.endOpacity=b.para1.endOpacity,c.startSize=b.para1.startSize,c.startSizeVar=b.para1.startSize/2,c.endSizeVar=b.para1.endSizeVar}},b.stop=function(){createjs.ParticleEmitter.stopped=!0},b._loadAsset=function(){b.particleImage||(b.particleImage=new Image,b.particleImage.onload=b._initCanvas,b.particleImage.src="http://"+TQ.Config.DOMAIN_NAME+"/public/mcImages/yudi3.png")},b._initCanvas=function(){canvas||(canvas=document.getElementById("testCanvas"),context=canvas.getContext("2d"),stage=new createjs.Stage(canvas)),b.emitter?b._apply(b.para1):(createjs.Ticker.setFPS(30),createjs.Ticker.addListener(update),addFPS(),b._create(b.para1),b.created=!0)},b._create=function(a){var c=a.density,d=1;b.emitters=[];for(var e=0;c>e;e++)for(var f=0;d>f;f++){var g=e/c*canvas.width+canvas.width/10,h=f/d*canvas.height-canvas.height/10;a.x=g,a.y=h,b.emitters.push(b.addParticleEmitter(a))}},b.addParticleEmitter=function(a){var c=new createjs.ParticleEmitter(b.particleImage);return c.position=new createjs.Point(a.x,a.y),c.emitterType=createjs.ParticleEmitterType.Emit,c.emissionRate=2,c.maxParticles=2e3,c.life=9e3,c.lifeVar=500,c.speed=a.v0,c.speedVar=20,c.positionVarX=20,c.positionVarY=a.dy,c.accelerationX=0,c.accelerationY=0,c.radialAcceleration=0,c.radialAccelerationVar=0,c.tangentalAcceleration=0,c.tangentalAccelerationVar=0,c.angle=a.direction,c.angleVar=10,c.startSpin=20,c.startSpinVar=10,c.endSpin=null,c.endSpinVar=null,c.startColor=[190,190,255],c.startColorVar=[50,50,0],c.startOpacity=1,c.endColor=null,c.endColorVar=null,c.endOpacity=a.endOpacity,c.startSize=a.startSize,c.startSizeVar=a.startSize/2,c.endSize=0,c.endSizeVar=a.endSizeVar,b.emitter=c,stage.addChild(c),c},TQ.RainEffect=a}();var stage;this.TQ=this.TQ||{},function(){var a=function(){},b=a;b.initialize=function(){a.loadAsset()},b.set=function(a,c,d){a=TQ.MathExt.unifyValue10(a,10,20),c=TQ.MathExt.unifyValue10(c,75,105),d=TQ.MathExt.unifyValue10(d,30,40),b.rain1={density:40,startSize:10,direction:110,dy:50,v0:300,endOpacity:-1,endSize:0,endSizeVar:5},b.rain2={density:40,startSize:20,direction:110,dy:10,v0:100,endOpacity:.1,endSize:-1,endSizeVar:5},b.para1={density:d,startSize:a,direction:c,dy:10,v0:100,endOpacity:.1,endSize:-1,endSizeVar:5},b.emitter?b._apply():(b.para1=b.rain1,b._loadAsset()),TQ.FrameCounter.isPlaying()||$("#play").click(),createjs.ParticleEmitter.stopped=!1},b._apply=function(){for(var a=0;a<b.emitters.length;a++){var c=b.emitters[a];c.speed=b.para1.v0,c.positionVarY=b.para1.dy,c.angle=b.para1.direction,c.endOpacity=b.para1.endOpacity,c.startSize=b.para1.startSize,c.startSizeVar=b.para1.startSize/2,c.endSizeVar=b.para1.endSizeVar}},b._loadAsset=function(){b.particleImage||(b.particleImage=new Image,b.particleImage.onload=b._initCanvas,b.particleImage.src="http://"+TQ.Config.DOMAIN_NAME+"/public/mcImages/xuehua1.png")},b.stop=function(){createjs.ParticleEmitter.stopped=!0},b._initCanvas=function(){canvas||(canvas=document.getElementById("testCanvas"),context=canvas.getContext("2d"),stage=new createjs.Stage(canvas)),b.emitter?b._apply(b.para1):(createjs.Ticker.setFPS(30),createjs.Ticker.addListener(update),addFPS(),b._create(b.para1),b.created=!0)},b._create=function(a){var c=a.density,d=1;b.emitters=[];for(var e=0;c>e;e++)for(var f=0;d>f;f++){var g=e/c*canvas.width+canvas.width/10,h=f/d*canvas.height-canvas.height/10;a.x=g,a.y=h,b.emitters.push(b.addParticleEmitter(a))}},b.addParticleEmitter=function(a){var c=new createjs.ParticleEmitter(b.particleImage);return c.position=new createjs.Point(a.x,a.y),c.emitterType=createjs.ParticleEmitterType.Emit,c.emissionRate=2,c.maxParticles=2e3,c.life=9e3,c.lifeVar=500,c.speed=a.v0,c.speedVar=20,c.positionVarX=20,c.positionVarY=a.dy,c.accelerationX=0,c.accelerationY=0,c.radialAcceleration=0,c.radialAccelerationVar=0,c.tangentalAcceleration=0,c.tangentalAccelerationVar=0,c.angle=a.direction,c.angleVar=10,c.startSpin=20,c.startSpinVar=10,c.endSpin=null,c.endSpinVar=null,c.startColor=[190,190,255],c.startColorVar=[50,50,0],c.startOpacity=1,c.endColor=null,c.endColorVar=null,c.endOpacity=a.endOpacity,c.startSize=a.startSize,c.startSizeVar=a.startSize/2,c.endSize=0,c.endSizeVar=a.endSizeVar,b.emitter=c,stage.addChild(c),c},TQ.SnowEffect=a}();var stage;this.createjs=this.createjs||{},function(){var a=function(){this.initialize()},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.removeEventListener=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent},b._listeners=null,b.initialize=function(){},b.addEventListener=function(a,b){var c=this._listeners;c?this.removeEventListener(a,b):c=this._listeners={};var d=c[a];return d||(d=c[a]=[]),d.push(b),b},b.removeEventListener=function(a,b){var c=this._listeners;if(c){var d=c[a];if(d)for(var e=0,f=d.length;f>e;e++)if(d[e]==b){1==f?delete c[a]:d.splice(e,1);break}}},b.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},b.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){if("string"==typeof a&&(a={type:a}),d=d[a.type],!d)return c;a.target=b||this;for(var d=d.slice(),e=0,f=d.length;f>e;e++)var g=d[e],c=g.handleEvent?c||g.handleEvent(a):c||g(a)}return!!c},b.hasEventListener=function(a){var b=this._listeners;return!(!b||!b[a])},b.toString=function(){return"[EventDispatcher]"},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;a.NONE=0,a.LOOP=1,a.REVERSE=2,a.IGNORE={},a._tweens=[],a._plugins={},a.get=function(b,c,d,e){return e&&a.removeTweens(b),new a(b,c,d)},a.tick=function(b,c){for(var d=a._tweens.slice(),e=d.length-1;e>=0;e--){var f=d[e];c&&!f.ignoreGlobalPause||f._paused||f.tick(f._useTicks?1:b)}},createjs.Ticker&&createjs.Ticker.addListener(a,!1),a.removeTweens=function(b){if(b.tweenjs_count){for(var c=a._tweens,d=c.length-1;d>=0;d--)c[d]._target==b&&(c[d]._paused=!0,c.splice(d,1));b.tweenjs_count=0}},a.removeAllTweens=function(){for(var b=a._tweens,c=0,d=b.length;d>c;c++){var e=b[c];e.paused=!0,e.target.tweenjs_count=0}b.length=0},a.hasActiveTweens=function(b){return b?b.tweenjs_count:a._tweens&&a._tweens.length},a.installPlugin=function(b,c){var d=b.priority;null==d&&(b.priority=d=0);for(var e=0,f=c.length,g=a._plugins;f>e;e++){var h=c[e];if(g[h]){for(var i=g[h],j=0,k=i.length;k>j&&!(d<i[j].priority);j++);g[h].splice(j,0,b)}else g[h]=[b]}},a._register=function(b,c){var d=b._target;c?(d&&(d.tweenjs_count=d.tweenjs_count?d.tweenjs_count+1:1),a._tweens.push(b)):(d&&d.tweenjs_count--,d=a._tweens.indexOf(b),-1!=d&&a._tweens.splice(d,1))},b.addEventListener=null,b.removeEventListener=null,b.removeAllEventListeners=null,b.dispatchEvent=null,b.hasEventListener=null,b._listeners=null,createjs.EventDispatcher.initialize(b),b.ignoreGlobalPause=!1,b.loop=!1,b.duration=0,b.pluginData=null,b.onChange=null,b.change=null,b.target=null,b.position=null,b._paused=!1,b._curQueueProps=null,b._initQueueProps=null,b._steps=null,b._actions=null,b._prevPosition=0,b._stepPosition=0,b._prevPos=-1,b._target=null,b._useTicks=!1,b.initialize=function(b,c,d){this.target=this._target=b,c&&(this._useTicks=c.useTicks,this.ignoreGlobalPause=c.ignoreGlobalPause,this.loop=c.loop,this.onChange=c.onChange,c.override&&a.removeTweens(b)),this.pluginData=d||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],c&&c.paused?this._paused=!0:a._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,a.NONE)},b.wait=function(a){if(null==a||0>=a)return this;var b=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:b,e:this._linearEase,p1:b})},b.to=function(a,b,c){return(isNaN(b)||0>b)&&(b=0),this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})},b.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})},b.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})},b.play=function(a){return this.call(a.setPaused,[!1],a)},b.pause=function(a){return a||(a=this),this.call(a.setPaused,[!0],a)},b.setPosition=function(a,b){0>a&&(a=0),null==b&&(b=1);var c=a,d=!1;if(c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0)),c==this._prevPos)return d;var e=this._prevPos;if(this.position=this._prevPos=c,this._prevPosition=a,this._target)if(d)this._updateTargetProps(null,1);else if(0<this._steps.length){for(var f=0,g=this._steps.length;g>f&&!(this._steps[f].t>c);f++);f=this._steps[f-1],this._updateTargetProps(f,(this._stepPosition=c-f.t)/f.d)}return 0!=b&&0<this._actions.length&&(this._useTicks?this._runActions(c,c):1==b&&e>c?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c)),d&&this.setPaused(!0),this.onChange&&this.onChange(this),this.dispatchEvent("change"),d},b.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)},b.setPaused=function(b){return this._paused=!!b,a._register(this,!b),this},b.w=b.wait,b.t=b.to,b.c=b.call,b.s=b.set,b.toString=function(){return"[Tween]"},b.clone=function(){throw"Tween can not be cloned."},b._updateTargetProps=function(b,c){var d,e,f,g;b||1!=c?(b.e&&(c=b.e(c,0,1,1)),d=b.p0,e=b.p1):d=e=this._curQueueProps;for(n in this._initQueueProps){null==(f=d[n])&&(d[n]=f=this._initQueueProps[n]),null==(g=e[n])&&(e[n]=g=f),f=f==g||0==c||1==c||"number"!=typeof f?1==c?g:f:f+(g-f)*c;var h=!1;if(g=a._plugins[n])for(var i=0,j=g.length;j>i;i++){var k=g[i].tween(this,n,f,d,e,c,!!b&&d==e,!b);k==a.IGNORE?h=!0:f=k}h||(this._target[n]=f)}},b._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;for(a>b&&(d=b,e=a,f=g,g=h=-1);(f+=h)!=g;){b=this._actions[f];var i=b.t;(i==e||i>d&&e>i||c&&i==a)&&b.f.apply(b.o,b.p)}},b._appendQueueProps=function(b){var c,d,e,f,g,h;for(h in b){if(void 0===this._initQueueProps[h]){if(d=this._target[h],c=a._plugins[h])for(e=0,f=c.length;f>e;e++)d=c[e].init(this,h,d);this._initQueueProps[h]=void 0===d?null:d}else d=this._curQueueProps[h];if(c=a._plugins[h])for(g=g||{},e=0,f=c.length;f>e;e++)c[e].step&&c[e].step(this,h,d,b[h],g);this._curQueueProps[h]=b[h]}return g&&this._appendQueueProps(g),this._curQueueProps},b._cloneProps=function(a){var b,c={};for(b in a)c[b]=a[b];return c},b._addStep=function(a){return 0<a.d&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d),this},b._addAction=function(a){return a.t=this.duration,this._actions.push(a),this},b._set=function(a,b){for(var c in a)b[c]=a[c]},createjs.Tween=a}(),this.createjs=this.createjs||{},function(){var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;b.ignoreGlobalPause=!1,b.duration=0,b.loop=!1,b.onChange=null,b.position=null,b._paused=!1,b._tweens=null,b._labels=null,b._prevPosition=0,b._prevPos=-1,b._useTicks=!1,b.initialize=function(a,b,c){this._tweens=[],c&&(this._useTicks=c.useTicks,this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,this.onChange=c.onChange),a&&this.addTween.apply(this,a),this.setLabels(b),c&&c.paused?this._paused=!0:createjs.Tween._register(this,!0),c&&null!=c.position&&this.setPosition(c.position,createjs.Tween.NONE)},b.addTween=function(a){var b=arguments.length;if(b>1){for(var c=0;b>c;c++)this.addTween(arguments[c]);return arguments[0]}return 0==b?null:(this.removeTween(a),this._tweens.push(a),a.setPaused(!0),a._paused=!1,a._useTicks=this._useTicks,a.duration>this.duration&&(this.duration=a.duration),0<=this._prevPos&&a.setPosition(this._prevPos,createjs.Tween.NONE),a)},b.removeTween=function(a){var b=arguments.length;if(b>1){for(var c=!0,d=0;b>d;d++)c=c&&this.removeTween(arguments[d]);return c}return 0==b?!1:(b=this._tweens.indexOf(a),-1!=b?(this._tweens.splice(b,1),a.duration>=this.duration&&this.updateDuration(),!0):!1)},b.addLabel=function(a,b){this._labels[a]=b},b.setLabels=function(a){this._labels=a?a:{}},b.gotoAndPlay=function(a){this.setPaused(!1),this._goto(a)},b.gotoAndStop=function(a){this.setPaused(!0),this._goto(a)},b.setPosition=function(a,b){0>a&&(a=0);var c=this.loop?a%this.duration:a,d=!this.loop&&a>=this.duration;if(c==this._prevPos)return d;this._prevPosition=a,this.position=this._prevPos=c;for(var e=0,f=this._tweens.length;f>e;e++)if(this._tweens[e].setPosition(c,b),c!=this._prevPos)return!1;return d&&this.setPaused(!0),this.onChange&&this.onChange(this),d},b.setPaused=function(a){this._paused=!!a,createjs.Tween._register(this,!a)},b.updateDuration=function(){for(var a=this.duration=0,b=this._tweens.length;b>a;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}},b.tick=function(a){this.setPosition(this._prevPosition+a)},b.resolve=function(a){var b=parseFloat(a);return isNaN(b)&&(b=this._labels[a]),b},b.toString=function(){return"[Timeline]"},b.clone=function(){throw"Timeline can not be cloned."},b._goto=function(a){a=this.resolve(a),null!=a&&this.setPosition(a)},createjs.Timeline=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"Ease cannot be instantiated."};a.linear=function(a){return a},a.none=a.linear,a.get=function(a){return-1>a&&(a=-1),a>1&&(a=1),function(b){return 0==a?b:0>a?b*(b*-a+1+a):b*((2-b)*a+(1-a))}},a.getPowIn=function(a){return function(b){return Math.pow(b,a)}},a.getPowOut=function(a){return function(b){return 1-Math.pow(1-b,a)}},a.getPowInOut=function(a){return function(b){return 1>(b*=2)?.5*Math.pow(b,a):1-.5*Math.abs(Math.pow(2-b,a))}},a.quadIn=a.getPowIn(2),a.quadOut=a.getPowOut(2),a.quadInOut=a.getPowInOut(2),a.cubicIn=a.getPowIn(3),a.cubicOut=a.getPowOut(3),a.cubicInOut=a.getPowInOut(3),a.quartIn=a.getPowIn(4),a.quartOut=a.getPowOut(4),a.quartInOut=a.getPowInOut(4),a.quintIn=a.getPowIn(5),a.quintOut=a.getPowOut(5),a.quintInOut=a.getPowInOut(5),a.sineIn=function(a){return 1-Math.cos(a*Math.PI/2)},a.sineOut=function(a){return Math.sin(a*Math.PI/2)},a.sineInOut=function(a){return-.5*(Math.cos(Math.PI*a)-1)},a.getBackIn=function(a){return function(b){return b*b*((a+1)*b-a)}},a.backIn=a.getBackIn(1.7),a.getBackOut=function(a){return function(b){return--b*b*((a+1)*b+a)+1}},a.backOut=a.getBackOut(1.7),a.getBackInOut=function(a){return a*=1.525,function(b){return 1>(b*=2)?.5*b*b*((a+1)*b-a):.5*((b-=2)*b*((a+1)*b+a)+2)}},a.backInOut=a.getBackInOut(1.7),a.circIn=function(a){return-(Math.sqrt(1-a*a)-1)},a.circOut=function(a){return Math.sqrt(1- --a*a)},a.circInOut=function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},a.bounceIn=function(b){return 1-a.bounceOut(1-b)},a.bounceOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},a.bounceInOut=function(b){return.5>b?.5*a.bounceIn(2*b):.5*a.bounceOut(2*b-1)+.5},a.getElasticIn=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return-(a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b))}},a.elasticIn=a.getElasticIn(1,.3),a.getElasticOut=function(a,b){var c=2*Math.PI;return function(d){if(0==d||1==d)return d;var e=b/c*Math.asin(1/a);return a*Math.pow(2,-10*d)*Math.sin((d-e)*c/b)+1}},a.elasticOut=a.getElasticOut(1,.3),a.getElasticInOut=function(a,b){var c=2*Math.PI;return function(d){var e=b/c*Math.asin(1/a);return 1>(d*=2)?-.5*a*Math.pow(2,10*(d-=1))*Math.sin((d-e)*c/b):.5*a*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*c/b)+1}},a.elasticInOut=a.getElasticInOut(1,.3*1.5),createjs.Ease=a}(),this.createjs=this.createjs||{},function(){var a=function(){throw"MotionGuidePlugin cannot be instantiated."};a.priority=0,a.install=function(){return createjs.Tween.installPlugin(a,["guide","x","y","rotation"]),createjs.Tween.IGNORE},a.init=function(a,b,c){return a=a.target,a.hasOwnProperty("x")||(a.x=0),a.hasOwnProperty("y")||(a.y=0),a.hasOwnProperty("rotation")||(a.rotation=0),"guide"==b?null:c},a.step=function(b,c,d,e,f){if("guide"!=c)return e;var g;if(e.hasOwnProperty("path")||(e.path=[]),b=e.path,e.hasOwnProperty("end")||(e.end=1),e.hasOwnProperty("start")||(e.start=d&&d.hasOwnProperty("end")&&d.path===b?d.end:0),e.hasOwnProperty("_segments")&&e._length)return e;if(d=b.length,!(d>=6&&0==(d-2)%4))throw"invalid 'path' data, please see documentation for valid paths";for(e._segments=[],e._length=0,c=2;d>c;c+=4){for(var h,i,j=b[c-2],k=b[c-1],l=b[c+0],m=b[c+1],n=b[c+2],o=b[c+3],p=j,q=k,r=0,s=[],t=1;10>=t;t++){i=t/10;var u=1-i;h=u*u*j+2*u*i*l+i*i*n,i=u*u*k+2*u*i*m+i*i*o,r+=s[s.push(Math.sqrt((g=h-p)*g+(g=i-q)*g))-1],p=h,q=i}e._segments.push(r),e._segments.push(s),e._length+=r}return g=e.orient,e.orient=!1,a.calc(e,e.end,f),e.orient=g,e},a.tween=function(b,c,d,e,f,g,h){return f=f.guide,void 0==f||f===e.guide?d:(f.lastRatio!=g&&(a.calc(f,(f.end-f.start)*(h?f.end:g)+f.start,b.target),f.orient&&(b.target.rotation+=e.rotation||0),f.lastRatio=g),f.orient||"rotation"!=c?b.target[c]:d)},a.calc=function(b,c,d){void 0==b._segments&&a.validate(b),void 0==d&&(d={x:0,y:0,rotation:0});var e=b._segments,f=b.path,g=b._length*c,h=e.length-2;for(c=0;g>e[c]&&h>c;)g-=e[c],c+=2;for(var e=e[c+1],i=0,h=e.length-1;g>e[i]&&h>i;)g-=e[i],i++;return g=i/++h+g/(h*e[i]),c=2*c+2,h=1-g,d.x=h*h*f[c-2]+2*h*g*f[c+0]+g*g*f[c+2],d.y=h*h*f[c-1]+2*h*g*f[c+1]+g*g*f[c+3],b.orient&&(d.rotation=57.2957795*Math.atan2((f[c+1]-f[c-1])*h+(f[c+3]-f[c+1])*g,(f[c+0]-f[c-2])*h+(f[c+2]-f[c+0])*g)),d},createjs.MotionGuidePlugin=a}(),function(){var a=this.createjs=this.createjs||{},a=a.TweenJS=a.TweenJS||{};a.version="0.4.0",a.buildDate="Tue, 12 Feb 2013 21:08:16 GMT"}();